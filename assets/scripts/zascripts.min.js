angular.module("tktr",["tktr.controllers","tktr.services","tktr.directives","tktr.filters","tktr.lodgectrls","tktr.vrctrl","ui.router","ngAnimate","ngSanitize","firebase","ngMaterial","angular-storage","ngGeolocation","uiGmapgoogle-maps","ja.qr","ngFileUpload","720kb.socialshare","pascalprecht.translate","qrScanner","mdPickers","ngIdle","jkAngularRatingStars","chart.js","ng.deviceDetector","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster"]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeError",function(e,a,o,n,i,r){"AUTH_REQUIRED"===r&&t.go("app.landing")})}]).config(["$mdDateLocaleProvider",function(e){e.formatDate=function(e){return moment(e).format("YYYY-MM-DD")}}]).config(function(){var e={apiKey:"AIzaSyBuD3H897xaN-khFT8iG08yz00jmh5aTTQ",authDomain:"tktr-za.firebaseapp.com",databaseURL:"https://tktr-za.firebaseio.com",storageBucket:"tktr-za.appspot.com",messagingSenderId:"951271058800"};firebase.initializeApp(e)}).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"https://tktr-za.firebaseio.com/translations/",suffix:".json"}).preferredLanguage("en").useMissingTranslationHandlerLog().useSanitizeValueStrategy("escape")}]).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","https://tktr-fa4cf.firebaseio.com/**","https://google.com/maps/embed/**","**tktr-fa4cf.appspot.com","**glaring-fire-7161.appspot.com","https://*.tktr.eu/**","https://tktr-za.appspot.com/**","https://tktr-za.firebaseio.com","https://tktrza-test.firebaseio.com","https://api.tolq.com/v1/translations/requests/quote"])}]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeStart",function(){e.stateIsLoading=!0})}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,a){a.hashPrefix(""),e.state("lodge",{url:"/lodge","abstract":!0,views:{header:{templateUrl:"templates/app.html",controller:"ParkCtrl"}}}).state("vrapp",{url:"/tktrvr","abstract":!0,views:{header:{templateUrl:"templates/vrapp.html",controller:"VrAppCtrl"}}}).state("vrapp.info",{url:"/product/:id",views:{vrinfo:{templateUrl:"templates/info3.html",controller:"VrProdCtrl"}}}).state("vrapp.cat",{url:"/category/:tag",views:{vrinfo:{templateUrl:"templates/vroverlay.html",controller:"VrCatCtrl"}}}).state("vrapp.explore",{url:"/explore",views:{vrinfo:{templateUrl:"templates/vroverlay.html"}}}).state("link",{url:"/agent/:partner/",views:{header:{templateUrl:"templates/link.html",controller:"LinkArrivalCtrl"}}}).state("lodge.home",{url:"/home",views:{main:{templateUrl:"templates/za/park.html",controller:"LodgeScreenCtrl"}}}).state("lodge.home.hotel_landing",{url:"/landing",views:{selectinfo:{templateUrl:"templates/za/tab_enter_info.html",controller:"LoginCtrl"}}}).state("lodge.home.dash.info",{url:"/activities/:id",views:{prodinfo:{templateUrl:"templates/za/park.info.html",controller:"EventCtrl"}}}).state("lodge.home.dash.room",{url:"/:lodge/room/:id",views:{prodinfo:{templateUrl:"templates/za/park.info.html",controller:"LodgeRoomCtrl"}}}).state("lodge.home.dash.lodges",{url:"/:id",views:{prodinfo:{templateUrl:"templates/za/lodge.info.html",controller:"LodgeInfoCtrl"}}}).state("lodge.home.dash",{url:"/dash",views:{selectinfo:{templateUrl:"templates/za/park.home2.html",controller:"LodgeScreenCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("lodge.screen",{url:"/screen/:size/dash",views:{main:{templateUrl:"templates/za/screen_hor.html",controller:"LodgeScreenCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("lodge.vert_screen",{url:"/vert_screen/:size/dash",views:{main:{templateUrl:"templates/tktr_vert.html",controller:"ParkHomeCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("lodge.screen.info",{url:"/:id",views:{selectinfo:{templateUrl:"templates/selectinfo.html",controller:"EventCtrl"}}}).state("app",{url:"/app","abstract":!0,views:{header:{templateUrl:"templates/app.html",controller:"AppCtrl"}}}).state("app.home_screen",{url:"/home",views:{main:{templateUrl:"templates/home2.html",controller:"ScreenCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.vrviewer",{url:"/vr/:id",views:{main:{templateUrl:"templates/home.vr.html",controller:"HomeVrCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.home_screen.dash.contact",{url:"/contact",views:{prodinfo:{templateUrl:"templates/contact.html",controller:"ContactCtrl"}}}).state("app.home_screen.about",{url:"/about",views:{selectinfo:{templateUrl:"templates/about.html",controller:"ContactCtrl"}}}).state("app.home_screen.terms",{url:"/terms",views:{selectinfo:{templateUrl:"templates/terms.html",controller:"TermsCtrl"}}}).state("app.home_screen.privacy",{url:"/privacy",views:{selectinfo:{templateUrl:"templates/privacy.html",controller:"TermsCtrl"}}}).state("app.home_screen.hotel_landing",{url:"/hotel/landing",views:{selectinfo:{templateUrl:"templates/tab_enter_info.html",controller:"LoginCtrl"}}}).state("app.home_screen.emaillanding",{url:"/claim/landing",views:{selectinfo:{templateUrl:"templates/tab_enter_info.html",controller:"LoginCtrl"}}}).state("app.home_screen.landing",{url:"/landing",views:{selectinfo:{templateUrl:"templates/landing.html",controller:"ArrivalCtrl"}}}).state("app.admin_landing",{url:"/portal",views:{main:{templateUrl:"templates/portal.landing.html",controller:"LoginCtrl"}}}).state("app.home_screen.dash.info",{url:"/:city/:cat/:aw/:id",views:{prodinfo:{templateUrl:"templates/info4.html",controller:"EventCtrl"}}}).state("app.home_screen.dash.accomm",{url:"/accommodation",views:{prodinfo:{templateUrl:"templates/afil_accom.html",controller:"AccommRecCtrl"}}}).state("app.home_screen.itinerary",{url:"/itinerary",views:{selectinfo:{templateUrl:"templates/itinerary.html",controller:"ItineraryCtrl"}}}).state("app.home_screen.dash.local",{url:"/local",views:{prodinfo:{templateUrl:"templates/local.html",controller:"LocalInfoCtrl"}}}).state("app.home_screen.dash",{url:"/dash",views:{selectinfo:{templateUrl:"templates/home4.html"}}}).state("app.home_screen.screen",{url:"/screen",views:{selectinfo:{templateUrl:"templates/home2.info2.html"}}}).state("app.tktr",{url:"/tktr",views:{main:{templateUrl:"templates/tktr.home.html",controller:"TktrHomeCtrl"}}}).state("app.vaya",{url:"/vaya/donde",views:{main:{templateUrl:"templates/vaya.home.html",controller:"VayaCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.home.partner.map",{url:"/map",views:{funky:{templateUrl:"templates/mapping.html",controller:"MapCtrl"}}}).state("app.vayahail",{url:"/vaya/donde",views:{main:{templateUrl:"templates/vayahail.html",controller:"VayaCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.pos_success",{url:"/tools/:vendor/pos_success",views:{main:{templateUrl:"templates/print_tix.html",controller:"PosSuccessCtrl"}}}).state("app.admin.mng_recs",{url:"/mng_recs",views:{adminview:{templateUrl:"templates/mng_recs.html",controller:"AdminRecCtrl"}}}).state("app.admin.mng_freebies",{url:"/mng_freebies",views:{adminview:{templateUrl:"templates/mng_promos.html",controller:"AdminFreebiesCtrl"}}}).state("app.admin.dash",{url:"/dash",views:{adminview:{templateUrl:"templates/admin.dash.html",controller:"AdminDashCtrl"}}}).state("app.admin.mng_vendor",{url:"/mng_vendor",views:{adminview:{templateUrl:"templates/mng_vendor.html",controller:"AdminVendorCtrl"}}}).state("app.admin.mng_lodges",{url:"/mng_lodges",views:{adminview:{templateUrl:"templates/mng_lodges.html",controller:"AdminLodgesCtrl"}}}).state("app.admin.mng_products",{url:"/products",views:{adminview:{templateUrl:"templates/mng_products.html",controller:"AdminProductsCtrl"}}}).state("app.admin.mng_products.info",{url:"/info/:id",views:{editview:{templateUrl:"templates/edit_product.html",controller:"AdminProductCtrl"}}}).state("app.admin.bookings",{url:"/bookings",views:{adminview:{templateUrl:"templates/bookings.html",controller:"AdminBookingsCtrl"}}}).state("app.admin.bookings.info",{url:"/info/:id",views:{bookingview:{templateUrl:"templates/edit_product.html",controller:"AdminBookingCtrl"}}}).state("app.admin.mng_products.new_product",{url:"/new",views:{editview:{templateUrl:"templates/new_product.html",controller:"AdminNewProductCtrl"}}}).state("app.admin.mng_menus",{url:"/mng_menus",views:{adminview:{templateUrl:"templates/mng_menus.html",controller:"AdminMenusCtrl"}}}).state("app.admin.mng_packages",{url:"/mng_packages",views:{adminview:{templateUrl:"templates/mng_packages.html",controller:"AdminProductsCtrl"}}}).state("app.admin.mng_rooms",{url:"/mng_rooms",views:{adminview:{templateUrl:"templates/mng_rooms.html",controller:"RoomEditCtrl"}}}).state("app.admin.mng_events",{url:"/mng_events",views:{adminview:{templateUrl:"templates/mng_events.html",controller:"AdminTicketsCtrl"}}}).state("app.admin.mng_stock",{url:"/mng_stock",views:{adminview:{templateUrl:"templates/mng_stock.html",controller:"AdminStockCtrl"}}}).state("app.admin.mng_drivers",{url:"/mng_drivers",views:{adminview:{templateUrl:"templates/mng_drivers.html",controller:"AdminDriverCtrl"}}}).state("app.track_drivers",{url:"/track_drivers",views:{adminview:{templateUrl:"templates/drivertracking.html",controller:"DriverTrackerCtrl"}}}).state("app.admin.mng_fleet",{url:"/vaya/mng_fleet",views:{adminview:{templateUrl:"templates/mng_fleet.html",controller:"AdminFleetCtrl"}}}).state("app.admin.fleet_pickup",{url:"/vaya/fleet_pickup",views:{adminview:{templateUrl:"templates/pickupvehicle.html",controller:"FleetPickupCtrl"}}}).state("app.landing",{url:"/landing",views:{main:{templateUrl:function(e){return"portal"==e?"templates/portal.landing.html":"templates/landing.html"},controller:"ArrivalCtrl"}}}).state("app.home_screen.menu",{url:"/menu",views:{selectinfo:{templateUrl:"templates/menu2.html",controller:"MenuCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.menu",{url:"/menu",views:{main:{templateUrl:"templates/menu2.html",controller:"MenuCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.menucat",{url:"/menu/:cat",views:{main:{templateUrl:"templates/category.html",controller:"MenuCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.menucat.menu",{url:"/list",views:{catview:{templateUrl:"templates/category.menu.html"},sideview:{templateUrl:"templates/menuside.html"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.driverApp",{url:"/driver/live",views:{main:{templateUrl:"templates/driver.live.html",controller:"VayaDriverCtrl"},side:{templateUrl:"templates/driver.side.live.html",controller:"VayaDriverCtrl"}}}).state("app.door",{url:"/door/:id",views:{main:{templateUrl:"templates/door.html",controller:"DoorCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.admin.pos",{url:"/tools/pos",views:{main:{templateUrl:"templates/pos.html",controller:"PosCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.ticketing",{url:"/ticketing/:id",views:{main:{templateUrl:"templates/ticketing.html",controller:"TicketingCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.success",{url:"/purchases/:id/success",views:{main:{templateUrl:"templates/ticketing.success.html",controller:"PurchaseSuccessCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.screen",{url:"/screen/:size",views:{main:{templateUrl:"templates/screen_hor.html",controller:"ScreenCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.screenlanding",{url:"/screen_landing",views:{main:{templateUrl:"templates/landing.html",controller:"ScreenArrivalCtrl"}}}).state("app.screen.hotel_landing",{url:"/landing",views:{selectinfo:{templateUrl:"templates/tab_enter_info.html",controller:"LoginCtrl"}}}).state("app.vert_screen",{url:"/vert_screen/:size/dash",views:{main:{templateUrl:"templates/tktr_vert.html",controller:"HomeCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.screen.info",{url:"/browse/:id",views:{selectinfo:{templateUrl:"templates/selectinfo.html",controller:"EventCtrl"}}}).state("app.screen.dash",{url:"/dash",views:{selectinfo:{templateUrl:"templates/tab_promo.html"}}}).state("app.menuscreen",{url:"/screen/:size/menu",views:{main:{templateUrl:function(e){return"templates/"+e+".html"},controller:"ScreenMenuCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.event",{url:"/browse/:id",views:{main:{templateUrl:"templates/event.html",controller:"EventCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.event.info",{url:"/info",views:{eventview:{templateUrl:"templates/eventinfo.html"}}}).state("app.rec",{url:"home/recommended/:id",views:{main:{templateUrl:"templates/rec.html",controller:"RecCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"},sideview:{templateUrl:"templates/sideProduct.html",controller:"EventCtrl"}}}).state("app.room",{url:"/rooms/:id",views:{main:{templateUrl:"templates/event.html",controller:"RoomCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.room.info",{url:"/info",views:{prodview:{templateUrl:"templates/sideroom.html",controller:"RoomCtrl"},eventview:{templateUrl:"templates/roominfo.html",controller:"RoomCtrl"}}}).state("app.room.book",{url:"/book/:date/:end/:people",views:{main:{templateUrl:"templates/room.html",controller:"RoomCtrl"},side:{templateUrl:"templates/sideroom.html",controller:"RoomCtrl"}}}).state("app.packs",{url:"/packs/:id",views:{main:{templateUrl:"templates/packs.html",controller:"PacksCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.admin.translate",{url:"/translate",views:{adminview:{templateUrl:"templates/translate.html",controller:"AdminTranslateCtrl"},side:{templateUrl:"templates/admin.side.html",controller:"AdminSideCtrl"}}}).state("app.tickets",{url:"/tickets/:uid",views:{main:{templateUrl:"templates/tickets.html",controller:"MyTixCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.walletLink",{url:"/tickets/:id/walletLink/:email",views:{main:{templateUrl:"templates/tickets.html",controller:"MyTixWalletCtrl"}}}).state("app.admin",{url:"/admin/:vendor",views:{main:{templateUrl:"templates/admin.html",controller:"AdminCtrl"},side:{templateUrl:"templates/ticket.side.html",controller:"TicketSideCtrl"}}}).state("app.admin.media",{url:"/media",views:{adminview:{templateUrl:"templates/media.edit.html",controller:"MediaEditCtrl"}}}).state("app.admin.staff",{url:"/staff",views:{adminview:{templateUrl:"templates/admin.staff.html",controller:"AdminStaffCtrl"}}}).state("app.admin.enquiries",{url:"/enquiries",views:{adminview:{templateUrl:"templates/admin.enq.html",controller:"AdminEnqCtrl"}}}).state("app.admin.scanner",{url:"/scanner",views:{adminview:{templateUrl:"templates/admin.scanner.html",controller:"QRScanner"}}}).state("app.admin.login",{url:"/login",views:{adminview:{templateUrl:"templates/admin.html",controller:"AdminCtrl"},side:{templateUrl:"templates/admin.side.html",controller:"AdminSideCtrl"}}}).state("app.admin.orders",{url:"/:vendor/orders",views:{adminview:{templateUrl:"templates/orderup.html",controller:"OrdersCtrl"},side:{templateUrl:"templates/admin.side.html",controller:"AdminSideCtrl"}}}).state("app.admin.cart",{url:"/:vendor/cart",views:{adminview:{templateUrl:"templates/admin.cart.html",controller:"AdminSalesCtrl"},side:{templateUrl:"templates/admin.side.html",controller:"AdminSideCtrl"}}}).state("app.safe_login",{url:"/login/:mergeId/safesignin/:email",views:{main:{templateUrl:"templates/safe_login.html",controller:"SafeLoginCtrl"}}}),t.otherwise(function(e,t){console.log(t.path());var a=t.path(),o=a.split("/");return"lodge"!=o[1]?"/app/landing":"lodge"==o[1]?"/lodge/landing":"/app/landing"})}]).config(["$mdThemingProvider",function(e){e.theme("default")}]).config(["uiGmapGoogleMapApiProvider",function(e){e.configure({key:"AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw",v:"3.20",libraries:"weather,geometry,visualization,places"})}]),angular.module("tktr.controllers",["tktr.services"]).controller("AppCtrl",["$scope","MediaService","$log","$state","$stateParams","$rootScope","$http","$anchorScroll","$location","$mdMedia","$mdDialog","$timeout","$geolocation","$firebaseObject","$firebaseArray","$translate","User","$mdToast","Auth","$mdDialog","$sce","$interval","deviceDetector","subdomain","InfoService","$q",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,s,y,w,k,S,P,A){function _(a,o){e.partner.info=a,h(a.writeup).then(function(t){e.intro=t.split("     ")}),"portal"!=e.appPartner&&u(e.loadVrBg(null,!1),2e3),e.partnerlogo="./assets/site/"+o+"_logo_btn.svg",e.partnermenu="./assets/site/"+o+"_menu_btn.svg",e.partnercart="./assets/site/"+o+"_total_btn.svg",t.getMedia(o).then(function(t){e.partnerMedia=t}),f(O.child("vendor_locations/"+o)).$loaded(function(t){e.partner.location=t}),f(O.child("sites/"+o)).$loaded(function(t){e.partner.classes=t,e.partner&&e.partner.classes&&(e.formFade=e.partner.classes.grad25)})}var O=firebase.database().ref();e.location,e.partner={},e.currLoc={},e.adminBool=!1,e.adminBooler=function(t){e.adminBool=t},e.vrbgurl="",e.loaded=function(){i.stateIsLoading=!1},e.loaderCheck=function(){!angular.isUndefined(i.stateIsLoading)&&i.stateIsLoading&&u(function(){i.stateIsLoading=!1},3e3)},i.cartBool=!1,e.showCart=function(){e.cartBool=!e.cartBool,i.sideMenuBool&&(i.sideMenuBool=!i.sideMenuBool)},i.sideMenuBool=!1,e.showSideMenu=function(){i.sideMenuBool=!i.sideMenuBool,e.cartBool&&(i.cartBool=!e.cartBool)},e.toggleMenu=function(t){"left"==t?i.sideMenuBool=!1:"right"==t&&(i.cartBool=!1),e[bool]=!1},e.trustHTML=function(e){return y.trustAsHtml(e)},e.deviceInfo=k,console.log(e.deviceInfo),e.tabletCheck=function(){return d("portrait")&&d("(min-width: 1080px)")?100:65},e.refresh=function(){o.reload()},e.getInfo=function(e){P.getInfo(e).then(function(e){return e})},i.partner=S,e.appPartner=i.partner,P.getInfo(e.appPartner).then(function(t){t?_(t,e.appPartner):P.getInfo("tktr").then(function(e){_(e,"tktr")})}),e.appWidth=function(){return $(window).width()},e.appHeight=function(){return $(window).height()},e.scratio=$(window).width()/$(window).height(),e.vrbgViewer,e.psvVar=0,e.toggleRotate=function(){switch(e.psvVar){case 0:e.vrbgViewer.stopAutorotate(),e.psvVar+=1,console.log(e.psvVar);break;case 1:e.vrbgViewer.startGyroscopeControl(),e.psvVar+=1,console.log(e.psvVar);break;case 2:e.vrbgViewer.stopGyroscopeControl(),e.psvVar+=1,console.log(e.psvVar);break;case 3:e.vrbgViewer.startAutorotate(),e.psvVar=0,console.log(e.psvVar)}e.vrbgViewer.toggleAutorotate()},e.addVRMarker=function(){e.vrbgViewer.addMarker({id:"marker-1",image:"assets/site/Info_btn.svg",width:32,height:32,x:500,y:1e3,content:'<div ui-view="prodinfo"></div>'})},e.loadVrBg=function(t,a){t||(t="assets/site/sights.jpg"),e.vrbgViewer=new PhotoSphereViewer({panorama:t,container:"vrbg",anim_speed:"0.5rpm",navbar:!1,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,loading_img:"https://firebasestorage.googleapis.com/v0/b/tktr-za.appspot.com/o/media%2Ftktrza%2FLogos_150x150_TKTR.co.za.png?alt=media&token=02bc93b2-e6a4-46d3-b243-4a01cbfe1b3d",transition:{duration:1500,loader:!0,blur:!0}})},e.hudView&&!angular.isUndefined(e.hudView)||(e.hudView="",e.tabBool=!0),!e.hudView||angular.isUndefined(e.hudView)?e.tabBool=!0:e.tabBool=!1,e.gDMapper=function(e,t,a){var o="https://www.google.com/maps/embed/v1/directions?key=AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw&destination=place_id:"+t+"&origin="+e+"&mode="+a;return y.trustAsResourceUrl(o)},e.gMapper=function(e){var t="https://www.google.com/maps/embed/v1/place?key=AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw&q=place_id:"+e+"&zoom=14";return y.trustAsResourceUrl(t)},e.mainView=!0,e.closeHud=function(){e.hudView=!1,e.prodView=!1,e.tabBool=!0},e.vrWindow=function(e){var t=o.href("app.vrviewer",{id:e});window.open(t,"_blank")},"tktr"==e.appPartner?e.colL=12:e.colL=6,e.partnerlogo="./assets/site/tktrza_logo_btn.svg",e.partnermenu="./assets/site/tktrza_menu_btn.svg",e.partnercart="./assets/site/tktrza_total_btn.svg",e.shadow="-webkit-box-shadow: 0px 8px 18px 0px rgba(17,0,0,0.8); -moz-box-shadow: 0px 8px 18px 0px rgba(17,0,0,0.8); box-shadow: 0px 8px 18px 0px rgba(17,0,0,0.8); ",e.btnshadow="-webkit-box-shadow: 0px 2px 8px 0px rgba(17,0,0,0.8); -moz-box-shadow: 0px 2px 8px 0px rgba(17,0,0,0.8); box-shadow: 0px 2px 8px 0px rgba(17,0,0,0.8); ",e.testbgf="",e.gRoute=function(e){var t=Object.keys(e.stops),a="&origin=place_id:"+e.origin+"&destination=place_id:"+e.destination+"&waypoints=";angular.forEach(t,function(t){a=a+"place_id:"+e.stops[t]+"|"});var o=a.slice(0,-1),n="https://www.google.com/maps/embed/v1/directions?key=AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw&"+o+"&zoom=14&mode="+e.mode;return y.trustAsResourceUrl(n)},e.sLink=function(e){window.open(e)},e.uirefSideNav=function(e,t){"left"==e?i.sideMenuBool=!1:"right"==e&&(i.cartBool=!1),o.go("app.category.list",{id:t})},e.mflipper=2,e.mFlipFn=function(){w(function(){e.mflipper>30?e.mflipper=0:e.mflipper++},3e3,3e3)},(d("sm")||d("xs"))&&e.mFlipFn(),e.youtubeUrl=function(e){var t="https://www.youtube.com/embed/"+e+"?autoplay=0";return y.trustAsResourceUrl(t)},e.trust=function(e){return y.trustAsResourceUrl(e)},e.colGroup=function(e){return e.length},e.closeSNav=function(t,a){"left"==t?e.showSideMenu():"right"==t&&(i.cartBool=!1)},e.mediaQuery=function(e){return d(e)},e.filters=[{icon:"assets/site/activities_btn.svg",text:"activities"},{icon:"assets/site/gamedrives_btn.svg",text:"gamedrives"},{icon:"assets/site/animalinter_btn.svg",text:"animalinter"},{icon:"assets/site/adventure_btn.svg",text:"adventure"},{icon:"assets/site/tour_btn.svg",text:"tour"}],e.cookies=function(){window.open("https://www.google.com/policies/technologies/cookies/")},e.partnersFilter={partner:!0},e.promoteFilter={promote:!0},e.termsAccepted=!1,e.toggleLeftMenu=function(){$mdSidenav("right").close(),$mdSidenav("left").open()},e.toggleRightMenu=function(){$mdSidenav("left").close(),$mdSidenav("right").toggle()},e.openPics=function(e,t){var a={images:e,key:t},o=angular.element(document.body);s.show({parent:o,templateUrl:"templates/picModal.html",locals:{imgObj:a},controller:"ImgCtrl"})},e.openAffiliate=function(t,a){if("viator"==t)window.open(a);else{var o="https://www.tiqets.com/"+e.selectedLang.lang+"/",n=o+a+"tq_campaign="+e.appPartner,i=angular.element(document.body);s.show({parent:i,templateUrl:"templates/affiliateModal.html",locals:{link:n},controller:"AffModalCtrl"})}},e.openPayModal=function(e){var t=angular.element(document.body);s.show({parent:t,templateUrl:"templates/qrModal.html",locals:{payUrl:e},controller:"QrModalCtrl"})},e.showInfo=function(e){var t=angular.element(document.body);s.show({parent:t,templateUrl:"templates/infoModal.html",locals:{info:e},controller:"InfoModalCtrl"})},e.user=!1,e.auth=b.auth.$getAuth(),e.currentNavItem="Home",e.toggleCart=function(){$mdSidenav("right").toggle()},i.previousState,i.currentState,i.$on("$stateChangeSuccess",function(e,t,a,o,n){i.previousState=o.name,i.currentState=t.name,i.previousParams=n,i.currentParams=a}),i.previousState&&(e.backBool=!0),e.siteInfo={watersports:"adrenalintitle",tables:"tablestitle",outdoors:"outdoortitle",tours:"tourstitle",rentals:"rentaltitle",contact:"contacttitle",parties:"viptitle"},e.radioShow=!1,e.radioBtn=function(){e.radioObj.paused?e.radioObj.play():e.radioObj.pause()},e.openMap=function(e){window.open(e)},e.showNav=function(){e.navHide=!e.navHide},e.gotoAnchor=function(e){var t=e;c.hash()!==t?c.hash(e):l()},e.langs=[{lang:"en",sign:"English"},{lang:"es",sign:"Castellano"}],e.selectedLang={lang:"en",sign:"English"},e.back=function(){i.fromParams?o.go(i.previousState,i.fromParams):o.go("app.home_screen.dash"),u(function(){i.stateIsLoading=!1},3e3)},e.updateLang=function(t){O.child("profiles").child(i.uid).child("l18n").set(t),h.use(t).then(function(){h(e.partner.info.writeup).then(function(t){e.intro=t.split("     ")})})},e.appAuth=b.auth.$getAuth(),e.user;var M=new GeoFire(O.child("geofire/locs"));firebase.auth().onAuthStateChanged(function(t){t&&(t.isAnonymous?(g.getUser().then(function(a){e.user=a.profile,e.appAuth=a.auth,h("privacyblock").then(function(e){v.show(v.simple().textContent(e).position("top").hideDelay(5e3))}),m.getCurrentPosition({timeout:6e4}).then(function(a){M.set(t.uid,[a.coords.latitude,a.coords.longitude]).then(function(){O.child("profiles/"+t.uid+"/location").set({lat:a.coords.latitude,lng:a.coords.longitude,location:[a.coords.latitude,a.coords.longitude]})}),e.currLoc.location=[a.coords.latitude,a.coords.longitude],e.user.location={},e.user.location.loc=[a.coords.latitude,a.coords.longitude],e.user.location.lat=a.coords.latitude,e.user.location.lng=a.coords.longitude})}),i.uid=t.uid,f(O.child("carts").child(t.uid)).$bindTo(e,"cart").then(function(e){})):(g.getUser().then(function(t){e.user=t.profile,e.appAuth=t.auth,h("privacyblock").then(function(e){v.show(v.simple().textContent(e).position("top").hideDelay(5e3))})}),f(O.child("carts").child(t.uid)).$bindTo(e,"cart").then(function(e){})))}),e.user&&!e.user.location&&m.getCurrentPosition({timeout:6e4}).then(function(t){M.set(e.user.uid,[t.coords.latitude,t.coords.longitude]).then(function(){O.child("profiles/"+e.user.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})}),e.user.location={},e.currLoc.location=[t.coords.latitude,t.coords.longitude],e.user.location.loc=[t.coords.latitude,t.coords.longitude],e.user.location.lat=t.coords.latitude,e.user.location.lng=t.coords.longitude},function(e){console.log(e)})}]).controller("LocalInfoCtrl",["$scope","$firebaseArray","Auth","$state","$rootScope","User","$stateParams","LocalInfo","$geolocation","$http",function(e,t,a,o,n,i,r,l,c,d){function s(){console.log("geoinit"),c.getCurrentPosition({timeout:6e4}).then(function(t){e.user&&(e.user.location={},e.user.location.lat=t.coords.latitude,e.user.location.lng=t.coords.longitude,e.user.location.loc=[t.coords.latitude,t.coords.longitude]),e.locOne=[t.coords.latitude,t.coords.longitude],g.child("profiles/"+e.appAuth.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]}),u(t.coords.latitude,t.coords.longitude),e.setArray(e.types.dining.array),e.loadResults("bar"),console.log("geoinited")},function(t){u(e.locOne[0],e.locOne[1]),e.setArray(e.types.health.array),e.loadResults("pharmacy"),console.log("geoinit fail")})}function u(e,t){var a={lat:e,lng:t};w=new google.maps.Map(document.getElementById("localmap"),{center:a,zoom:15}),y=new google.maps.InfoWindow}function m(t,a){if(a===google.maps.places.PlacesServiceStatus.OK)for(var o=0;o<t.length;o++)if(console.log(t[o]),t[o].photos&&t[o].photos.length>0){t[o];l.addPhoto(t[o],"mid").then(function(t){e.infoResults.push(t)})}}function f(t){var a={lat:41.377069,lng:2.172229},o={location:a,radius:e.searchRadius,query:t};service=new google.maps.places.PlacesService(w),service.textSearch(o,m)}function p(t){for(var a=0;a<e.markers.length;a++)e.markers[a].setMap(t)}function h(){p(null)}var g=firebase.database().ref();e.loaderCheck(),e.locOne=[41.377069,2.172229],!e.user||angular.isUndefined(e.user)?i.getUser().then(function(t){e.user=t.profile,e.appAuth=t.auth,s()}):s(),e.placeDist=function(t){var a,o;if(a=e.user&&e.user.location&&e.user.location.loc?e.user.location.loc:[e.locOne[0],e.locOne[1]],t&&t.geometry&&t.geometry.location.lat()&&t.geometry.location.lng()&&(o=[t.geometry.location.lat(),t.geometry.location.lng()]),a&&o)return GeoFire.distance(a,o)},e.closePlace=function(){e.currPlace=!1},e.setGInd=function(t){e.galInd=t,e.centerGal=e.placeGal[t]};var v=new google.maps.DirectionsRenderer,b=new google.maps.DirectionsService;new google.maps.Geocoder;e.galInd=0,e.placeGal=[],e.getPlaceInfo=function(t){l.placeInfo(w,t.info.place_id).then(function(t){e.currPlace=t.info,e.placeGal=t.photos,e.centerGal=t.photos[0]},function(e){console.log(e)});var a=e.locOne[0]+","+e.locOne[1];e.currDirUrl=e.gDMapper(a,t.info.place_id,"walking")},e.getDirections=function(t){l.placeInfo(w,t.info.place_id).then(function(t){e.currPlace=t.info,e.placeGal=t.photos,e.centerGal=t.photos[0]});var a=t.info,o={origin:e.locOne[0]+","+e.locOne[1],destination:a.vicinity,travelMode:google.maps.DirectionsTravelMode.WALKING};b.route(o,function(t,a){if(a===google.maps.DirectionsStatus.OK){var o=0;v.setDirections(t),v.setMap(w),console.log(t),angular.forEach(t.routes[0].legs,function(e){o+=e.distance.value}),console.log(o),e.currDistance=o/1e3,console.log(o,e.currDistance)}else alert("Directions Not Found!"),console.log(a)})},e.eventClearer(),e.searchRadius=500,e.types=l.getTypes,e.loadResults=function(t){if(e.typeRenew=t,e.infoResults=[],h(),e.currPlace=!1,"tabac"==t)return f("tabacconist");var a=new google.maps.places.PlacesService(w);a.nearbySearch({location:{lat:e.locOne[0],lng:e.locOne[1]},radius:e.searchRadius,type:[t]},m)},e.setArray=function(t){e.typeArray=t};var y,w;e.locSend={},e.currPlace,e.sendLoc=function(){g.child("profiles").child(e.appAuth.uid).child("email").set(e.locSend.email);var t={method:"POST",url:"https://7f030f01.ngrok.io/maps/"+e.appPartner+"/mail",data:{uid:e.appAuth.uid,loc:e.currPlace.vicinity},dataType:"json",headers:{"Content-Type":"application/json"}};d(t).then(function(e){alert("Thanks!")})},e.markers=[],e.infoResults=[],e.infoPics={},e.mapBool=!0,e.toggleMap=function(){e.mapBool=!e.mapBool}}]).controller("MyTixWalletCtrl",["$scope","$firebaseArray","Auth","$state","$rootScope","User","$stateParams",function(e,t,a,o,n,i,r){firebase.database().ref();e.loginObj={},i.walletLink(r.email)}]).controller("PurchaseSuccessCtrl",["$scope","$firebaseArray","Auth","$state","$rootScope","User","$stateParams",function(e,t,a,o,n,i,r){var l=(firebase.database().ref(),a.auth.$getAuth());l?o.go("app.tickets",{uid:l.uid}):e.showLogin=!0}]).controller("LoginCtrl",["$scope","$firebaseArray","Auth","$state","$rootScope","User","$stateParams","Ticketing",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref();e.signUpObj={},e.signInObj={},e.auth=a.auth.$getAuth(),e.lStage=0,e.stage1=function(){e.lStage=1},e.auth&&c.child("profiles").child(e.auth.uid).on("value",function(t){e.profile=t.val()}),e.facebookMerge=function(e){if(e&&e.authResponse){var t=firebase.auth.FacebookAuthProvider.credential(e.authResponse.accessToken);firebase.auth().currentUser.link(t).then(function(e){e&&(console.log(e),e.email&&c.child("profiles").child(e.uid).child("email").set(e.email),e.name&&c.child("profiles").child(e.uid).child("name").set(e.name),e.photoURL&&c.child("profiles").child(e.uid).child("photo").set(e.photoURL))},function(e){console.log("Error upgrading anonymous account",e)})}},FB.Event.subscribe("auth.authResponseChange",e.facebookMerge()),e.googleMerge=function(e){var t=provider.credential(e.getAuthResponse().id_token);firebase.auth().currentUser.link(t).then(function(e){e&&(console.log(e),e.email&&c.child("profiles").child(e.uid).child("email").set(e.email),e.name&&c.child("profiles").child(e.uid).child("name").set(e.name),e.photoURL&&c.child("profiles").child(e.uid).child("photo").set(e.photoURL))},function(e){console.log("Error upgrading anonymous account",e)})},e.stagePlus=function(t){e.lStage+=t},e.joinProvider=function(e){i.providerLogin(e,"pop")},e.roughIt=function(){e.profile.email=e.mergeObj.email,e.profile.name=e.mergeObj.name,
i.upNameEmail(e.mergeObj).then(function(t){console.log(t),e.profile=t,e.showPayPal=!0,e.payNow()})},e.signInClassic=function(){a.auth.$signInWithEmailAndPassword(e.signInObj.email,e.signInObj.password).then(function(t){o.go("app.home_screen.dash"),n.uid=t.uid,e.auth=t})["catch"](function(e){console.error("Authentication failed:",e)})},e.anonCont=function(){a.auth.$signInAnonymously().then(function(e){i.anonUser(e)})["catch"](function(e){console.error("Authentication failed:",e)})},e.mergeFull=function(){i.mergeFull(e.mergeObj).then(function(e){})},e.switchSignUp=function(){e.signInObj.email&&!e.signInObj.password&&e.signInObj.name?i.mergeNow(e.signInObj).then(function(e){}):e.signInObj.email&&e.signInObj.password&&e.signInObj.name?i.mergeFull(e.signInObj).then(function(e){}):e.signInObj.email&&e.signInObj.name||alert("At least an email & Name is required!")},e.mergeObj={},e.mergeNow=function(){i.mergeNow(e.mergeObj.email).then(function(e){})},e.providerMerge=function(e,t){i.mergeCompleteProvider(e)},e.logBool=!1,e.logShowFn=function(t){return e.logBool==t},e.showLog=function(t){e.logBool=t},e.logFn=function(t){return e.logBool==t?3:1},e.joinClassic=function(){a.auth.$createUserWithEmailAndPassword(e.signUpObj.email,e.signUpObj.password).then(function(t){n.uid=t.uid;var a={name:e.signUpObj.name,uid:t.uid,email:e.signUpObj.email,location:[41.380057,2.171269],voucher:e.appPartner,image:"hold"};c.child("profiles").child(t.uid).set(a),o.go("app.home_screen.dash"),e.auth=t})["catch"](function(e){console.error("Authentication failed:",e)})},e.joinFWalk=function(){var t="@@"+e.eLO.name+"@@";a.auth.$createUserWithEmailAndPassword(e.eLO.email,t).then(function(t){n.uid=t.uid;var a={name:e.eLO.name,uid:t.uid,email:e.eLO.email,location:[41.380057,2.171269],voucher:e.appPartner,image:"hold"};c.child("profiles").child(t.uid).set(a),o.go("app.home_screen.dash"),l.freeMe(t.uid,{name:e.eLO.name,email:e.eLO.email,item:{pid:"fwalk_tour","package":"fwalk_tour0"}}),e.auth=t})["catch"](function(e){console.error("Authentication failed:",e)})},e.loginObj={},e.login=function(){a.auth.$signInWithEmailAndPassword(e.signInObj.email,e.signInObj.password).then(function(t){c.child("profiles").child(t.uid).child("staff").once("value",function(e){o.go("app.admin.dash",{vendor:e.val()})}),n.uid=t.uid,e.auth=t})["catch"](function(e){console.error("Authentication failed:",e)})},e.provLogin=function(e,t){i.adminProviderLogin(e,t)},e.loaderCheck()}]).controller("SafeLoginCtrl",["$scope","$firebaseArray","Auth","$state","$rootScope","User",function(e,t,a,o,n,i){e.loginObj={},i.ssiLanding($stateParams.email),e.loginClassic=function(){i.mergeComplete(e.loginObj)},e.mergeProvider=function(e){i.mergeCompleteProvider(e)}}]).controller("InfoModalCtrl",["$scope","$mdDialog","info","$state",function(e,t,a,o){e.info=a,e.closeModal=function(){t.hide()}}]).controller("VayaModalCtrl",["$scope","$mdDialog","$state","Cart",function(e,t,a,o){var n=firebase.database().ref();e.dateObj={},e.itemMedia={},e.numbArray=[1,2,3,4,5,6,7,8,9],o.getItems().then(function(t){e.items=t,angular.forEach(t,function(t){"-KV5Z5qiB-XrRytE8_V_"==t.$id&&(e.vayaObj=t,angular.forEach(t.valid_dates,function(t,a){var o=moment(t).format("YYYY-MM-DD");e.dateObj[o]=!0}),n.child("media").child(t.$id).child("wide_branding").once("value",function(a){e.itemMedia[t.$id]=a}));var a=moment(t.time).format("YYYY-MM-DD");e.dateObj[a]=!1}),e.vayaObj.name||n.child("packages/-KV56B97r9RCS6ddIjH1/-KV5Z5qiB-XrRytE8_V_").once("value",function(t){e.vayaObj=t})}),e.newVayaQ=1,e.addVayaDay=function(t){var a=moment(t.time).format("YYYY-MM-DD");e.vayaObj.valid_dates[a]=e.newVayaQ[t.$id]},e.vayaObj={},e.addVaya=function(){n.child("carts").child("-KV5Z5qiB-XrRytE8_V_").set(e.vayaObj)}}]).controller("ImgCtrl",["$scope","$mdDialog","imgObj","$state","$mdMedia",function(e,t,a,o,n){e.modalImages=a.images,e.showIndex=0;var i=0;angular.forEach(a.images,function(t){t.id==a.key?e.showIndex=i:i++}),e.centerImg=function(){return e.modalImages[e.showIndex].url},e.closeModal=function(){t.hide()},e.indexShift=function(t){var a=e.showIndex+t;a>e.modalImages.length-1?e.showIndex=0:a<0?e.showIndex=e.modalImages.length-1:e.showIndex=a}}]).controller("VoucherCtrl",["$scope","Auth","$state","$rootScope",function(e,t,a,o){var n=firebase.database().ref();e.voucher={code:""},e.minionArray=[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18];var i=t.auth.$getAuth();e.setMinion=function(t){e.voucher.code=t,e.saveAccept()},e.saveAccept=function(){var r="min"+e.voucher.code;i?(n.child("profiles").child(i.uid).child("termsAccepted").set(!0),n.child("profiles").child(i.uid).child("voucher").set(r),a.go("app.home_screen.dash")):t.auth.$signInAnonymously().then(function(t){e.user=t,e.authBool=!0,o.uid=t.uid,n.child("profiles").child(t.uid).set({name:"Guest",uid:t.uid,voucher:r,termsAccepted:!0}),a.go("app.home_screen.dash")})["catch"](function(e){console.error("Authentication failed:",e)})},e.closeModal=function(){$mdDialog.hide()}}]).controller("AffModalCtrl",["$scope","$mdDialog","link","$state","$sce",function(e,t,a,o,n){e.affLink=n.trustAsResourceUrl(a),e.closeModal=function(){t.hide()}}]).controller("QrModalCtrl",["$scope","$mdDialog","payUrl","$state","$mdMedia",function(e,t,a,o,n){e.qrPPUrl=a,e.closeModal=function(){t.hide()}}]).controller("VrModalCtrl",["$scope","$mdDialog","vrObj","$state","$timeout",function(e,t,a,o,n){e.modalSpheres=[],e.showIndex=0;var i=-1;e.loadVR=function(e){new PhotoSphereViewer({panorama:e.url,container:"mview",time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},angular.forEach(a.spheres,function(t){i<0&&(i=0),t.id==a.key?e.showIndex=i:i++,e.modalSpheres.push(t)}),e.closeModal=function(){t.hide()},e.vrShift=function(t){var a=e.showIndex+t;a>e.modalSpheres.length-1?(e.showIndex=0,e.loadVR(e.modalSpheres[e.showIndex])):a<0?(e.showIndex=e.modalSpheres.length-1,e.loadVR(e.modalSpheres[e.showIndex])):(e.showIndex=a,e.loadVR(e.modalSpheres[e.showIndex])),console.log(e.modalSpheres,t,a,e.showIndex,e.modalSpheres[e.showIndex])},e.sphereTarget=document.getElementById("mview"),e.modalSpheres&&e.sphereTarget&&i>=0?e.loadVR(e.modalSpheres[i]):n(function(){e.loadVR(e.modalSpheres[i])},1e3)}]).controller("AdminStockCtrl",["$scope","$stateParams","$firebaseArray","$firebaseObject","AdminTools","$mdDialog",function(e,t,a,o,n,i){var r=(firebase.database().ref("media"),firebase.database().ref()),l=(new GeoFire(r.child("geofire/vendors")),new GeoFire(r.child("geofire/vendors/"+t.vendor)));e.stockObj={},a(r.child("info").orderByChild("vendor").equalTo(t.vendor)).$loaded(function(t){e.stockTypes=t,angular.forEach(t,function(t){o(r.child("static_stock").child(t.$id)).$loaded(function(a){e.stockObj[t.$id]=a})})}),e.adminLoaded(),a(r.child("vendor_locations").orderByChild("vendor").equalTo(t.vendor)).$loaded(function(t){e.stores=t,angular.forEach(t,function(e){l.set(e.$id,e.location)})}),e.editBool={},e.editValue=function(t,a){var o={key:t,dayKey:a,id:e.stockProd.$id},n=angular.element(document.body);i.show({parent:n,templateUrl:"templates/stockModal.html",locals:{dayObj:o},controller:"StockModalCtrl"})},e.dayKeys=[];for(var c=(moment().format("YYYY-MM-DD"),0);c<=6;c++){var d=moment().clone().add(c,"days").format("YYYY-MM-DD");e.dayKeys.push(d)}e.currStock,e.stockType={},e.storeLoc={},e.stockRepeater=1,e.generateStock=function(){for(var o=new GeoFire(r.child("geofire/stock").child(e.stockType.$id)),n=a(r.child("stock").child(e.stockType.$id)),i=e.stockRepeater;i>=0;i--){var l={vendor:t.vendor,product:e.stockType.$id,vendor_location:e.storeLoc.$id,stockNo:i};console.log(newItem);var c=[e.storeLoc.location.lat,e.storeLoc.location.lng];n.$add(l).then(function(e){o.set(e.key,c)},function(e){})}},e.addTime=function(t){var a={dayKey:t,id:e.stockProd.$id},o=angular.element(document.body);i.show({parent:o,templateUrl:"templates/newstockmodal.html",locals:{dayObj:a},controller:"NewStockModalCtrl"})},e.prettyDate=function(e){return moment(e).format("lll")},e.prettyTime=function(e){var t=e.split("-"),a=t[0]+":"+t[1];return a}}]).controller("StockModalCtrl",["$scope","$mdDialog","dayObj","$state","$mdMedia","$firebaseObject",function(e,t,a,o,n,i){var r=firebase.database().ref();i(r.child("static_stock").child(a.id).child(a.dayKey).child(a.key)).$bindTo(e,"editAval").then(function(){}),e.closeModal=function(){t.hide()},e.saveCloseModal=function(){t.hide()}}]).controller("NewStockModalCtrl",["$scope","$mdDialog","dayObj","$state","$mdMedia","$firebaseObject",function(e,t,a,o,n,i){var r=firebase.database().ref();if(e.newStocktime={},e.hourArr=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],e.minArr=["00","15","30","45"],e.newTime={},a.time){var l=a.time.split("-");e.newTime.hour=l[0],e.newTime.minutes=l[1]}e.closeModal=function(){t.hide()},e.newAval={repeat:!1},e.saveCloseModal=function(){if(e.newAval.repeat_weekly&&e.newAval.repeats)for(var o=e.newAval.repeats;o>=0;o--){var n=moment(a.dayKey).clone().add(o,"weeks").format("YYYY-MM-DD"),i=e.newTime.hour+"-"+e.newTime.minutes;r.child("static_stock").child(a.id).child(n).child(i).set({available:e.newAval.available,capacity:e.newAval.capacity})}else if(e.newAval.repeat_daily&&e.newAval.repeats)for(var o=7*e.newAval.repeats;o>=0;o--){var n=moment(a.dayKey).clone().add(o,"days").format("YYYY-MM-DD"),i=e.newTime.hour+"-"+e.newTime.minutes;r.child("static_stock").child(a.id).child(n).child(i).set({available:e.newAval.available,capacity:e.newAval.capacity})}else{var n=moment(a.dayKey).format("YYYY-MM-DD"),i=e.newTime.hour+"-"+e.newTime.minutes;r.child("static_stock").child(a.id).child(n).child(i).set({available:e.newAval.available,capacity:e.newAval.capacity})}t.hide()}}]).controller("MultiStockModalCtrl",["$scope","$mdDialog","dayObj","$state","$mdMedia","$firebaseObject",function(e,t,a,o,n,i){var r=firebase.database().ref();e.newStocktime={};var l=[9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],c=["00",15,30,45];e.hours=[],angular.forEach(l,function(t){angular.forEach(c,function(a){e.hours.push(t+":"+a)})}),e.newTimes=[],e.pushTime=function(t){console.log(t),e.newTimes.push(t),e.stCheck[t]=!0},e.closeModal=function(){t.hide()},e.newAval={repeat:!1},e.saveCloseModal=function(){e.newAval.repeat_weekly&&e.newAval.repeats?angular.forEach(e.newTimes,function(t){console.log(t);var o=t.split(":");console.log(o);for(var n=e.newAval.repeats;n>=0;n--){var i=moment(a.dayKey).clone().add(n,"weeks").format("YYYY-MM-DD"),l=o[0]+"-"+o[1];r.child("static_stock").child(a.id).child(i).child(l).set({available:e.newAval.available,capacity:e.newAval.capacity})}}):e.newAval.repeat_daily&&e.newAval.repeats?angular.forEach(e.newTimes,function(t){for(var o=t.split(":"),n=7*e.newAval.repeats;n>=0;n--){var i=moment(a.dayKey).clone().add(n,"days").format("YYYY-MM-DD"),l=o[0]+"-"+o[1];r.child("static_stock").child(a.id).child(i).child(l).set({available:e.newAval.available,capacity:e.newAval.capacity})}}):angular.forEach(e.newTimes,function(t){var o=t.split(":"),n=moment(a.dayKey).format("YYYY-MM-DD"),i=o[0]+"-"+o[1];r.child("static_stock").child(a.id).child(n).child(i).set({available:e.newAval.available,capacity:e.newAval.capacity})}),t.hide()}}]).controller("RoomEditCtrl",["$scope","$stateParams","$firebaseArray","$firebaseObject","AdminTools",function(e,t,a,o,n){var i=(firebase.database().ref("media"),firebase.database().ref()),r=a(i.child("rooms").orderByChild("vendor").equalTo(t.vendor));r.$loaded(function(t){e.rooms=t}),e.adminLoaded(),e.newRoom={beds:1},e.newRoomTypeSel={};var l=a(i.child("accomm").orderByChild("vendor").equalTo(t.vendor));l.$loaded(function(t){e.accomTypes=t}),e.newRoomType={},e.deleteRoom=function(e){r.$remove(e)},e.rangeMe=function(e){for(var t=[],a=1;a<=e;)t.push(a),a++;return t},e.saveNewRoomType=function(){e.newRoomType.vendor=t.vendor,e.newRoomType.tag="room",n.newRoomType(e.newRoomType)},e.bedOpts=["single","double","single_bunk","double_bunk"],e.newBeds={},e.saveNewRoom=function(){e.newRoom.vendor=t.vendor,e.newRoom.pp_price=e.newRoomTypeSel.bed_price,e.newRoom.room_type=e.newRoomTypeSel.$id,e.newRoom.occupancy=e.newRoomTypeSel.occupancy,e.newRoom.tag="room",n.newRoom(e.newRoom,e.newBeds)}}]).controller("MediaEditCtrl",["$scope","$stateParams","$firebaseArray","$firebaseObject","$sce",function(e,t,a,o,n){var i=firebase.database().ref("media"),r=firebase.database().ref();e.editObj={},e.editMedium="branding",e.mediaObj={},e.currentEdit="";var l=firebase.storage().ref();o(i).$loaded(function(t){e.mediaObj=t,e.adminLoaded()}),e.preview=function(t,a){a?e.currentEdit=e.editObj[t][a].url:e.currentEdit=e.editObj[t]},e.preVr=function(e){new PhotoSphereViewer({panorama:e,container:"previewer",time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.siteColours={},e.setGradient=function(t){switch(t){case 100:r.child("sites").child(e.editObj.pid).child("grad100").set(e.siteColours.grad100);break;case 50:r.child("sites").child(e.editObj.pid).child("grad50").set(e.siteColours.grad50);break;case 25:r.child("sites").child(e.editObj.pid).child("grad25").set(e.siteColours.grad25)}r.child("sites").child(e.editObj.pid).child("accfade").set(fadeclass)},e.setColour=function(t,a){var o=a.slice(0,-2);if("accent"==t){if(o){var n=o+",0.3)",i="background-color: rgba("+n+";";r.child("sites").child(e.editObj.pid).child("accfade").set(i)}r.child("sites").child(e.editObj.pid).child("rgbaaccentcode").set("rgba("+a+")");var l="background-color: rgba("+o+",0.1); ";r.child("sites").child(e.editObj.pid).child("accent").set(l)}else if("color"==t){r.child("sites").child(e.editObj.pid).child("hex").set("rgba("+a+")");var c="background-color: rgba("+o+",0.75); ";r.child("sites").child(e.editObj.pid).child("bgf").set("background-image: url('assets/site/vaya_bgs.jpg');"),r.child("sites").child(e.editObj.pid).child("rgba").set(c)}var d="background: rgba("+a+"); ";r.child("sites").child(e.editObj.pid).child(t).set(d)},e.upload=function(t,a,o){var n=l.child("media").child(e.editObj.pid).child(o.name).put(o);n.on("state_changed",function(e){},function(e){},function(){var o=n.snapshot.downloadURL;i.child(e.editObj.pid).child(t).child(a).child("url").set(o),e.currentEdit=o})},e.hb={url:""},e.uploadHb=function(t){e.hb.url&&(i.child(e.editObj.pid).child("hb").set(e.hb.url),r.child("info").child(e.editObj.pid).child("hb").set(e.hb.url))},e.uploadBoxBranding=function(t){if(t){var a=l.child("media").child(e.editObj.pid).child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;i.child(e.editObj.pid).child("box_branding").set(t),r.child("info").child(e.editObj.pid).child("box_branding").set(t),e.currentEdit=t})}},e.uploadEmailHeader=function(t){if(t){var a=l.child("media").child(e.editObj.pid).child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;i.child(e.editObj.pid).child("email_header").set(t),r.child("info").child(e.editObj.pid).child("email_header").set(t),e.currentEdit=t})}},e.uploadWideBranding=function(t){if(t){var a=l.child("media").child(e.editObj.pid).child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;i.child(e.editObj.pid).child("wide_branding").set(t),r.child("info").child(e.editObj.pid).child("wide_branding").set(t),e.currentEdit=t})}},e.uploadBranding=function(t){if(t){var a=l.child("media").child(e.editObj.pid).child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;i.child(e.editObj.pid).child("branding").set(t),r.child("info").child(e.editObj.pid).child("branding").set(t),e.currentEdit=t})}},e.uploadPartnerLogo=function(t){var a=l.child("media").child(e.editObj.pid).child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;i.child(e.editObj.pid).child("partner_logo").set(t),r.child("info").child(e.editObj.pid).child("partner_logo").set(t),e.editObj.logo&&r.child("partners").child(e.editObj.pid).child("logo").set(t),e.currentEdit=t})},e.uploadLogo=function(t){var a=l.child("media").child(e.editObj.pid).child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;i.child(e.editObj.pid).child("logo").set(t),r.child("info").child(e.editObj.pid).child("logo").set(t),$cope.editObj.logo&&r.child("partners").child(e.editObj.pid).child("logo").set(t),e.currentEdit=t})},e.changeOrder=function(t,a){e.editObj;i.child(e.editObj.pid)},e.uploadNew=function(t,o){if(o){var r=l.child("media").child(e.editObj.pid).child(o.name).put(o);r.on("state_changed",function(e){},function(e){},function(){var o=r.snapshot.downloadURL,n={url:o,title:e.newMedia.title};a(i.child(e.editObj.pid).child(t)).$add(n),e.currentEdit=o,e.newMedia={}})}else if(e.newMedia.url){var c={url:e.newMedia.url,title:e.newMedia.title};a(i.child(e.editObj.pid).child(t)).$add(c),e.newMedia={},e.currentEdit=n.trustAsResourceUrl(c.url)}},e["delete"]=function(t,a){o(i.child(e.editObj.pid).child(t).child(a)).$remove()},e.saveObj=function(t,a){o(i.child(e.editObj.pid).child(t)).$save(e.editObj[t][a]),e.saveBool=!1},e.refresh=function(t){o(i.child(e.editObj.pid).child(t)).$loaded()},e.edit=function(t){e.editObj=e.mediaObj[t],e.editObj.pid=t},e.saveBool=!1,e.newMedia={},e.uploadStill=function(t,a,o){var n=l.child("media").child(e.editObj.pid).child(o.name).put(o);n.on("state_changed",function(e){},function(e){},function(){var o=n.snapshot.downloadURL;e.editObj[t][a].url=o,e.currentEdit=o})}}]).controller("VendorDashCtrl",["$scope","$firebaseArray","$firebaseObject","$stateParams",function(e,t,a,o){}]).controller("PacksCtrl",["$scope","$firebaseArray","$firebaseObject","$stateParams",function(e,t,a,o){var n=firebase.database().ref();e.loadPack=function(o){t(n.child("media").child(o.$id).child("images")).$loaded(function(t){e.packGal=t}),angular.forEach(o.tkts,function(t,o){a(n.child("info").child(o)).$loaded(function(t){e.packData[o]=t}),a(n.child("media").child(o)).$loaded(function(t){e.packMedia[o]=t})})},e.objGals={},t(n.child("tkts")).$loaded(function(a){e.tkts=a,angular.forEach(a,function(a){t(n.child("media").child(a.$id).child("images")).$loaded(function(t){e.objGals[a.$id]=t})})});var i=t(n.child("info").orderByChild("tktrpack").equalTo(!0));i.$loaded(function(t){e.packs=t,e.prepareGalleries(),e.pack=i.$getRecord(o.id),e.loadPack(e.pack)}),e.packMedia={},e.packData={},e.gridId="",e.gridSelector=function(t){e.gridId=t},e.gridWatcher=function(t){return t==e.gridId?2:1},e.galleries={},e.prepareGalleries=function(){angular.forEach(e.packs,function(a){a.tktrpack&&t(n.child("media").child(a.$id).child("images")).$loaded(function(t){e.galleries[a.$id]=t})}),e.startPackRotate()},e.imgInds={pack1:0,pack2:0,pack3:0,pack4:0},e.startPackRotate=function(){$interval(function(){e.imgInds.pack1<3?e.imgInds.pack1++:e.imgInds.pack1=0},3500),$interval(function(){e.imgInds.pack2<3?e.imgInds.pack2++:e.imgInds.pack2=0},3200),$interval(function(){e.imgInds.pack3<3?e.imgInds.pack3++:e.imgInds.pack3=0},2700),$interval(function(){e.imgInds.pack4<3?e.imgInds.pack4++:e.imgInds.pack4=0},3700)}}]).controller("TimeoutCtrl",function(e,t){e.events=[],e.$on("IdleStart",function(){console.log("idle")}),e.$on("IdleWarn",function(e,t){}),e.$on("IdleTimeout",function(){}),e.$on("IdleEnd",function(){}),e.$on("Keepalive",function(){})}).controller("MenuCtrl",["$scope","$firebaseArray","$firebaseObject","$stateParams","$sce","Cart","$mdMedia","$interval",function(e,t,a,o,n,i,r,l){function c(o){d=t(u.child("menu_items")),d.$loaded(function(t){e.menuItems=t,e.loaded(),console.log(t)}),a(u.child("restaurants").child(o)).$loaded(function(t){e.restaurant=t})}e.videos=[],e.menuId="",e.selItem={};var d;e.order={total:0,items:{},partner:e.appPartner,roomNo:null,name:null},e.selCat="",e.selectCat=function(t){e.selCat=t},e.tempItem={},e.menuCats=["noodles","sushi","drinks","starters"],e.menuSelector=function(t){(r("xs")||r("sm"))&&e.gotoAnchor(t),e.menuId=t},e.menuWatcher=function(t){return t==e.menuId},e.closeItemUnder=function(){e.selItem={}},e.menuGrid=function(t){return(r("xs")||r("sm"))&&t==e.menuId?2:1},e.selectThis=function(t){e.selItem=t,console.log(t)},e.menuMobile=function(t){return!r("xs")&&!r("sm")||t==e.menuId},e.delQ=function(t,a){!e.delObj.items[t]&&a>0?(e.delObj.items[t]=d.$getRecord(t),e.delObj.items[t].quantity=a,e.delObj.total?e.delObj.total=e.delObj.items[t].price*a:e.delObj.total+=e.delObj.items[t].price*a):e.delObj.items[t].quantity+a==0?(null==e.delObj.items[t],e.delObj.total+=e.delObj.items[t].price*a):(e.delObj.items[t].quantity+=a,e.delObj.total+=e.delObj.items[t].price*a)},e.mediaBool="img";var s=!1;e.init=function(t){e.paramKey=t,s=!0};var u=firebase.database().ref();e.mFilt={tag:o.cat},e.menuFilter=function(t){e.mFilt={tag:t}},e.delObj={items:{},total:0,vendor:e.paramKey},e.appPartner&&!s?(e.paramKey=e.appPartner,c(e.paramKey)):e.appPartner&&s&&c(e.paramKey),e.addDelivery=function(){i.addDelivery(e.delObj)},o.cat&&(e.paramCat=o.cat)}]).controller("MediaCtrl",["$scope","MediaService","$firebaseArray","$firebaseObject","$stateParams","$sce","$timeout",function(e,t,a,o,n,i,r){e.videos=[],e.paramKey,e.mediaBool="img",e.initBool=!1,n.id?e.paramKey=n.id:!n.id&&e.appPartner&&(e.paramKey=e.appPartner),e.initMedia=function(t){e.paramKey=t,loadMedia(),e.initBool=!0},e.mediaColFn=function(t){if(e.mediaBool&&e.partner&&e.partner.classes)return e.mediaBool==t?e.partner.classes.accent:e.partner.classes.color},e.brander=function(e){return 0==e?"2:1":"4:3"},e.setBool=function(t){e.mediaBool=t,"clear"==t?e.mediaBool=!1:(e.gotoAnchor("media"),"sphere"==t&&r(function(){e.loadVR(e.vrGal[0])},500))},e.vrIndex=0,e.vrShift=function(t){if(0==t)e.vrIndex=[Math.floor(Math.random()*e.vrGal.length)],e.loadVR(e.vrGal[e.vrIndex]);else{var a=e.vrIndex+t;a>e.vrGal.length-1?(e.vrIndex=0,e.loadVR(e.vrGal[e.vrIndex])):a<0?(e.vrIndex=e.vrGal.length-1,e.loadVR(e.vrGal[e.vrIndex])):(e.vrIndex=a,e.loadVR(e.vrGal[e.vrIndex]))}},e.hideBranding=function(t){return!angular.equals(e.media.wide_branding,t)},e.showMedia=function(t){return e.mediaBool==t},e.colGroup=function(e){return e.length>3?e.length:4},n.id&&!e.initBool?e.paramKey=n.id:n.id||!e.appPartner||e.initBool?e.initBool:e.paramKey=e.appPartner,e.colGen=function(e,t,a){return e||t||a?2:1};firebase.database().ref();e.rhIndex=function(){return 0==e.showIndex?"2:1":"4:3"},e.gallery=[],e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},e.gvrs=[],e.sourceArr=[];e.paramKey&&t.getMedia(e.paramKey).then(function(t){e.media=t,angular.forEach(t.images,function(t,a){t.id=a,e.gallery.push(t),e.centerImg=e.gallery[0]}),angular.forEach(t.gvr,function(t,a){var o=t;o.id=a,o.url=i.trustAsResourceUrl(t.url),e.gvrs.push(o)}),angular.forEach(t.video,function(t,a){var o=t;o.id=a,e.videos.push(o),e.sourceArr.push({src:i.trustAsResourceUrl(o.url),type:"video/mp4"})}),angular.forEach(t.vr,function(t,a){var o=t;o.id=a,e.vrGal.push(t)}),e.config={autohide:!0,autohideTime:1,autoPlay:!0,sources:e.sourceArr,theme:"bower_components/videogular-themes-default/videogular.css",plugins:{poster:e.media.wide_branding}}}),e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partnerMedia.partner_logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.colSquare=function(e){return e.length%2==e.length%3?3:e.length%2==0&&e.length%2!=e.length%3?2:e.length%3==0&&e.length%2!=e.length%3?3:void 0},e.loadImg=function(t){e.centerImg=t},e.indexShift=function(t,a){if(0==a)e.showIndex=[Math.floor(Math.random()*t.length)];else{var o=e.showIndex+a;o>t.length-1?e.showIndex=0:o<0?e.showIndex=t.length-1:e.showIndex=o}},e.showIndex=0}]).controller("PartnerMediaCtrl",["$scope","MediaService","$firebaseArray","$firebaseObject","$stateParams","$sce","$timeout",function(e,t,a,o,n,i,r){function l(t){e.media=t,angular.forEach(t.images,function(t,a){t.id=a,e.gallery.push(t),e.centerImg=e.gallery[0]}),angular.forEach(t.gvr,function(t,a){var o=t;o.id=a,o.url=i.trustAsResourceUrl(t.url),e.gvrs.push(o)}),angular.forEach(t.video,function(t,a){var o=t;o.id=a,e.videos.push(o),e.sourceArr.push({src:i.trustAsResourceUrl(o.url),type:"video/mp4"})}),angular.forEach(t.vr,function(t,a){var o=t;o.id=a,e.vrGal.push(t)})}e.videos=[],e.paramKey,e.mediaBool="img",e.initBool=!1,e.mediaColFn=function(t){if(e.mediaBool&&e.partner&&e.partner.classes)return e.mediaBool==t?e.partner.classes.accent:e.partner.classes.color},e.brander=function(e){return 0==e?"2:1":"4:3"},e.setBool=function(t){e.mediaBool=t,"sphere"==t&&r(function(){e.loadPMVR(e.vrGal[0])},500)},e.setIndex=function(t){e.showIndex=t},e.vrIndex=0,e.vrShift=function(t){if(0==t)e.vrIndex=[Math.floor(Math.random()*e.vrGal.length)],e.loadPMVR(e.vrGal[e.vrIndex]);else{var a=e.vrIndex+t;a>e.vrGal.length-1?(e.vrIndex=0,e.loadPMVR(e.vrGal[e.vrIndex])):a<0?(e.vrIndex=e.vrGal.length-1,e.loadPMVR(e.vrGal[e.vrIndex])):(e.vrIndex=a,e.loadPMVR(e.vrGal[e.vrIndex]))}},e.hideBranding=function(t){return!angular.equals(e.media.wide_branding,t)},e.showMedia=function(t){return e.mediaBool==t},e.colGroup=function(e){return e.length>3?e.length:4},n.id&&!e.initBool?e.paramKey=n.id:n.id||!e.appPartner||e.initBool?e.initBool:e.paramKey=e.appPartner,e.colGen=function(e,t,a){return e||t||a?2:1};firebase.database().ref();e.rhIndex=function(){return 0==e.showIndex?"2:1":"4:3"},e.gallery=[],e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},e.gvrs=[],e.sourceArr=[];t.getMedia(e.appPartner).then(function(e){e?l(e):t.getMedia("tktr").then(function(e){l(e)})}),e.sphereMode=!1,e.sphereIndex=0,e.vrInit=function(){r(function(){e.vrShift(1)},1500)},e.loadPMVR=function(t){angular.isUndefined(e.psv)?e.psv=new PhotoSphereViewer({panorama:t.url,container:"pmviewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:90,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!0,gyroscope:!0,auto_rotate:!0,transition:{duration:500,loader:!0,blur:!0},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}}):e.psv.setPanorama(t.url,{},!0)},e.colSquare=function(e){return e.length%2==e.length%3?3:e.length%2==0&&e.length%2!=e.length%3?2:e.length%3==0&&e.length%2!=e.length%3?3:void 0},e.loadImg=function(t){e.centerImg=t},e.indexShift=function(t,a){if(0==a)e.showIndex=[Math.floor(Math.random()*t.length)];else{var o=e.showIndex+a;o>t.length-1?e.showIndex=0:o<0?e.showIndex=t.length-1:e.showIndex=o}},e.showIndex=0}]).controller("ScreenMediaCtrl",["$scope","$firebaseArray","$firebaseObject","$stateParams","$sce",function(e,t,a,o,n){function i(){a(r.child("media/"+e.paramKey)).$loaded(function(t){e.media=t;var a={url:t.wide_branding};e.gallery.push(a),angular.forEach(t.images,function(t,a){t.id=a,e.gallery.push(t),e.centerImg=e.gallery[0]}),angular.forEach(t.gvr,function(t,a){var o=t;o.id=a,o.url=n.trustAsResourceUrl(t.url),e.gvrs.push(o)}),angular.forEach(t.video,function(t,a){var o=t;o.id=a,e.videos.push(o)}),angular.forEach(t.vr,function(t,a){var o=t;o.id=a,e.vrGal.push(t)})})}e.videos=[],e.paramKey,e.mediaBool="img",e.initBool=!1,e.initMedia=function(t){t&&(e.paramKey=t,i(),e.initBool=!0)},e.mediaColFn=function(t){if(e.mediaBool&&e.partner&&e.partner.classes)return e.mediaBool==t?e.partner.classes.accent:e.partner.classes.color},e.brander=function(e){return 0==e?"2:1":"4:3"},e.setBool=function(t){e.mediaBool=t,"vr"==t&&e.loadVR(e.vrGal[0])},e.hideBranding=function(t){return!angular.equals(e.media.wide_branding,t)},e.showMedia=function(t){return e.mediaBool==t},e.colGroup=function(e){return e.length>3?e.length:4},console.log(e.paramKey),console.log(e.paramKey),console.log(e.paramKey),e.colGen=function(e,t,a){return e||t||a?2:1};var r=firebase.database().ref();e.rhIndex=function(){return 0==e.showIndex?"2:1":"4:3"},e.gallery=[],e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},e.gvrs=[],e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.colSquare=function(e){return e.length%2==e.length%3?3:e.length%2==0&&e.length%2!=e.length%3?2:e.length%3==0&&e.length%2!=e.length%3?3:void 0},e.loadImg=function(t){e.centerImg=t},e.indexShift=function(t){var a=e.showIndex+t;a>e.gallery.length-1?e.showIndex=0:a<0?e.showIndex=e.gallery.length-1:e.showIndex=a},e.showIndex=0,e.paramKey||(e.paramKey=e.appPartner)}]).controller("RecsCtrl",["$scope","$mdDialog","$firebaseArray","$firebaseObject",function(e,t,a,o){var n=firebase.database().ref();e.recs=[],a(n.child("recommendations")).$loaded(function(t){e.recs=t})}]).controller("RoomCtrl",["$scope","$firebaseObject","$firebaseArray","Booking","$interval","$stateParams","$mdpDatePicker","$mdMedia",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref();t(c.child("bkginfo").child(e.appPartner)).$loaded(function(t){e.accomInfo=t}),a(c.child("beds").orderByChild("vendor").equalTo(e.appPartner)).$loaded(function(t){e.roomBeds=t,e.calendar=[];for(var a=(moment(),0);a<30;a++)e.calendar.push(moment().add(a,"days").format("YYYY-MM-DD"))}),t(c.child("accomm").child(i.id)).$loaded(function(o){e.roomInfo=o,t(c.child("info").child(o.vendor)).$loaded(function(t){e.hostelInfo=t}),a(c.child("rooms").orderByChild("room_type").equalTo(i.id)).$loaded(function(t){e.rooms=t})}),e.bookingUrl=function(t){var a="app.room.book({id:"+t+", date: "+moment(e.booking.start_date).format("YYYY-MM-DD")+"end: "+moment(e.booking.end_date).format("YYYY-MM-DD")+", people: "+e.booking.quantity+"  })";return a},e.booking={start_date:"",end_date:""},e.showDatePicker=function(t){r(e.currentDate,{targetEvent:t}).then(function(e){})},e.roomResults=[],e.roomFilter={bookings:{}},e.calCodes=function(t){var a=!0;return angular.forEach(e.roomBeds,function(e){e.bookings&&e.bookings[t]&&(a=!1)}),a?"-webkit-box-shadow: inset 0px -2px 54px -9px rgba(18,212,0,1);-moz-box-shadow: inset 0px -2px 54px -9px rgba(18,212,0,1);box-shadow: inset 0px -2px 54px -9px rgba(18,212,0,1);":"-webkit-box-shadow: inset 0px -2px 54px -9px rgba(212,42,0,1);-moz-box-shadow: inset 0px -2px 54px -9px rgba(212,42,0,1);box-shadow: inset 0px -2px 54px -9px rgba(212,42,0,1);"},e.searchRooms=function(){for(var t=[],a=moment(e.booking.start_date).clone().startOf("day"),o=moment(e.booking.end_date).clone().startOf("day");a.add("days",1).diff(o)<0;)e.roomFilter.bookings[a.format("YYYY-MM-DD")]=!1,t.push(a.clone().toDate())},e.indexShift=function(t){var a=e.showIndex+t;a>e.pGal.length-1?e.showIndex=0:a<0?e.showIndex=e.pGal.length-1:e.showIndex=a},e.showIndex=0,e.gallery=[],e.gvrs=[],e.vrGal=[],t(c.child("media/"+i.id)).$loaded(function(t){e.media=t;var a;a=t.wide_branding?{url:t.wide_branding}:{url:"./assets/site/roomplaceholder.jpg"},e.gallery.push(a),angular.forEach(t.images,function(t,a){t.id=a,e.gallery.push(t),e.centerImg=e.gallery[0]}),angular.forEach(t.gvr,function(t,a){obj=t,obj.id=a,obj.url=$sce.trustAsResourceUrl(t.url),e.gvrs.push(obj)}),angular.forEach(t.vr,function(t,a){t.id=a,e.vrGal.push(t)}),e.vrGal[0]&&e.loadVR(e.vrGal[0])}),e.defaultImg="./assets/site/roomplaceholder.jpg",i.date&&(e.booking={start_date:i.date,end_date:i.end,people:i.people}),e.loadBeds=function(a){for(var a=a,o=[],n=moment(a.start_date).clone().startOf("day"),i=moment(a.end_date).clone().startOf("day");n.add("days",1).diff(i)<0;)o.push(n.clone().toDate());
t(c.child("bookings/"+e.appPartner).startAt(n.format("YYYY-MM-DD")).endAt(i.format("YYYY-MM-DD"))).$loaded(function(t){e.bookings=t,angular.forEach(e.rooms,function(t,a){var n=!1,i=a;t.id=a,angular.forEach(o,function(t){var a=moment(t).format("YYYY-MM-DD");e.bookings[a]&&e.bookings[a][i]&&(n=!0)}),n||e.results.push(t)})})}}]).controller("BookingCtrl",["$scope","$firebaseObject","$firebaseArray","Booking","$interval","$stateParams","$mdpDatePicker","Stock","$mdMedia",function(e,t,a,o,n,i,r,l,c){var d=firebase.database().ref();e.showDatePicker=function(t){r(e.currentDate,{targetEvent:t}).then(function(e){})},e.roomResults=[],t(d.child("rooms").orderByChild("vendor").equalTo(e.appPartner)).$loaded(function(t){e.rooms=t}),t(d.child("accomm").orderByChild("vendor").equalTo(e.appPartner)).$loaded(function(t){e.roomInfo=t}),e.loadBeds=function(){l.checkRooms(e.booking).then(function(t){e.roomResults=t})},e.roomImg=function(t){var a=e.rooms[t];if(a){var o=e.roomInfo[a.room_type];return o?o.wide_branding:"./assets/site/roomplaceholder.jpg"}},i.date&&i.end&&i.people?(e.booking={start_date:i.date,end_date:i.end,quantity:i.people},e.loadbeds()):e.booking={start_date:"",end_date:""},e.gridId="",e.gridSelector=function(t){e.gridId=t},e.gridWatcher=function(t){return t==e.gridId?2:1},e.gridMobile=function(t){return!c("xs")&&!c("sm")||t==e.gridId},e.tktrRewards=[],t(d.child("info/-KTnRahHfraR-jJZMtyS")).$loaded(function(t){e.tktrRewards.push(t)}),t(d.child("info/guelltapas")).$loaded(function(t){e.tktrRewards.push(t)}),t(d.child("info/ons")).$loaded(function(t){e.tktrRewards.push(t)}),e.tellMeMore=function(){e.tktrInfo=!e.tktrInfo},e.bookingLevels=[0,1,2,3,4]}]).controller("HomeVrCtrl",["$scope","$firebaseObject","$firebaseArray","$stateParams","$sce",function(e,t,a,o,n){var i=firebase.database().ref();e.gvrs=[],e.vrGal=[],t(i.child("info").child(o.id).child("hb")).$loaded(function(t){e.vrUrl=n.trustAsResourceUrl(t.$value),e.loaded()}),t(i.child("media/"+o.id)).$loaded(function(t){e.media=t,angular.forEach(t.gvr,function(t,a){var o=t;o.id=a,o.url=n.trustAsResourceUrl(t.url),e.gvrs.push(o)}),angular.forEach(t.vr,function(t,a){var o=t;o.id=a,e.vrGal.push(t)}),e.vrGal[0]&&(e.loadVR(e.vrGal[0]),e.loaded())}),e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"soloviewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.colGroup=function(e){return e.length}}]).controller("ScreenMenuCtrl",["$scope","$http","$firebaseObject","$firebaseArray","Auth","$timeout","$stateParams","Cart","$sce","$interval","$mdMedia","$rootScope","$geolocation","$state","Stock","$mdDialog","$anchorScroll","$location",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v){function b(t){miArr=o(y.child("menu_items").orderByChild("vendor").equalTo(t)),miArr.$loaded(function(t){e.menuItems=t,angular.forEach(t,function(t){"drinks"==t.tag&&e.menuDrinks.push(t)}),e.loaded()}),a(y.child("restaurants").child(t)).$loaded(function(t){e.restaurant=t})}var y=firebase.database().ref();e.menuItems=[],e.auth=n.auth.$getAuth(),e.select={},e.gridId,e.gridDist={},e.showSelect=!1,e.showInfo=function(t){e.select={},e.itemBuild={extras:{},options:{},price:0,quantity:0},e.delStage=0,e.select=t,e.optionsBool=angular.isObject(t.options),e.extrasBool=angular.isObject(t.extras),e.showSelect=!0,e.gotoAnchor("item")},e.delObj={items:[],total:0,vendor:e.appPartner,paid:!1},e.auth?e.delObj.uid=e.auth.uid:n.auth.$signInAnonymously().then(function(t){e.auth=t,e.authBool=!0,u.uid=t.uid,y.child("profiles").child(t.uid).set({name:"Guest",uid:t.uid,voucher:e.appPartner})})["catch"](function(e){console.error("Authentication failed:",e)}),e.removeItem=function(t){e.delObj.total>e.delObj.items[t].price?e.delObj.total-=e.delObj.items[t].price:e.delObj.total=0,e.delObj.items.splice(t,1)},e.removeXtra=function(t,a){delete e.delObj.items[t].extras[a],e.xtrasObj[a]=!1,e.xTotaler(a,e.select.xtras[a].price)},e.removeOpt=function(t,a){delete e.delObj.items[t].options[a],e.optionsObj[a]=!1,e.oTotaler(a,e.select.options[a].price)},e.delStage=0,e.oTotaler=function(t,a){switch(e.optionsObj[t]){case!0:e.itemBuild.options[t]={},angular.forEach(e.select.options[t],function(a,o){e.itemBuild.options[t][o]=a}),e.itemBuild.price+=e.select.options[t].price;break;case!1:delete e.itemBuild.options[t],e.itemBuild.price-=e.select.options[t].price}},e.xTotaler=function(t,a){if(e.itemBuild&&void 0!=e.itemBuild)switch(e.extrasObj[t]){case!0:e.itemBuild.extras[t]={},e.itemBuild.extras[t]=e.select.extras[t],e.itemBuild.price+=e.select.extras[t].price;break;case!1:delete e.itemBuild.extras[t],e.itemBuild.price-=e.select.extras[t].price}},e.optionsObj={},e.extrasObj={},e.delQItem=function(t){!e.itemBuild.name&&t>0?(e.itemBuild={},angular.forEach(e.select,function(t,a){"options"!==a&&"extras"!==a?e.itemBuild[a]=t:e.itemBuild[a]={}}),e.itemBuild.quantity=t,e.delObj.total?e.delObj.total+=e.itemBuild.price*t:e.delObj.total=e.itemBuild.price*t):e.itemBuild.quantity>0&&e.itemBuild.quantity+t==0?(null==e.itemBuild,e.delObj.total+=e.itemBuild.price*t):(e.itemBuild.quantity+=t,e.delObj.total+=e.itemBuild.price*t)},e.delQ=function(t,a){!e.delObj.items[t]&&a>0?e.delObj.total?e.delObj.total+=e.delObj.items[t].price*a:e.delObj.total=e.delObj.items[t].price*a:e.delObj.items[t].quantity+a==0?(null==e.delObj.items[t],e.delObj.total+=e.delObj.items[t].price*a):(e.delObj.items[t].quantity+=a,e.delObj.total+=e.delObj.items[t].price*a)},e.menuDrinks=[],e.itemBuild={extras:{},options:{},price:0,quantity:0},e.listMode=!1,e.toggleListMode=function(){e.listMode=!e.listMode},e.additem=function(){e.itemBuild.quantity=1},e.payOpts=!1,e.showOpts=function(){e.payOpts=!e.payOpts,paypal.checkout.setup("KWPCEZL8SC7XS",{environment:"sandbox",container:"paypaltabbtn",click:function(){paypal.checkout.initXO(),e.delObj.method="paypal",e.delObj.placed=moment().format("lll"),e.delObj.completed=!1,o(y.child("orders").child(e.appPartner).child("orders")).$add(e.delObj).then(function(a){y.child("orders").child(e.appPartner).child("orderCount").transaction(function(t){return t?(t+=1,y.child("orders").child(e.appPartner).child("orders").child(a.key).child("orderNo").set(t)):t=1,t});var o={method:"POST",url:"https://www.pbpapi.com/tktr_restaurant/"+e.appPartner+"/pay",data:{uid:e.auth.uid,order_id:a.key},dataType:"json",headers:{"Content-Type":"application/json"}};t(o).then(function(e){e.data.token&&paypal.checkout.startFlow(e.data.token)},function(e){paypal.checkout.closeFlow()})})}})},e.delNext=function(t){switch(t){case 0:angular.forEach(e.select,function(t,a){"options"!=a&&"extras"!=a?e.itemBuild[a]=t:e.itemBuild[a]={}}),e.itemBuild.quantity=1,angular.isObject(e.select.options)?e.delStage=1:!$angular.isObject(e.select.options)&&angular.isObject(e.select.extras)?e.delStage=2:$angular.isObject(e.select.options)||angular.isObject(e.select.extras)||(e.delStage=3);break;case 1:angular.isObject(e.select.extras)?e.delStage=2:e.delStage=3;break;case 2:e.delStage=3}},e.addItemToOrder=function(){e.delObj.items.push(e.itemBuild),e.delObj.total+=e.itemBuild.price,e.select={}},e.addOrder=function(a){switch(a){case"cash":e.delObj.method=a;break;case"card":e.delObj.method=a;break;case"paypal":e.delObj.method=a;break;case"mail":e.delObj.method="paypal",y.child("profiles").child(e.auth.uid).child("email").set(e.delObj.email)}e.delObj.placed=moment().format("lll"),e.delObj.completed=!1,o(y.child("orders").child(e.appPartner).child("orders")).$add(e.delObj).then(function(a){y.child("orders").child(e.appPartner).child("orderCount").transaction(function(t){return t?(t+=1,y.child("orders").child(e.appPartner).child("orders").child(a.key).child("orderNo").set(t)):t=1,t});var o={method:"POST",url:"https://www.pbpapi.com/tktr_restaurant/"+e.appPartner+"/pay",data:{uid:e.auth.uid,order_id:a.key},dataType:"json",headers:{"Content-Type":"application/json"}};t(o).then(function(t){t.data.token&&(e.qrPPUrl="https://www.paypal.com/checkoutnow?token="+t.data.token,e.payQR=!0)}),alert("THANKS!")})},e.payQR=!0,e.selVar="",b(e.appPartner),e.selSwitch=function(t){e.selVar==t?e.selVar="":e.selVar=t},e.addDrink=function(t){e.delObj.items.push(t),e.delObj.total+=t.price},e.removeDrink=function(t){angular.forEach(e.delObj.items,function(e){t==e&&delete e}),e.delObj.total-=t.price},e.gotoAnchor=function(e){var t=e;v.hash()!==t?v.hash(e):g()},e.clearSelect=function(){delete e.select},e.centerArr=[],e.search={},e.switchMenu=function(t){e.search={tag:t}},o(y.child("info").orderByChild("product").equalTo(!0)).$loaded(function(t){e.displayArray=t}),e.colGroup=function(e){return e.length}}]).controller("ScreenDashCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","$anchorScroll","$location","$mdToast","$mdSidenav",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k){firebase.database().ref();e.dashHome=function(){h.go("app.home_screen.dash"),i(function(){e.loaded()},2e3)},i(function(){e.loaded()},2e3)}]).controller("ScreenRoomCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","$anchorScroll","$location","$mdToast","$mdSidenav",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k){firebase.database().ref()}]).controller("ScreenCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","$anchorScroll","$location","$mdToast","$mdSidenav","$http","ProductsService","InfoService","$translate","User",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k,S,P,A,_,O){var M=firebase.database().ref();e.partyArray=[],e.actArray=[],e.tourArray=[],e.rentalArray=[],e.wsArray=[],e.eventsArray=[],e.select={},e.gridId,e.vendorFilter={},e.partnerEnq={},e.vendorEnq={},e.devEnq={},e.prodView=!1,e.loaderCheck(),e.adminBool=!1,"tktr"==e.appPartner&&(_("part_wus_array").then(function(t){e.partwus=t.split("     ")}),_("vend_wus_array").then(function(t){e.vendwus=t.split("     ")})),e.htBool=!1,e.mediaQuery("gt-md")?e.htBool=!0:e.hudView||e.prodView?!e.hudView&&e.prodView?e.htBool=!1:e.htBool=!1:e.htBool=!0,e.scrCPop=!1,e.togglePop=function(){e.scrCPop=!e.scrCPop},e.eventClearer=function(){e.tabBool=!1,e.hudView="prodview"},e.fbView=!1,e.setFBView=function(t){e.fbView=!1,e.fbView=t,i(function(){FB.XFBML.parse()},250)},e.opBool=!0,e.deltaOp=function(){e.formFade==e.partner.classes.grad25?e.formFade=e.partner.classes.grad100:e.formFade==e.partner.classes.grad100?e.formFade=e.partner.classes.grad25:e.formFade=e.partner.classes.grad25},$(document).on("click",".gal_right",function(e){$(this).parent().animate({scrollLeft:750},175)}),$(document).on("click",".gal_left",function(e){$(this).parent().animate({scrollLeft:-750},175)}),e.dOPFn=function(){},e.vendorFilter={vendor:e.appPartner},e.tktrFilter={vGroup:"tktr"},e.closeHud=function(){e.tabBool=!0,e.evBool&&(e.prodView=!0)},e.wwView="partner",e.setWWView=function(t){e.wwView=t},e.tgbView="sa",e.tgbV=function(t){e.tgbView=t},e.closeiHud=function(){h.go("app.home_screen.dash")},e.dashLink=function(t){e.mediaQuery("gt-sm")||e.closeHud(),h.go(t)},e.sendEnq=function(t){switch(t){case"partner":var a={method:"POST",url:"https://www.pbpapi.com/enquiry/partner",data:{uid:e.appAuth.uid,enquiry:e.partnerEnq},dataType:"json",headers:{"Content-Type":"application/json"}};M.child("profiles").child(e.appAuth.uid).child("email").set(e.partnerEnq.email),M.child("profiles").child(e.appAuth.uid).child("name").set(e.partnerEnq.name);break;case"vendor":var a={method:"POST",url:"https://www.pbpapi.com/enquiry/vendor",data:{uid:e.appAuth.uid,enquiry:e.vendorEnq},dataType:"json",headers:{"Content-Type":"application/json"}};M.child("profiles").child(e.appAuth.uid).child("email").set(e.vendorEnq.email),M.child("profiles").child(e.appAuth.uid).child("name").set(e.vendorEnq.name);break;case"dev":var a={method:"POST",url:"https://www.pbpapi.com/enquiry/dev",data:{uid:e.appAuth.uid,enquiry:e.devEnq},dataType:"json",headers:{"Content-Type":"application/json"}};M.child("profiles").child(e.appAuth.uid).child("email").set(e.devEnq.email),M.child("profiles").child(e.appAuth.uid).child("name").set(e.devEnq.name)}a&&S(a).then(function(e){},function(e){})},e.dashMenuLink=function(t){e.showSideMenu(),e.closeHud,h.go(t)},e.dashGo=function(t){e.hudUp("prodview");var a={city:t.city,id:t.$id,aw:t.adword};if("recs"==t.tag?a.cat=t.cat:a.cat=t.tag,e.catView=!1,"recs"==t.tag)var o="assets/site/"+t.cat+".jpg";else var o="assets/site/"+t.tag+".jpg";o!=e.vrbgurl&&(e.loadVrBg(o,!0),e.vrbgurl=o),e.prodView=!0,h.go("app.home_screen.dash.info",a)},e.dashGoRoom=function(t){e.closeHud(),e.catView=!1;var a={city:t.city,id:t.$id,aw:t.adword};"recs"==t.tag?a.cat=t.cat:a.cat=t.tag,h.go("app.home_screen.dash.info",a)},e.dashPartnerGo=function(t){e.closeHud(),e.catView=!1,h.go("app.home_screen.dash",{partner:t})},e.dashGoRoomMenu=function(t){var a={city:t.city,id:t.$id,aw:t.adword};"recs"==t.tag?a.cat=t.cat:a.cat=t.tag,e.showSideMenu(),h.go("app.home_screen.dash.info",a),e.closeHud(),e.catView=!1},e.hudToMenu=function(t){e.showSideMenu(),e.closeHud(),e.switchArr(t.tag),e.catView=!1},e.snLink=function(t){e.showSideMenu(),h.go(t)},e.hudTo=function(t){var a={city:t.city,id:t.$id,aw:t.adword};"recs"==t.tag?a.cat=t.cat:a.cat=t.tag,h.go("app.home_screen.dash.info",a),e.closeHud(),e.switchArr(t.tag)},e.drawerBool=!1,e.toggleDrawer=function(){e.drawerBool=!e.drawerBool},e.dashGoMenu=function(t){if(e.showSideMenu(),t.tag==e.search.tag||t.cat==e.search.cat||t.vendor==e.search.vendor)if("recs"==t.tag)var a="assets/site/"+t.cat+".jpg";else var a="assets/site/"+t.tag+".jpg";a!=e.vrbgurl&&(e.loadVrBg(a,!0),e.vrbgurl=a);var o={city:t.city,id:t.$id,aw:t.adword};"recs"==t.tag?o.cat=t.cat:o.cat=t.tag,h.go("app.home_screen.dash.info",o)},e.itInfo={},e.hpIndex=0,e.lView="act",e.setLView=function(t){e.lView=t},e.partnerFilter={vendor:e.appPartner},e.hudUp=function(t){e.tabBool=!1,e.hudView=t,e.showIndex=0,e.prodView=!1,"upcoming"==t&&e.loadParade()},e.tktrMap="",e.paradeDays=[];for(var D=0;D<=6;D++)e.paradeDays.push(moment().add(D,"days"));e.fades={},e.pLocs={},e.pLocBool=[],e.tpMarkers=[],"tktr"==e.appPartner&&(A.getPartners("acc").then(function(t){e.accArray=t,angular.forEach(t,function(t){M.child("sites").child(t.$id).child("grad25").once("value",function(a){e.fades[t.$id]=a.val()}),M.child("vendor_locations").child(t.$id).once("value",function(t){var a=t.val();if(a){var o=new google.maps.Marker({position:{lat:a.location.lat,lng:a.location.lng}});e.tpMarkers.push(o)}})}),e.pLocBool[0]=!0}),A.getPartners("act").then(function(t){e.actArray=t,angular.forEach(t,function(t){M.child("sites").child(t.$id).child("grad25").once("value",function(a){e.fades[t.$id]=a.val()})}),e.pLocBool[1]=!0})),o(M.child("accomm")).$loaded(function(t){e.roomArray=t}),e.afflnkFilter={affiliate_links:!0},e.gridDist={},e.showSelect=!1,e.eLO={},e.hpIndex=0,e.homeParade={},e.loadParade=function(t){if(!t||angular.isUndefined(t))var t=moment();if(t&&!e.homeParade[t.format("YYYY-MM-DD")]||!t){var a;a=t?moment(t).format("YYYY-MM-DD"):moment().format("YYYY-MM-DD"),o(M.child("static_stock").orderByChild(a)).$loaded(function(a){e.homeParade[t.format("YYYY-MM-DD")]=a,angular.forEach(a,function(a){angular.forEach(a[t.format("YYYY-MM-DD")],function(t,o){t.available>0&&A.getInfo(a.$id).then(function(t){return e.itInfo[a.$id]=t})})})})}},e.emailLanding=function(){var a="@@"+e.eLO.name+"@@";t.auth.$createUserWithEmailAndPassword(e.eLO.email,a).then(function(t){M.child("profiles").child(t.uid).set({name:e.eLO.name,uid:t.uid,voucher:e.appPartner,email:e.eLO.email})})},O.getUser().then(function(t){e.user=t.profile,e.auth=t.auth,i(function(){e.loaded()},1500),p.getCurrentPosition({timeout:6e4}).then(function(t){e.user.location={},e.user.location.lat=t.coords.latitude,e.user.location.lng=t.coords.longitude,e.user.location.loc=[t.coords.latitude,t.coords.longitude],M.child("profiles/"+e.auth.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})})},function(t){e.loaded()}),e.partner&&!e.partner.info&&A.getInfo(e.appPartner).then(function(t){e.partner.info=t,t&&t.vGroup&&(e.vgFilter={vGroup:e.partner.info.vGroup})}),e.partnerFlashLogo=!1,e.noMediaAlert=function(e){w.show(w.simple().textContent("Sorry! no "+e+" for this!").position("center").hideDelay(2e3))},e.gotoAnchor=function(e){var t=e;y.hash()!==t?y.hash(e):b()},e.gridId="",e.gridSelector=function(t){e.gridId=t.$id},e.gridSugg=function(t){return t==e.gridId},e.centerArr=[],e.switchRoomMenu=function(t){e.showSideMenu(),e.roomFilt={vendor:t},e.roomVBool=!0},e.switchRoom=function(t){e.roomFilt={vendor:t},e.roomVBool=!0,e.catView=!1},e.switchArrMenu=function(t){e.showSideMenu(),"watersports"==t||"tours"==t||"activities"==t||"rentals"==t||"events"==t?(e.search={tag:t},e.arrTitle=t):"tktr"==t?(e.search={vGroup:"tktr"},e.arrTitle=t):"parties"==t?(e.search={tag:"recs",cat:"club"},e.arrTitle=t):"vendor"==t?(e.search={vGroup:e.partner.info.vGroup},e.arrTitle=e.partner.info.name):(e.search={tag:"recs",cat:t},e.arrTitle=t),e.catView=!1,e.roomVBool=!1},e.switchArr=function(t){console.log(t),"watersports"==t||"tours"==t||"activities"==t||"rentals"==t||"events"==t?(e.search={tag:t},e.arrTitle=t):"tktr"==t?(e.search={vGroup:"tktr"},e.arrTitle=t):"parties"==t?(e.search={tag:"recs",cat:"club"},e.arrTitle=t):"vendor"==t?(e.partner.info.vGroup?e.search={vGroup:e.partner.info.vGroup}:e.search={vendor:e.partner.info.vendor},e.arrTitle=e.partner.info.name):"sights"==t||"bar"==t||"restaurant"==t||"shop"==t||"club"==t?(e.search={tag:"recs",cat:t},e.arrTitle=t):(e.search={tag:t},e.arrTitle=t),e.roomVBool=!1,e.catView=!1},e.promoObj={},e.srcObj={},e.posterObj={},e.videos=[{}],e.partnerTube=!1,e.partnerConfig={},e.catView=!0,e.catViewFlip=function(){e.catView=!e.catView},e.dashHome=function(){e.hudView="",e.tabBool=!0,h.go("app.home_screen.dash"),i(function(){e.loaded()},2e3)},e.dashHomeMenu=function(){m.sideMenuBool=!1,e.hudView="img",h.go("app.home_screen.dash"),i(function(){e.loaded()},500)},e.videos=[{}],e.mainArray=[],A.filterProds().then(function(t){e.mainArray=t},function(e){console.log(e)}),e.colGroup=function(e){return e.length}}]).controller("AccommRecCtrl",["$scope","Auth","$firebaseObject","$http","$firebaseArray","$timeout","$stateParams","$sce","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","$mdDialog",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p){var h=firebase.database().ref();e.accProvs=[],n(h.child("info").orderByChild("links").equalTo(!0)).$loaded(function(t){e.accProvs=t,console.log(e.accProvs)}),e.loaderCheck(),e.eventClearer()}]).controller("ContactCtrl",["$scope","$http",function(e,t){e.contactForm={},e.loaded(),e.contactUs=function(){t({method:"POST",url:"https://www.pbpapi.com/contact",data:{email:e.contactForm.email,subject:e.contactForm.subject,body:e.contactForm.body}}).then(function(e){$mdDialog.hide()})}}]).controller("TermsCtrl",["$scope",function(e){e.loaded()}]).controller("ScreenArrivalCtrl",["$scope","$state","Auth","$rootScope","$interval","$timeout","$stateParams","$mdMedia",function(e,t,a,o,n,i,r,l){var c=(firebase.database().ref("geofire"),firebase.database().ref()),d=a.auth.$getAuth();d?t.go("app.home_screen.dash"):a.auth.$signInAnonymously().then(function(a){e.auth=a,e.authBool=!0,o.uid=a.uid,c.child("profiles").child(a.uid).set({name:"Guest",uid:a.uid,voucher:e.appPartner}),t.go("app.home_screen.dash")})["catch"](function(e){console.error("Authentication failed:",e)})}]).controller("LinkArrivalCtrl",["$scope","$state","Auth","$rootScope","$interval","$timeout","$stateParams","$mdMedia",function(e,t,a,o,n,i,r,l){var c=(firebase.database().ref("geofire"),firebase.database().ref());a.auth.$signInAnonymously().then(function(a){e.auth=a,e.authBool=!0,o.uid=a.uid,c.child("profiles").child(a.uid).set({name:"Guest",uid:a.uid,voucher:r.partner}),t.go("app.home_screen.dash")})["catch"](function(e){console.error("Authentication failed:",e)})}]).controller("ArrivalCtrl",["$scope","$state","Auth","$rootScope","$interval","$timeout","$stateParams","$mdMedia","User",function(e,t,a,o,n,i,r,l,c){firebase.database().ref("geofire"),firebase.database().ref();e.auth={},e.auth.uid=a.uid(),i(function(){e.loaded()},500),e.logShow=function(t){return e.logBool==t},e.anonCont=function(){c.anonArrival()},e.tabletWelcome=function(){return l("gt-sm")?40:l("portrait")?100:void 0},"partybypaul"!=e.appPartner&&i(function(){c.anonArrival()},2500)}]).controller("ItinModalCtrl",["$scope","$mdDialog","item","$state","$mdMedia",function(e,t,a,o,n){e.item=a,e.close=function(){t.hide()}}]).controller("CalCtrl",["$scope","CalendarService",function(e,t){e.currMonth=t.getMonth(moment().month()),e.calMonth=moment().month(),e.monthName=moment().month(e.calMonth).format("MMMM"),e.serach=!1,e.delMonth=function(a){e.calMonth+=a,e.currMonth=t.getMonth(e.calMonth),e.monthName=moment().month(e.calMonth).format("MMMM")}}]).controller("ItineraryCtrl",["$scope","SkyScan","$firebaseArray","CalendarService",function(e,t,a,o){function n(t,a){var o,n;t&&a?(o=moment(t),n=moment(a)):t&&!a?(o=moment(t),n=moment(t).clone().add(4,"days")):t||a||(o=moment(),n=moment().clone().add(4,"days"));for(var i=moment(o);i.diff(n,"days")<=0;i.add(1,"days")){var r=i.format("YYYY-MM-DD");e.itineraryCalendar.push(r)}e.getDates=!1}e.itInfo={};var i=firebase.database().ref();e.numbArray=[1,2,3,4,5,6,7,8,9,10];var r=[9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],l=["00",15,30,45];if(e.hours=[],angular.forEach(r,function(t){angular.forEach(l,function(a){e.hours.push(t+":"+a)})}),e.itIndex=0,e.closeSB=function(){e.serach=!1},e.results=[],e.searchTime=function(t,o){var n,r=t+"/"+o;n=e.itinQ.travellers?e.itinQ.travellers:2,a(i.child("static_stock").orderByChild(r).startAt(n)).$loaded(function(t){angular.forEach(t,function(t){i.child("info").child(t.$id).once("value",function(t){e.results.push(t.val())})}),e.serach=!0})},e.openItinModal=function(e){var t=angular.element(document.body);$mdDialog.show({parent:t,templateUrl:"templates/itinmodal.html",locals:{item:e},controller:"ItinModalCtrl"})},e.calChecker=function(e,t,a){var o=t.split(":"),n=moment(e).clone().add(o[0],"hours").add(o[1],"minutes");return moment(n).isSame(a)},e.cart&&e.cart.items){var c="",d="";angular.forEach(e.cart.items,function(t,a){(c="")?(d=t.time,c=t.time):moment(t.time).isAfter(d)?d=t.time:moment(t.time).isBefore(c)&&(c=t.time),i.child("info").child(t.parent).once("value",function(a){e.itInfo[t.parent]=a.val()})}),n(c,d)}e.setDate=function(t){e.itinQ.checkin||e.itinQ.checkout?e.itinQ.checkin&&!e.itinQ.checkout&&(e.itinQ.checkout=t,e.getDates=!1,n(e.itinQ.checkin,e.itinQ.checkout),e.itIndex=1):e.itinQ.checkin=t},e.scanParams={},e.today=new Date,e.tday=moment(),e.twoday=new Date(e.today.getFullYear(),e.today.getMonth(),e.today.getDate()+2),e.itinQ={travellers:1,hotel:!1,flights:!1,checkin:null,checkout:null},e.getDates=!0,e.user&&angular.isUndefined(e.user.itinerary)?(e.user.itinerary={travellers:1,hotel:!1,flights:!1,checkin:null,checkout:null},e.getDates=!0):e.user&&e.user.itinerary&&n(e.user.itinerary.checkin,e.user.itinerary.checkout),e.departures=[],e.loadReturns=function(t){for(var a=0;a<=10;a++)e.departures.push(moment().add(a,"days").format("YYYY-MM-DD"))},e.setArrival=function(t){e.itinQ.checkin=t,e.user.arrival=t,i.child("profiles").child("arrival").set(t),e.loadReturns(t)},e.setDeparture=function(t){e.itinQ.checkout=t,e.user.departure=t,i.child("profiles").child("departure").set(t),e.iStep++,e.getDates=!1,n()},e.avThatDay={},e.arrivals=[];for(var s=0;s<=10;s++)e.arrivals.push(moment().add(s,"days").format("YYYY-MM-DD")),console.log(e.arrivals);e.minDate=new Date(e.today.getFullYear(),e.today.getMonth()-2,e.today.getDate()),e.maxDate=new Date(e.today.getFullYear(),e.today.getMonth()+2,e.today.getDate()),e.locales=[],e.markets=[],e.currencies=[],e.itineraryCalendar=[],e.pivot=function(a){({arrival:moment(e.itinQ.checkin).format("YYYY-MM-DD"),departure:moment(e.itinQ.checkout).format("YYYY-MM-DD"),query:"Barcelona"});switch(a){case"hotel":t.getHotelAuto().then(function(t){e.hotelsArray=t});break;case"none":n()}e.iStep=4,e.itinQ.pivot=a},e.step=function(t){e.iStep+=t},e.iStep=1,e.setCurr=function(a){e.scanParams.currency=a,t.setCurr(a)},e.setMarket=function(a){e.scanParams.market=a,t.setMarket(a)},e.setLocale=function(a){e.scanParams.locale=a,t.setLocale(a)}}]).controller("TicketSideCtrl",["$scope","$state","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$rootScope","$http","$state","$mdToast","User","$mdSidenav","$timeout","$translate",function(e,t,a,o,n,i,r,l,c,d,s,t,u,m,f,p,h){function g(t){a(v.child("profiles/"+e.uid)).$bindTo(e,"profile"),b=a(v.child("carts/"+e.uid)),b.$bindTo(e,"cart").then(function(){e.cart.items&&(e.cart.fee=1),b.$watch(function(){var t=0,a=0;e.cart.items&&angular.forEach(e.cart.items,function(e,o){t+=e.price*e.quantity,a+=e.tax*e.quantity}),e.cart.total=t,e.cart.tax=a})})}var v=firebase.database().ref();e.addTable=!1,e.tableaddons,e.profile=e.user,firebase.auth().onAuthStateChanged(function(t){t?(m.getUser().then(function(t){e.profile=t.profile,e.uid=t.auth.uid,e.appAuth=t.auth,console.log()}),g(t.uid)):e.cart={total:0,items:[]}}),e.checkout=!1,e.initCheckout=function(){e.profile.email&&"Guest"!=e.profile.name?(e.payNow(),e.gotoAnchor("payment")):(e.checkout=!0,e.gotoAnchor("checkout"))},console.log(e.auth),e.closeThis=function(){e.showPayPal=!1},e.signOut=function(){m.signOutMenu("right")},e.tixHref=function(){e.closeSNav("right",t.go("app.tickets",{uid:e.uid}))},e.deltaQ=function(t,a){e.cart.items[t].quantity+a==0?c.removeItem(t):e.cart.items[t].quantity+=a},e.showPayPal=!1;var b;e.mergeObj={},e.mergeNow=function(){m.mergeNow(e.mergeObj.email).then(function(t){e.payNow(),e.authNow=!1})},e.roughIt=function(){e.profile.email=e.mergeObj.email,e.profile.name=e.mergeObj.name,v.child("profiles").child(e.appAuth.uid).child("email").set(e.mergeObj.email),v.child("profiles").child(e.appAuth.uid).child("email").set(e.mergeObj.email),p(function(){e.payNow()},200)},e.authNow=!1,e.payNow=function(){e.profile.email?(e.showPayPal=!0,paypal.checkout.setup("KWPCEZL8SC7XS",{environment:"live",container:"paypalbtn",click:function(){d.stateIsLoading=!0,paypal.checkout.initXO();var t={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.appPartner+"/pay",data:{uid:d.uid}};s(t).then(function(t){e.tempToken=t.data.token,d.stateIsLoading=!1,paypal.checkout.startFlow(t.data.token)},function(e){paypal.checkout.closeFlow()})}})):h("need_detes2").then(function(e){u.show(u.simple().textContent(e).position("top").hideDelay(2e3))})},e.payLink=function(){if(e.profile.email){d.stateIsLoading=!0;var t={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.appPartner+"/pay_link",data:{uid:e.uid}};s(t).then(function(t){d.stateIsLoading=!1,e.tempToken=t.data.token,e.qrPPUrl="https://www.paypal.com/checkoutnow?token="+t.data.token,e.mediaQuery("gt-lg")&&e.openPayModal("https://www.paypal.com/checkoutnow?token="+t.data.token),d.cartBool=!1,u.show(u.simple().textContent("Check your mail!").position("top").hideDelay(2e3))},function(e){})}else h("need_detes2").then(function(e){u.show(u.simple().textContent(e).position("top").hideDelay(2e3))})},e.payForce=function(){paypal.checkout.startFlow(e.tempToken)},e.removeItem=function(e){c.removeItem(e)},e.hideCart="true",e.emptyCart=function(){c.empty()}}]).controller("AdminCtrl",["$scope","$http","$rootScope","InfoService","$firebaseArray","$firebaseObject","$mdMedia","Auth","$state","$timeout","$stateParams","PackageService",function(e,t,a,o,n,i,r,l,c,d,s,u){var m=firebase.database().ref();e.admin={};var f=a.uid;if(e.adminBooler(!0),!f){var p=l.auth.$getAuth();p?(a.uid==p.uid,e.appAuth=p):c.go("app.admin_landing")}e.signOut=function(){l.auth.$signOut()},e.adminLoaded=function(){d(function(){e.loaded()},300)},e.chartData=[],e.chartLabels=[],e.vendorProducts={},e.vendorPackz={},e.loadAdmin=function(){i(m.child("profiles/"+e.appAuth.uid)).$loaded(function(a){o.getVendorProducts(a.staff).then(function(t){angular.forEach(t,function(t){e.vendorProducts[t.$id]=t,console.log(t),u.getPackagesObj(t.$id).then(function(a){e.vendorPackz[t.$id]=a,console.log(a)})})}),e.admin.profile=a,e.commTotal=0,e.commMonth=0;var n,i;n=s.vendor,i="https://86631744.ngrok.io/admins/comms/partner/"+n;var r={method:"GET",url:i};t(r).then(function(t){e.monthlies=t.data.monthlies,e.monthTotals=t.data.totals,e.sales=t.data.sales,e.xsales=t.data.cross_sales,e.xsMonthlies=t.data.xs_monthlies,e.xsMonthTotals=t.data.xs_totals,e.sMonthlies=t.data.s_monthlies,e.sMonthTotals=t.data.s_totals,e.msMonthlies=t.data.ms_monthlies,e.msMonthTotals=t.data.ms_totals,e.commTotal=t.data.total,console.log(t.data)},function(e){console.log(e)})})},i(m.child("info/"+s.vendor)).$loaded(function(t){e.vendorAdmin=t}),i(m.child("admins/"+f)).$loaded(function(t){t&&null!=t?e.admin.rank=t.$value:c.go("app.home_screen.dash")})}]).controller("AdminBookingsCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth","$stateParams",function(e,t,a,o,n,i,r,l){firebase.database().ref()}]).controller("AdminBookingsCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth","$stateParams",function(e,t,a,o,n,i,r,l){firebase.database().ref()}]).controller("AdminDashCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth","$stateParams",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref();e.months=[];for(var d=0;d<=2;d++)e.months.push(moment().subtract(d,"months").format("MMMM"));e.todayArray=[],e.tixArray=[],o(c.child("tix").orderByChild("vendor").equalTo(l.vendor)).$loaded(function(t){angular.forEach(t,function(t){moment(t.date).isSame(moment().format("YYYY-MM-DD"))&&e.todayArray.push(t)}),e.tixArray=t}),e.loadAdmin(),e.enqArrObj=o(c.child("enqs")),e.enqArrObj.$loaded(function(t){e.enqArr=t}),e.adminLoaded(),e.labels=["January","February","March","April","May","June","July"]}]).controller("OrdersCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth","$stateParams",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref(),d=o(c.child("orders").child(l.vendor).child("orders"));d.$loaded(function(t){e.orders=t}),e.orderComplete=function(e){c.child("orders").child(l.vendor).child("orders").child(e.$id).child("completed").set(!0)},e.adminLoaded(),e.ago=function(e){return moment(e).from(moment())}}]).controller("AdminEnqCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth","$stateParams",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref();e.enqArrObj||(e.enqArrObj=o(c.child("enqs")),e.enqArrObj.$loaded(function(t){e.enqArr=t,e.adminLoaded()})),e.acceptEnq=function(e){Cart.approve(e)},e.rejectEnq=function(e){c.child("enqs").child(e.$id).remove()}}]).controller("AdminSalesCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b){function y(t){var a,o=firebase.database().ref("vendor_locations"),n=firebase.database().ref("geofire");new GeoFire(o),new GeoFire(n);if(a=[41.387162,2.169966],t.weekend_charge){var i=moment(t.date).day(),r=!1;angular.forEach(t.weekend_charge.days,function(e,t){e==i&&(r=!0)})}r&&(t.price+=t.weekend_charge.amt,t.pid=t.pid+"_xtra",t.tax+=.15*t.price*.21);var l=e.adminCart.items[t.pid];
if(l&&l.quantity)t.duration&&!t.quantity&&(t.quantity=t.duration),l.quantity+=t.quantity,l.total=l.price*l.quantity,e.adminCart.items[t.pid]=l,e.adminCart.total+=l.total,e.adminCart.tax+=l.tax;else{if(l={},t.duration&&!t.quantity&&(t.quantity=t.duration),angular.forEach(t,function(e,t){e&&"$id"!=t&&(l[t]=e)}),a||(a=[41.387162,2.169966]),t.date&&t.time){var r=(moment(t.date).clone().format("YYYY-MM-DD"),!1);if(t.time.length>6)l.time=moment(t.date).clone().format("lll");else{var c=t.time.split("-");l.time=moment(t.date).clone().hours(parseInt(c[0])).minutes(parseInt(c[1])).format("lll")}}l.user_coords=a,l.total=t.price*t.quantity||t.duration,e.adminCart.items[t.pid]=l,e.adminCart.total+=l.total,e.adminCart.tax+=l.tax}}e.vendorFilter={},e.ymlFilter={},e.adminCart={items:{},total:0,tax:0},e.catView=!0,e.catViewFlip=function(){e.catView=!e.catView},e.deltaQ=function(t,a){e.adminCart.items[t].quantity+a==0?(e.adminCart.total-e.adminCart.items[t].price*e.adminCart.items[t].quantity,delete e.adminCart.items[t]):e.adminCart.items[t].quantity+=a},e.removeItem=function(t){e.adminCart.total-e.adminCart.items[t].price*e.adminCart.items[t].quantity,delete e.adminCart.items[t]},e.enqDate=function(t){if(e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)return moment(e.enquireObj.date).clone().format("lll");var a=e.enquireObj.time.split("-");return moment(e.enquireObj.date).clone().hours(parseInt(a[0])).minutes(parseInt(a[1])).format("lll")}},e.switchArr=function(t){"watersports"==t||"tours"==t||"activities"==t||"rentals"==t||"events"==t?(e.search={tag:t},e.arrTitle=t):"tktr"==t?(e.search={tktr:!0},e.arrTitle=t):"parties"==t?(e.search={tag:"recs",cat:"club"},e.arrTitle=t):"vendor"==t?(e.search={vGroup:e.partner.info.vGroup},e.arrTitle=e.partner.info.name):(e.search={tag:"recs",cat:t},e.arrTitle=t),e.catView=!1},e.numbArray=[1,2,3,4,5,6,7,8,9,10,11],e.packages={};var w=firebase.database().ref();o(w.child("info/"+r.vendor)).$loaded(function(t){e.vendorAdmin=t,n(w.child("info").orderByChild("product").equalTo(!0)).$loaded(function(t){e.vendorOptions=t,angular.forEach(t,function(t){n(w.child("packages").child(t.$id)).$loaded(function(a){e.packages[t.$id]=a})}),e.adminLoaded()}),console.log(e.packages)}),e.checkStock=function(){b.checkStock(e.build).then(function(t){t&&(e.build.stock=t,e.build.greenlit=!0)})["catch"](function(t){e.build.time=null,e.build.quantity=null,alert(t)})},e.checkStatic=function(){b.checkStatic(e.build).then(function(t){t?e.build.greenlit=1:e.build.greenlit=2})},e.builder=function(t){var a;a=!t.name&&t.val?t.val:t,e.times=[],e.build={},angular.forEach(a,function(t,a){e.build[a]=t}),e.build.date=null,e.build.time=null,e.build.pid=a.$id,e.build.parent=e.info.$id,e.build.weekend_charge&&(e.build.quantity=1),e.build.greenlit=0;var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(w.child("static_stock/"+e.info.$id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(w.child("static_stock/"+e.info.$id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.clearBuild=function(){e.build=null,e.info=!1},e.tempDate={},e.stops=["junta","rraval"],e.builderVaya=function(){e.times=[],e.build={};var t=e.packages[0],a=e.packages[0].$id;angular.forEach(t,function(t,a){e.build[a]=t}),e.build.date=e.tempDate.date,e.build.time=null,e.build.pid=a,e.build.parent=t.parent,e.build.greenlit=0;var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(w.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date),"day")&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(w.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date))&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.checkStock=function(){b.checkStock(e.build).then(function(t){t&&(e.build.stock=t,e.build.greenlit=!0)})["catch"](function(t){e.build.time=null,e.build.quantity=null,alert(t)})},e.validDates={},e.today=moment().format("YYYY-MM-DD"),e.validate=function(t){var a=moment(t).format("YYYY-MM-DD");return!e.validDates[a]},e.times=[],e.checkDay=function(t){return moment(t).isSame(e.build.date,"day")},e.selPrd=function(t){e.info=t},e.newSaleUser={},e.addToAdminCart=function(){y(e.build),e.clearBuild()},e.payNow=function(t){var o={method:"POST",url:"https://www.pbpapi.com/admin/"+r.vendor+"/sale",data:{cart:e.adminCart,user_info:e.newSaleUser,method:t},dataType:"json",headers:{"Content-Type":"application/json"}};a(o).then(function(e){},function(e){})},e.prettyDate=function(){if(e.build.date){moment(e.build.date).clone().format("YYYY-MM-DD");if(e.build.time.length>6)return moment(e.build.date).clone().format("lll");var t=e.build.time.split("-");return moment(e.build.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}}}]).controller("AdminStopsCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth","$stateParams",function(e,t,a,o,n,i,r,l){function c(t){var a=new google.maps.Map(document.getElementById("map"),{center:t,zoom:13}),o=document.getElementById("pac-input"),n=new google.maps.places.Autocomplete(o);n.bindTo("bounds",a),a.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var i=new google.maps.InfoWindow,r=new google.maps.Marker({map:a});r.addListener("click",function(){i.open(a,r)}),n.addListener("place_changed",function(){i.close();var t=n.getPlace();e.autoPlace=t,t.geometry&&(t.geometry.viewport?a.fitBounds(t.geometry.viewport):(a.setCenter(t.geometry.location),a.setZoom(17)),r.setPlace({placeId:t.place_id,location:t.geometry.location}),r.addListener("click",function(){AdminTools.googleRec(e.autoPlace,e.newRec.cat)}),r.setVisible(!0),i.setContent("<div><strong>"+t.name+"</strong><br>Place ID: "+t.place_id+"<br>"+t.formatted_address),i.open(a,r))})}var d=firebase.database().ref();e.commTotal=0,e.commMonth=0,n(d.child("info").orderByChild("route")).$loaded(function(t){e.products=t}),e.adminLoaded(),e.grabLoc=function(){e.newRec.location={},$geolocation.getCurrentPosition({timeout:6e4}).then(function(t){e.newRec.location.lat=e.currLoc.lat,e.newRec.location.lng=e.currLoc.lng,e.newRec.location.loc=e.currLoc.loc})},e.input="",uiGmapGoogleMapApi.then(function(){$geolocation.getCurrentPosition({timeout:6e4}).then(function(t){e.currLoc.lat=t.coords.latitude,e.currLoc.lng=t.coords.longitude,e.currLoc.loc=[t.coords.latitude,t.coords.longitude],e.currLoc.gmap={lat:t.coords.latitude,lng:t.coords.longitude},c(e.currLoc.gmap)})})}]).controller("AdminSideCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","$mdMedia","Auth",function(e,t,a,o,n,i,r){function l(){n(c.child("profiles/"+d)).$loaded(function(t){e.admin.profile=t}),n(c.child("admins/"+d)).$loaded(function(t){t&&null!=t?e.admin.rank=t.$value:$state.go("app.home")})}var c=firebase.database().ref();e.admin={};var d=r.uid();d&&(a.uid=d,l()),e.signOut=function(){e.closeSNav("right",r.auth.$signOut())}}]).controller("AdminStaffCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","Auth","$state",function(e,t,a,o,n,i,r){var l=firebase.database().ref();e.admin={};var c=a.uid;n(l.child("profiles/"+c)).$loaded(function(t){e.admin.profile=t}),n(l.child("admins/"+c)).$loaded(function(t){e.admin.rank=t}),o(l.child("partners")).$loaded(function(t){e.vendors=t}),e.adminLoaded(),e.ranks=[{level:"trainee",rank:10},{level:"ticket",rank:20},{level:"manager",rank:30}],e.signUpObj={},e.createStaff=function(){e.signUpObj.password===e.signUpObj.password_confirmation?i.$createUserWithEmailAndPassword(e.signUpObj.email,e.signUpObj.password).then(function(t){$rootscope,l.child("profiles").child(t.uid).set({name:e.signUpObj.name,rank:e.signUpObj.rank,uid:t.uid,staff:e.signUpObj.vendor})})["catch"](function(e){console.error("Error: ",e)}):$mdToast.show($mdToast.simple().textContent("Passwords Dont Match"))}}]).controller("AdminTranslateCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","LangTools",function(e,t,a,o,n,i,r){firebase.database().ref();e.quoteNewLanguage=function(e){r.quoteNewLang(e)},e.updateLanguage=function(e){r.updateLang(e)},e.adminLoaded()}]).controller("AdminLodgesCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools",function(e,t,a,o,n,i){function r(t){var a=new google.maps.Map(document.getElementById("map"),{center:t,zoom:13}),o=document.getElementById("pac-input"),n=new google.maps.places.Autocomplete(o);n.bindTo("bounds",a),a.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var i=new google.maps.InfoWindow,r=new google.maps.Marker({map:a});r.addListener("click",function(){i.open(a,r)}),n.addListener("place_changed",function(){i.close();var t=n.getPlace();e.autoPlace=t,t.geometry&&(t.geometry.viewport?a.fitBounds(t.geometry.viewport):(a.setCenter(t.geometry.location),a.setZoom(17)),r.setPlace({placeId:t.place_id,location:t.geometry.location}),r.addListener("click",function(){e.newSmallVendor.placeObj=e.autoPlace,e.newSmallVendor.name=e.autoPlace.name}),r.setVisible(!0),i.setContent("<div><strong>"+t.name+"</strong><br>Place ID: "+t.place_id+"<br>"+t.formatted_address),i.open(a,r))})}var l=firebase.database().ref();e.newPackages=[],e.newPack={},e.newPark={vendor:!0},n(l.child("bkginfo")).$loaded(function(t){e.ammenities=t}),e.newParkAdmin={},e.newVendor={},e.langs=["en","es"],e.addNewPark=function(){var t={newPark:e.newPark,newAdmin:e.newParkAdmin};i.newPark(t)},e.adminLoaded(),e.uniqBool=function(e){e&&n(l.child("info").child(e)).$loaded(function(e){return!e})},$geolocation.getCurrentPosition({timeout:6e4}).then(function(t){e.currLoc.lat=t.coords.latitude,e.currLoc.lng=t.coords.longitude,e.currLoc.loc=[t.coords.latitude,t.coords.longitude],e.currLoc.gmap={lat:t.coords.latitude,lng:t.coords.longitude},r(e.currLoc.gmap)})}]).controller("AdminVendorCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","uiGmapIsReady","$geolocation",function(e,t,a,o,n,i,r,l){function c(t){var a=new google.maps.Map(document.getElementById("map"),{center:t,zoom:13}),o=document.getElementById("pac-input"),n=new google.maps.places.Autocomplete(o);n.bindTo("bounds",a),a.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var i=new google.maps.InfoWindow,r=new google.maps.Marker({map:a});r.addListener("click",function(){i.open(a,r)}),n.addListener("place_changed",function(){i.close();var t=n.getPlace();e.autoPlace=t,t.geometry&&(t.geometry.viewport?a.fitBounds(t.geometry.viewport):(a.setCenter(t.geometry.location),a.setZoom(17)),r.setPlace({placeId:t.place_id,location:t.geometry.location}),r.addListener("click",function(){e.newSmallVendor.placeObj=e.autoPlace,e.newSmallVendor.name=e.autoPlace.name}),r.setVisible(!0),i.setContent("<div><strong>"+t.name+"</strong><br>Place ID: "+t.place_id+"<br>"+t.formatted_address),i.open(a,r))})}var d=firebase.database().ref();e.newPackages=[],e.newPack={},e.newSite={vendor:!0},e.newSiteBool=!1,e.newSiteAdmin={},e.newVendor={},e.langs=["en","es"],e.addNewSite=function(){var t={newSite:e.newSite};i.newSite(t)},e.adminLoaded(),e.uniqBool=function(e){e&&n(d.child("info").child(e)).$loaded(function(e){return!e})},e.newVendorView=function(t){switch(t){case"small":c(e.currLoc.gmap),e.newSiteBool=!e.newSiteBool;break;case"site":e.newSiteBool=!e.newSiteBool}},e.newSmallVendor={},e.newSmallVendorAdmin={},e.newVendor={},e.addNewSmallVendor=function(){var t={newSmallVendor:e.newSmallVendor};i.newSmallVendor(t)},e.input="",l.getCurrentPosition({timeout:6e4}).then(function(t){e.currLoc.lat=t.coords.latitude,e.currLoc.lng=t.coords.longitude,e.currLoc.loc=[t.coords.latitude,t.coords.longitude],e.currLoc.gmap={lat:t.coords.latitude,lng:t.coords.longitude},c(e.currLoc.gmap)})}]).controller("FleetPickupCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$geolocation",function(e,t,a,o,n,i,r){var l=firebase.database().ref(),c=new GeoFire(l.child("geofire/drivers"));new GeoFire(l.child("geofire/vayas"));o(l.child("vehicles").orderByChild("driver").equalTo(null)).$loaded(function(t){e.vehicles=t}),e.adminLoaded(),e.carSel={},e.location={},e.selectCar=function(){i.pickupVehicle(e.carSel.$id),r.getCurrentPosition({timeout:6e4}).then(function(t){e.location.lat=t.coords.latitude,e.location.lng=t.coords.longitude,e.location.loc=[t.coords.latitude,t.coords.longitude],c.set(a.uid,[t.coords.latitude,t.coords.longitude])}),o(l.child("vayas").orderByChild("hail").equalTo(-1)).$loaded(function(t){e.hails=t})}}]).controller("MapCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$geolocation","uiGmapIsReady","Auth",function(e,t,a,o,n,i,r,l,c){var d=firebase.database().ref(),s=(new GeoFire(d.child("geofire/drivers")),new GeoFire(d.child("geofire/locs"))),u=new GeoFire(d.child("geofire/products")),m=new GeoFire(d.child("geofire/vayas"));n(d.child("vehicles")).$loaded(function(t){e.vehicles=t});var f=c.auth.$getAuth(),p=new google.maps.DirectionsRenderer,h=new google.maps.DirectionsService;new google.maps.Geocoder;e.products=[],e.directions={origin:"Placa Catalunya, Barcelona",destination:"Enter Destination",showList:!1,distance:0,fare:0},e.search={tag:"tours"},e.setHere=function(){e.directions.origin="41.387662,2.170166"},e.hailNow=function(){if(e.hailLoc){var t=e.directions;t.status=-1,o(d.child("vayas")).$add(t).then(function(t){alert("Waiting for Driver to accept!"),m.set(t.key,e.hailLoc)})}},e.getDirections=function(){var t={origin:e.directions.origin,destination:e.directions.destination,travelMode:google.maps.DirectionsTravelMode.DRIVING};h.route(t,function(t,a){if(a===google.maps.DirectionsStatus.OK){var o=0;p.setDirections(t),p.setMap(e.instanceMap),angular.forEach(t.routes[0].legs,function(e){o+=e.distance.value}),e.directions.distance=o}else alert("Google route unsuccesfull!")})},e.hailLoc,e.viewRight=function(t,a,o){e.rightObj=o},r.getCurrentPosition({timeout:6e4}).then(function(t){s.set(a.uid,[t.coords.latitude,t.coords.longitude]).then(function(){d.child("profiles/"+f.uid+"/location").set([t.coords.latitude,t.coords.longitude]),e.hailLoc=[t.coords.latitude,t.coords.longitude];var a=u.query({center:e.hailLoc,radius:25});e.map={control:{},center:{latitude:e.hailLoc[0],longitude:e.hailLoc[1]},zoom:15},a.on("key_entered",function(t,a,o){var n=e.dispArrObj.$getRecord(t);n.location={latitude:a[0],longitude:a[1]},n.distance=o,n.pid=t,n.clickEv=function(t){e.rightObj=t},e.products.push(n)})})}),e.vayaQuery={},e.vayaQ=function(){calcRoute(e.hailLoc,e.vayaQuery.destination)},e.vayaObj={},e.map={control:{},show:!0,center:{latitude:41.387662,longitude:2.170166},zoom:12},e.options={scrollwheel:!1},e.hailmap={center:{latitude:51.219053,longitude:4.404418},zoom:14},e.kmlOpts,e.map.control={},l.promise(1).then(function(t){e.instanceMap=t[0].map,e.kmlOpts={url:"/assets/tktrrecs.kml"}})}]).controller("VayaSelectCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$geolocation","uiGmapIsReady",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref(),d=(new GeoFire(c.child("geofire/drivers")),new GeoFire(c.child("geofire/locs"))),s=new GeoFire(c.child("geofire/vayas"));e.hailLoc,e.vayas=[],e.vayaClass=function(e){switch(e){case-1:return"hailing";case 0:return"waiting";case 1:return"enroute"}},r.getCurrentPosition({timeout:6e4}).then(function(t){d.set(a.uid,[t.coords.latitude,t.coords.longitude]).then(function(){c.child("profiles/"+a.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]}),e.hailLoc=[t.coords.latitude,t.coords.longitude];var o=s.query({center:e.hailLoc,radius:15});e.map={control:{},center:{latitude:e.hailLoc[0],longitude:e.hailLoc[1]},zoom:12},o.on("key_entered",function(t,a,o){n(c.child("vayas").child(t)).$loaded(function(t){var n=t;n.fare_distance=o,n.fare_location=a,e.vayas.push(n)})})})})}]).controller("FunkyCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$geolocation","uiGmapIsReady","$mdpTimePicker","$stateParams",function(e,t,a,o,n,i,r,l,c,d){var s,u=firebase.database().ref(),m=new GeoFire(u.child("geofire/drivers")),f=new GeoFire(u.child("geofire/locs")),p=new GeoFire(u.child("geofire/rickshaws"));e.drivers=[],n(u.child("vehicles")).$loaded(function(t){e.vehicles=t});var h=new google.maps.DirectionsRenderer,g=new google.maps.DirectionsService;new google.maps.Geocoder;e.directions={origin:"Placa Catalunya, Barcelona",destination:"Enter Destination",showList:!1,distance:0,fare:0},e.setHere=function(){e.currLoc.gmap&&(e.directions.origin=e.currLoc.gmap)},e.hailNow=function(){if(e.hailLoc){var t=e.directions;t.status=-1,o(u.child("vayas")).$add(t).then(function(t){alert("Waiting for Driver to accept!"),p.set(t.key,e.hailLoc)})}},e.getDirections=function(){var t={origin:e.directions.origin,destination:e.directions.destination,travelMode:google.maps.DirectionsTravelMode.BICYCLING};g.route(t,function(t,a){if(a===google.maps.DirectionsStatus.OK){var o=0;h.setDirections(t),h.setMap(e.instanceMap),angular.forEach(t.routes[0].legs,function(e){o+=e.distance.value}),e.directions.distance=o}else alert("Google route unsuccesfull!")})},e.hailLoc,r.getCurrentPosition({timeout:6e4}).then(function(t){f.set(a.uid,[t.coords.latitude,t.coords.longitude]).then(function(){u.child("profiles/"+a.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]}),e.hailLoc=[t.coords.latitude,t.coords.longitude];var o=m.query({center:e.hailLoc,radius:15});e.map={control:{},center:{latitude:e.hailLoc[0],longitude:e.hailLoc[1]},zoom:12},o.on("key_entered",function(t,a,o){n(u.child("drivers").child(t)).$loaded(function(t){e.drivers.push(t)})})})}),e.vayaQuery={},e.vayaQ=function(){calcRoute(e.hailLoc,e.vayaQuery.destination)},e.vayaObj={},e.map={control:{},center:{latitude:41.387662,longitude:2.170166},zoom:12},e.options={scrollwheel:!1},e.hailmap={center:{latitude:51.219053,longitude:4.404418},zoom:14},e.viewVal=2,e.viewChange=function(t){e.viewVal=t},e.map.control={},l.promise(1).then(function(t){e.instanceMap=t[0].map,s=t[0].map;var a=document.getElementById("destinput"),o=document.getElementById("originput"),n=new google.maps.places.Autocomplete(a);n.bindTo("bounds",s);var i=new google.maps.InfoWindow,r=new google.maps.Marker({map:s}),l=new google.maps.places.Autocomplete(o);l.bindTo("bounds",s);var i=new google.maps.InfoWindow,r=new google.maps.Marker({map:s});l.addListener("place_changed",function(){i.close();var t=l.getPlace();e.directions.origin=t.formatted_address}),n.addListener("place_changed",function(){i.close();var t=n.getPlace();e.autoPlace=t,t.geometry&&(t.geometry.viewport?s.fitBounds(t.geometry.viewport):(s.setCenter(t.geometry.location),s.setZoom(17)),e.directions.destination=t.formatted_address,i.open(s,r))})})}]).controller("VayaCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$geolocation","uiGmapIsReady","$mdpTimePicker","$mdMedia","Vaya","DateParser",function(e,t,a,o,n,i,r,l,c,d,s,u){function m(){var t=document.getElementById("originput"),a=document.getElementById("originput"),o=new google.maps.InfoWindow,n=(new google.maps.Marker({map:map}),new google.maps.places.Autocomplete(t));n.bindTo("bounds",map),map.controls[google.maps.ControlPosition.TOP_LEFT].push(t);var o=new google.maps.InfoWindow;new google.maps.Marker({map:map});n.addListener("place_changed",function(){o.close();var t=n.getPlace();e.vayaObj.origin=t.formatted_address});var i=new google.maps.places.Autocomplete(a);i.bindTo("bounds",map),map.controls[google.maps.ControlPosition.TOP_LEFT].push(a);var o=new google.maps.InfoWindow;new google.maps.Marker({map:map});i.addListener("place_changed",function(){o.close();var t=i.getPlace();e.vayaObj.destination=t.formatted_address}),google.maps.event.trigger(map,"resize")}var f=firebase.database().ref(),p=new GeoFire(f.child("geofire/drivers")),h=new GeoFire(f.child("geofire/locs")),g=new GeoFire(f.child("geofire/vayas"));e.drivers=[],e.vehicleMedia={};var v=o(f.child("info").orderByChild("vendor").equalTo("vaya"));v.$loaded(function(t){e.vehicles=t,angular.forEach(t,function(t,a){n(f.child("media").child(a)).$loaded(function(t){e.vehicleMedia[a]=t})})}),e.checkDay=function(t){if(e.vayaQuery.date)return moment(t).isSame(e.vayaQuery.date,"day")},e.rangeArray=[1,2,3,4,5,6,7,8,9,10],o(f.child("dates").child("vaya")).$loaded(function(t){e.hoursArray=u.decode(t)}),e.gridId="",e.gridSelector=function(t){e.gridId=t.$id},e.valiTime=function(e){return moment(e).isSame(moment(e).minutes(0))||moment(e).isSame(moment(e).minutes(0))},e.gridWatcher=function(t){return t==e.gridId?2:1},e.gridMobile=function(t){return!d("xs")&&!d("sm")||t==e.gridId};var b=new google.maps.DirectionsRenderer,y=new google.maps.DirectionsService;new google.maps.Geocoder;e.directions={origin:"Placa Catalunya, Barcelona",destination:"Enter Destination",showList:!1,distance:0,fare:0},e.hours=[1,2,3,4,5,6],e.setHere=function(){e.directions.origin=e.currLoc.lat+","+e.currLoc.lng},e.hailNow=function(){if(e.hailLoc){var t=e.directions;t.status=-1,o(f.child("vayas")).$add(t).then(function(t){alert("Waiting for Driver to accept!"),g.set(t.key,e.hailLoc)})}},e.getDirections=function(){var t={origin:e.directions.origin,destination:e.directions.destination,travelMode:google.maps.DirectionsTravelMode.DRIVING};y.route(t,function(t,a){if(a===google.maps.DirectionsStatus.OK){var o=0;b.setDirections(t),b.setMap(e.instanceMap),angular.forEach(t.routes[0].legs,function(e){o+=e.distance.value}),e.directions.distance=o}else alert("Google route unsuccesfull!")})},e.hailLoc,r.getCurrentPosition({timeout:6e4}).then(function(t){h.set(a.uid,[t.coords.latitude,t.coords.longitude]).then(function(){f.child("profiles/"+a.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]}),e.currLoc.lat=t.coords.latitude,e.currLoc.lng=t.coords.longitude,e.currLoc.loc=[t.coords.latitude,t.coords.longitude],e.currLoc.gmap={lat:t.coords.latitude,lng:t.coords.longitude};var o=p.query({center:e.currLoc.loc,radius:15});e.map={control:{},center:{latitude:e.currLoc.lat,longitude:e.currLoc.lng},zoom:12},o.on("key_entered",function(t,a,o){n(f.child("drivers").child(t)).$loaded(function(t){e.drivers.push(t)})})})}),e.prodInfo={},e.resultsFilter={trips:{}},e.vayaQuery={},e.vayaQ=function(){e.results=[];var t="trips/"+moment(e.vayaQuery.date).format("YYYY-MM-DD")+"-"+moment(e.vayaQuery.time).format("HH-mm");o(f.child("vehicles").orderByChild(t).equalTo(null)).$loaded(function(t){angular.forEach(t,function(t){for(var a=!0,o=2*e.vayaQuery.duration-1,n=0;n<o;){e.resultsFilter.trips[r]=null;var i=moment(e.vayaQuery.time).add(30*n,"m"),r=moment(e.vayaQuery.date).format("YYYY-MM-DD")+"-"+i.format("HH-mm");t.trips&&t.trips[r]&&(a=!1),parseInt(t.capacity)<e.vayaQuery.seats&&(a=!1),n++}a&&(e.results.push(t),e.prodInfo[t.$id]=v.$getRecord(t.pid))})})},e.selectCar=function(t){e.vayaObj.vehicle=t,e.mapShow=!0,m()},e.vayaObj={},e.map={control:{},center:{latitude:41.387662,longitude:2.170166},zoom:12},e.options={scrollwheel:!1},e.hailmap={center:{latitude:51.219053,longitude:4.404418},zoom:14},e.mapShow=!1,e.map.control={},l.promise(1).then(function(t){e.instanceMap=t[0].map,map=t[0].map})}]).controller("DriverTrackerCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$geolocation",function(e,t,a,o,n,i,r,l){var c,d=firebase.database().ref(),s=o(d.child("vayas"));c=o("tktr"==r.vendor?d.child("drivers"):d.child("drivers").orderByChild("staff").equalTo(r.vendor));var u=new GeoFire(d.child("geofire/drivers"));l.getCurrentPosition({timeout:6e4}).then(function(t){u.set(a.uid,[t.coords.latitude,t.coords.longitude]).then(function(){d.child("profiles/"+a.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})}),e.drivers={},e.centerLocObj={lat:t.coords.latitude,lng:t.coords.longitude},e.centerLoc=[t.coords.latitude,t.coords.longitude];var o=u.query({center:e.centerLoc,radius:10}),n=L.map("mapid").setView(e.centerLoc,13);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);o.on("key_entered",function(t,a,o){var i=c.$getRecord(t);i&&(i.currLoc=a,i.distance=o,marker=L.marker(a).addTo(n).bindPopup(i.name+"@"+i.currLoc).openPopup(),i.marker=marker,e.drivers[t]=i)}),o.on("key_moved",function(t,a,o){e.drivers[t].marker.setLatLng(a)})}),e.vayas={},e.loadVayas=function(){var t=u.query({center:e.centerLoc,radius:10});new GeoFire(d.child("geofire/vayas")),t.on("key_entered",function(t,a,o){var n=s.$getRecord(t);n&&(n.currLoc=a,n.distance=o,marker=L.marker(a).addTo(map).bindPopup(n.name+"@"+n.currLoc).openPopup(),n.marker=marker,e.vayas[t]=driver)}),t.on("key_moved",function(t,a,o){e.vayas[t]&&e.vayas[t].marker.setLatLng(a)})}}]).controller("DriveTimeCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$geolocation","$interval",function(e,t,a,o,n,i,r,l,c){var d=firebase.database().ref(),s=new GeoFire(d.child("geofire/drivers"));c(function(){l.getCurrentPosition({timeout:6e4}).then(function(e){s.set(a.uid,[e.coords.latitude,e.coords.longitude]).then(function(){})})},200)}]).controller("AdminDriverCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$geolocation",function(e,t,a,o,n,i,r,l){var c=firebase.database().ref();e.newPackages=[],e.newDriver={available:!0,voucher:r.vendor};var d=new GeoFire(c.child("geofire/drivers")),s=o(c.child("drivers").orderByChild("staff").equalTo(r.vendor));s.$loaded(function(t){e.drivers=t}),e.loadDriverInfo=function(t){e.driverInfo=s.$getRecord(t)},e.newBool="newdriver",e.newDriverAdmin={},e.newVendor={},e.langs=["en","es"],e.addNewDriver=function(){var t={newDriver:e.newDriver,newAdmin:e.newDriverAdmin};i.newDriver(t)},e.signUpDriver=function(e){i.newDriverProvider(e)},l.getCurrentPosition({timeout:6e4}).then(function(t){d.set(a.uid,[t.coords.latitude,t.coords.longitude]).then(function(){c.child("profiles/"+a.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})}),e.user.location=[t.coords.latitude,t.coords.longitude]})}]).controller("AdminFleetCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams",function(e,t,a,o,n,i,r){firebase.database().ref();e.newVehicle={vendor:r.vendor,vehicle:!0},e.addNewVehicle=function(){i.newVehicle(e.newVehicle)}}]).controller("AdminRecCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$geolocation","uiGmapGoogleMapApi","$document",function(e,t,a,o,n,i,r,l,c){function d(t){var a=new google.maps.Map(document.getElementById("map"),{center:t,zoom:13}),o=document.getElementById("pac-input"),n=new google.maps.places.Autocomplete(o);n.bindTo("bounds",a),a.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var r=new google.maps.InfoWindow,l=new google.maps.Marker({map:a});l.addListener("click",function(){r.open(a,l)}),n.addListener("place_changed",function(){r.close();var t=n.getPlace();e.autoPlace=t,t.geometry&&(t.geometry.viewport?a.fitBounds(t.geometry.viewport):(a.setCenter(t.geometry.location),a.setZoom(17)),l.setPlace({placeId:t.place_id,location:t.geometry.location}),l.addListener("click",function(){i.googleRec(e.autoPlace,e.newRec.cat)}),l.setVisible(!0),r.setContent("<div><strong>"+t.name+"</strong><br>Place ID: "+t.place_id+"<br>"+t.formatted_address),r.open(a,l))})}e.newBool=!0,e.newRec={},e.langs=["en","es"],e.cats=["club","shop","restaurant","bar","test","sights"],e.addNewRec=function(){i.newRec(e.newRec)},e.gAdd=!0,e.googleAdd=function(){e.gAdd=!e.gAdd},e.grabLoc=function(){e.newRec.location={},r.getCurrentPosition({timeout:6e4}).then(function(t){e.newRec.location.lat=e.currLoc.lat,e.newRec.location.lng=e.currLoc.lng,e.newRec.location.loc=e.currLoc.loc})},e.input="",l.then(function(){r.getCurrentPosition({timeout:6e4}).then(function(t){e.currLoc.lat=t.coords.latitude,e.currLoc.lng=t.coords.longitude,e.currLoc.loc=[t.coords.latitude,t.coords.longitude],e.currLoc.gmap={lat:t.coords.latitude,lng:t.coords.longitude},d(e.currLoc.gmap)})})}]).controller("AdminMenusCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$mdMedia","DateParser",function(e,t,a,o,n,i,r,l,c){var d,s=firebase.database().ref(),u=firebase.storage().ref();e.menuItems=[],e.centerMenuItem,d=o(s.child("menu_items")),d.$loaded(function(t){e.menuItems=t,e.centerMenuItem=e.menuItems[0],e.adminLoaded()}),o(s.child("restaurants")).$loaded(function(t){e.restaurants=t,e.restaurant=t[0]}),console.log(e.menuItems),e.newMenuItem={vendor:r.vendor,extras:[],options:[]},e.addExtra=function(){e.newMenuItem.extras.push(e.newMenuItemExtra),e.newMenuItemExtra={}},e.addOpt=function(){e.newMenuItem.options.push(e.newMenuItemOption),e.newMenuItemOption={}},e.newMenuItemOption={},e.newMenuItemExtra={},e.productTags=["burgers","pizza","noodles","sushi","italian","pasta","turkish","vegetarian","carnivore","drinks"],e.subTags=[],e.newMenu={vendor:r.vendor},e.setRestaurantCats=function(){n(s.child("restaurants").child(r.vendor).child("categories")).$bindTo(e,"catObj").then(function(e){})},e.saveMenuItem=function(){i.newMenuItem(e.newMenuItem),e.newMenuItem={vendor:r.vendor},e.showNewBtn=!1},e.showNewBtn=!1,e.upload=function(t){var a=u.child("media").child(r.vendor).child("menu").child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;e.newMenuItem.photo=t,e.showNewBtn=!0})},e.uploadEdit=function(t){var a=u.child("media").child(r.vendor).child("menu").child(t.name).put(t);a.on("state_changed",function(e){},function(e){},function(){var t=a.snapshot.downloadURL;e.editMenuItem.photo=t})},e.loadEdit=function(t){e.editMenuItem={};var a=n(s.child("menu_items").child(t));a.$bindTo(e,"editMenuItem").then(function(e){}),e.newBool="editMenuItem"},e.editMenuItemData={},e.saveEdit=function(t){"tag"==t||"price"==t?e.editMenuItem[t]=e.editMenuItemData[t]:o(s.child("translations").child(e.editLang)).$add(e.editMenuItemData[t]).then(function(a){e.editMenuItem[t]=a.key})},e.langs=["en","es"],e.newBool="",e.boolSwitch=function(t){e.newBool=t},e.deleteMenuItem=function(e){s.child("menu_items").child(e).remove()}}]).controller("AdminFreebiesCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$mdMedia","DateParser",function(e,t,a,o,n,i,r,l,c){
var d,s,u=firebase.database().ref();e.tktrFilter={tktr:!0},e.newFreebie={},n(u.child("packages")).$loaded(function(t){e.packOpts=t}),e.editFreebie={},"tktr"==r.vendor?(d=n(u.child("info")),d.$loaded(function(t){e.infoObj=t}),s=o(u.child("freebies")),s.$loaded(function(t){e.freebies=t})):(s=o(u.child("freebies").orderByChild("dist").equalTo(r.vendor)),s.$loaded(function(t){e.freebies=t})),e.langs=["en","es"],e.newBool="newFreebie",e.loadEdit=function(t){var a=n(u.child("freebies").child(t));a.$bindTo(e,"editFreebie").then(function(e){}),e.newBool="editFreebie"},e.deletePromo=function(e){s.child(e).$remove()},e.saveNewFreebie=function(){s.$add(e.newFreebie)}}]).controller("AdminProductCtrl",["$scope","$http","InfoService","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$mdMedia","DateParser","$mdDialog","$translate","$state",function(e,t,a,o,n,i,r,l,c,d,s,u,m){var f=firebase.database().ref();e.adminLoaded(),i(f.child("info").child(l.id)).$bindTo(e,"editProduct").then(function(t){e.stockProd=e.editProduct,i(f.child("translations").child("en").child(e.editProduct.name)).$bindTo(e,"enName").then(function(){console.log(e.esDetails)}),i(f.child("translations").child("es").child(e.editProduct.name)).$bindTo(e,"esName").then(function(){console.log(e.esDetails)}),i(f.child("translations").child("en").child(e.editProduct.description)).$bindTo(e,"enDesc").then(function(){console.log(e.esDetails)}),i(f.child("translations").child("es").child(e.editProduct.description)).$bindTo(e,"esDesc").then(function(){console.log(e.esDetails)}),i(f.child("translations").child("en").child(e.editProduct.details)).$bindTo(e,"enDetails").then(function(){console.log(e.esDetails)}),i(f.child("translations").child("es").child(e.editProduct.details)).$bindTo(e,"esDetails").then(function(){console.log(e.esDetails)}),e.loadStock(l.id)}),e.editProduct={},e.editText={en:{},es:{}},e.newPackages=[],e.addPackage=function(){e.newPackages.push({langs:e.translations,pack:e.newPack}),e.translations={en:{},es:{}},e.newPack={vendor:l.vendor,parent:l.id}},e.newPack={vendor:l.vendor,parent:l.id},e.translations={en:{},es:{}},e.savePackages=function(){e.stockProd.pid=l.id,r.newPacks(e.stockProd,e.newPackages).then(function(t){e.newlyMintedPacks=t,e.packAdder=!1})},e.newStockObj={},e.addNewStock=function(){for(var t=0;t<e.newStockObj.multiplier;t++){var a={stockNo:e.itemStock.length+1,vendor:l.vendor,product:e.packageEditID,vendor_location:e.newStockObj.vendor_location};n(f.child("stock").child(e.packageEditID)).$add(a)}},e.itemStockCal=[];for(var p=(moment(),0);p<7;p++)e.itemStockCal.push(p);e.stockProd,e.printVal=function(){},e.editValue=function(t,a){var o={key:t,dayKey:a,id:e.stockProd.$id},n=angular.element(document.body);s.show({parent:n,templateUrl:"templates/stockModal.html",locals:{dayObj:o},controller:"StockModalCtrl"})},e.addStockTime=function(t,a){var o={dayKey:t,id:e.stockProd.$id};a&&(o.time=a);var n=angular.element(document.body);s.show({parent:n,templateUrl:"templates/newstockmodal.html",locals:{dayObj:o},controller:"NewStockModalCtrl"})},e.multiAdd=function(t){var a={dayKey:t,id:e.stockProd.$id},o=angular.element(document.body);s.show({parent:o,templateUrl:"templates/multiStockModal.html",locals:{dayObj:a},controller:"MultiStockModalCtrl"})},e.loadStock=function(t){console.log(t);var a=moment().format("YYYY-MM-DD"),o=moment().add(28,"days").format("YYYY-MM-DD");e.packageEditID=t,e.product=e.stockProd,bookObj=i(f.child("static_stock").child(t).orderByKey().startAt(a).endAt(o)),bookObj.$loaded(function(t){e.stockBookings=t}),dateArray=n(f.child("dates").child(t));for(var r=moment(a);r.diff(o,"days")<=0;r.add(1,"days")){var c=r.format("YYYY-MM-DD");e.stockDayKeys.push(c)}e.stockProd&&e.stockProd.tktr&&(n(f.child("stock").child(t)).$loaded(function(t){e.itemStock=t}),n(f.child("vendor_locations").orderByChild("vendor").equalTo(l.vendor)).$loaded(function(t){e.vendorLocs=t})),e.newBool="stock"}}]).controller("AdminProductsCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$mdMedia","DateParser","$mdDialog",function(e,t,a,o,n,i,r,l,c,d){var s=firebase.database().ref();e.pArray,"tktr"==r.vendor?(e.pArray=o(s.child("info").orderByChild("vendor").equalTo("tktr")),e.pArray.$loaded(function(t){e.products=t,e.adminLoaded()})):(e.pArray=o(s.child("info").orderByChild("vendor").equalTo(r.vendor)),e.pArray.$loaded(function(t){e.products=t})),e.adminLoaded(),e.stCheck={};var u=[9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],m=["00",15,30,45];e.hours=[],angular.forEach(u,function(t){angular.forEach(m,function(a){var o=t+"-"+a;e.hours.push(o),e.stCheck[o]=!1})}),e.setComms=function(){n(s.child("vendors")).$loaded(function(e){var t=e;o(s.child("packages")).$loaded(function(e){angular.forEach(e,function(e){angular.forEach(e,function(a,o){if("$priority"!=o&&"$id"!=o){var n={vendor:a.vendor,item:e.$id},i=parseInt(a.price);if("partybypaul"==a.vendor||"tktr"==a.vendor||"vaya"==a.vendor)n.promo=0,n.company=0,n.merch=.79*i,n.tax=.21*i;else if("funky"==a.vendor)n.promo=5,n.company=5,n.merch=i-10,n.tax=2.1;else if(t[a.vendor]&&"partybypaul"!=a.vendor&&"funky"!=a.vendor&&"tktr"!=a.vendor&&"vaya"!=a.vendor){var r=t[a.vendor].comms;commsTax=i*r*.21,actComms=i*r-commsTax,n.promo=actComms/2,n.company=actComms/2,n.merch=i-i*r,n.tax=commsTax}t[a.vendor]&&(s.child("ratios").child(o).set(n),s.child("packages").child(e.$id).child(o).child("tax").set(n.tax))}})})})})},e.itemHourlyVals=[{},{},{},{},{},{},{}],e.langs=["en","es"],e.newBool="newproduct",e.newProduct={vendor:r.vendor,ticket:!1,comms:15},e.loadEdit=function(t){var a=n(s.child("info").child(t));a.$bindTo(e,"editProduct").then(function(e){}),e.newBool="editproduct"},e.valIndex,e.setFixedStockDaily=function(){angular.forEach(e.itemStockVals,function(t,a){for(var o=0;o<30;o++){var n=moment().add(o,"days").format("YYYY-MM-DD");s.child("static_stock").child(e.stockProd.$id).child(n).child("capacity").set(t)}})},e.addTime=function(){var t=moment(e.newDailyVal.time).day(),a=moment(e.newDailyVal.time).format("HH-mm");e.itemHourlyVals[t][a]={key:a,mnt:moment(e.newDailyVal.time),val:e.newDailyVal.aval}},e.flatValue=0,e.setAll=function(){angular.forEach(e.itemHourlyVals,function(t){angular.forEach(t,function(t,a){t.val=e.flatValue})})},e.setFixedStockHourlyWeek=function(){angular.forEach(e.dayIndexes,function(t){var t=t;angular.forEach(e.itemHourlyVals,function(a){angular.forEach(a,function(a,o){for(var n=0;n<6;n++){var i=moment(a.mnt).day(t).add(7*n,"days").format("YYYY-MM-DD/HH-mm");s.child("static_stock").child(e.stockProd.$id).child(i).child("capacity").set(a.val),s.child("static_stock").child(e.stockProd.$id).child(i).child("available").set(a.val)}})})})},e.setFixedStockHourly=function(){angular.forEach(e.itemHourlyVals,function(t){angular.forEach(t,function(t,a){for(var o=0;o<6;o++){var n=moment(t.mnt).day(e.listOrd).add(7*o,"days").format("YYYY-MM-DD/HH-mm");s.child("static_stock").child(e.stockProd.$id).child(n).child("capacity").set(t.val),s.child("static_stock").child(e.stockProd.$id).child(n).child("available").set(t.val)}})})};var f;e.dayIndex=0,e.deleteTime=function(t,a){var o=moment(t).format("e")+"D"+moment(a).format("HH")+"H"+moment(a).format("mm");angular.forEach(e.purchaseDates,function(e){if(e==o){var t=dateArray$getRecord(e.$id);t.$remove()}}),f.child(id).$remove()},e.dayIndexes=[0,1,2,3,4,5,6],e.stockDates=[],e.listOrd=0,e.setDayFilter=function(t){e.listOrd=t,e.hourList={},e.hourList=e.itemHourlyVals[t]},e.stockDayKeys=[],e.hourList=e.itemHourlyVals[e.listOrd],e.itemStockVals={},e.newPackageForm=function(t){e.newBool="newpacks",e.packageEditID=t,e.newPack={vendor:r.vendor,parent:e.packageEditID},e.product=pArray.$getRecord(t)},e.hasBookings=function(e){return!!e.bookings},e.packageEditID,e.loadPackageEdit=function(t){e.packageEditID=t,e.product=pArray.$getRecord(t),o(s.child("packages").child(t)).$loaded(function(t){e.editPackageArray=t}),e.newBool="editpacks"},e.boolSwitch=function(t){e.newBool=t},e.setProduct=function(t){e.stockProd=t},e.tIndex=0,e.deleteProduct=function(t){var a=n(s.child("info").child(t)),o=n(s.child("media").child(t)),i=n(s.child("packages").child(t));a.$remove(),o.$remove(),i.$remove(),e.newBool="newproduct"},e.gridId="",e.gridSelector=function(t){e.gridId=t.$id},e.gridWatcher=function(t){return t==e.gridId?2:1},e.gridMobile=function(t){return!l("xs")&&!l("sm")||t==e.gridId},e.productTags=["parties","watersports","tours","rentals","outdoor","events","activities","sights","gamedrives","animalinter","adventure"],e.newPackages=[],e.newPack={vendor:r.vendor,parent:e.packageEditID},e.times={mon:{},tue:{},wed:{},thu:{},fri:{},sat:{},sun:{}},e.editLang="en",e.product={},e.addPackage=function(){e.newPackages.push(e.newPack),e.newPack={vendor:r.vendor,parent:e.packageEditID}},e.editProduct={},e.editProductData={},e.saveEdit=function(t){"tag"==t||"price"==t?e.editProduct[t]=e.editProductData[t]:o(s.child("translations").child(e.editLang)).$add(e.editProductData[t]).then(function(a){e.editProduct[t]=a.key})},e.tempDate,e.savePackageEdit=function(t,a){"price"==a||"price"==a?s.child("packages").child(e.packageEditID).child(t).child(a).set(e.editProductData[t][a]):o(s.child("translations").child(e.editLang)).$add(e.editProductData[t][a]).then(function(o){s.child("packages").child(e.packageEditID).child(t).child(a).set(o.key)})},e.editProductData={},e.comms=10,e.vendor=r.vendor,e.translations={en:{},es:{}},e.packAdder=!1,e.saveProduct=function(){i.newProduct(e.newProduct,e.translations).then(function(t){e.newlyMinted=t,e.packAdder=!0})},e.savePackages=function(){i.newPacks(e.comms,e.product,e.newPackages)},e.saveTimes=function(){i.saveTimes()},e.productId=""}]).controller("AdminNewProductCtrl",["$scope","$http","$rootScope","$firebaseArray","$firebaseObject","AdminTools","$stateParams","$mdMedia","DateParser","$mdDialog",function(e,t,a,o,n,i,r,l,c,d){firebase.database().ref();e.newPackages=[],e.addPackage=function(){e.newPackages.push({langs:e.translations,pack:e.newPack}),e.translations={en:{},es:{}},e.newPack={vendor:r.vendor,parent:e.packageEditID}},e.newPack={vendor:r.vendor,parent:e.packageEditID},e.translations={en:{},es:{}},e.packAdder=!1,e.newProduct={vendor:r.vendor},e.saveProduct=function(){i.newProduct(e.newProduct,e.translations,e.newTimes).then(function(t){e.newlyMinted=t,$state.go("app.admin.mng_product.info",{id:newlyMinted.pid})})},e.savePackages=function(){i.newPackages(e.newPackages,e.translations).then(function(t){e.newlyMintedPacks=t,e.packAdder=!1})},e.newTimes=[],e.newTime={hour:"",minute:""},e.pushTime=function(t){console.log(t),e.newTimes.push(t),e.stCheck[t]=!0}}]).controller("PayPalCtrl",["$scope","$http","$rootScope",function(e,t,a){e.uid=a.uid,paypal.checkout.setup("KWPCEZL8SC7XS",{environment:"live",container:"paypalbtn",click:function(){paypal.checkout.initXO();var a={method:"POST",url:"https://www.pbpapi.com/purchases/tktr_pay",data:{uid:e.uid}};t(a).then(function(e){paypal.checkout.startFlow(e.data.token)},function(e){paypal.checkout.closeFlow()})}})}]).controller("UpgradeCtrl",["$scope","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","DateParser",function(e,t,a,o,n,i,r,l,c,d,s,u){var m=firebase.database().ref();if(e.upSellTicket={},e.init=function(t){e.upSellTicket=t},e.upSellTicket.vendor){var f=a(m.child("info").orderByChild("vendor").equalTo(e.upSellTicket.vendor));f.$loaded(function(t){e.upOptions=t})}}]).controller("MyTixCtrl",["$scope","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","DateParser",function(e,t,a,o,n,i,r,l,c,d,s,u){var m=firebase.database().ref();if(e.paramKey,e.init=function(t){e.paramKey=t},n.uid&&(e.paramKey=n.uid),e.paramKey){var f=a(m.child("tix").orderByChild("uid").equalTo(e.paramKey));e.ticketData={},e.auth=r.auth.$getAuth(),t(m.child("packages")).$loaded(function(t){e.packages=t}),e.mapUrls={},f.$loaded(function(a){e.myTix=a,angular.forEach(a,function(n){"NULL"!=n.url&&n.url||o.ticketGen(e.paramKey,n.$id),"pack"==n.parent&&n.item?t(m.child("info").child(n.item)).$loaded(function(t){e.ticketData[n.$id]=t}):"pack"!=n.parent,t(m.child("info").child(n.parent)).$loaded(function(a){e.ticketData[n.$id]=a,t(m.child("vendor_locations").child(a.vendor)).$loaded(function(t){e.mapUrls[n.$id]=t.mailmap})}),a[0]&&(e.loadTicket(a[0]),e.nextTix(1))})}),a(m.child("profiles").child(e.paramKey)).$loaded(function(t){e.tixProfile=t})}e.loadPackTix=function(e){},e.loadTicket=function(t){e.viewTicketData={},e.viewTicket={},e.viewTicketData=e.ticketData[t.$id],e.viewTicket=t},e.showIndex=0,e.nextTix=function(t){var a=e.showIndex+t;a>e.myTix.length-1?(e.showIndex=0,e.loadTicket(e.myTix[e.showIndex])):a<0?e.showIndex=e.myTix.length-1:(e.showIndex=a,e.loadTicket(e.myTix[e.showIndex]))}}]).controller("EventCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock","$translate","DateParser","ProductsService","InfoService","PackageService","User",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k,$,S,P){e.vendorFilter={},e.ymlFilter={},e.prodView||(e.prodView=!0),e.loaderCheck();var A=firebase.database().ref();e.paramKey,e.init=function(t){e.paramKey=t},r.id&&(e.paramKey=r.id),e.eventClearer(),e.mainView=!1,e.ivView="details",e.iHudUp=function(t){e.gotoAnchor("purchase"),e.ivView=t},e.ivMediaBool=!0,e.launchMedia=function(e){},P.anonAdsArrival().then(function(t){e.user=t.profile,e.auth=t.auth}),e.info={};var _=firebase.database().ref("geofire/locs");new GeoFire(_);e.buyNow=!1,e.showBuy=function(){e.buyNow=!e.buyNow},e.productFadeImg={},e.affOpts=[],e.paramKey&&(e.affOpts=[],$.getInfo(e.paramKey).then(function(t){e.info=t,t.aff_tix&&angular.forEach(t.aff_tix,function(t,a){"viator"==a?angular.forEach(t,function(t,o){A.child("affiliates").child(a).child("products").child(o).once("value",function(t){var o=t.val();o.provider=a,e.affOpts.push(o)})}):angular.forEach(t,function(t,o){A.child("affiliates").child(a).child(o).once("value",function(t){if(t){var o=t.val();o.provider=a,e.affOpts.push(o)}})})}),y(t.name).then(function(t){e.infoName=t},function(a){e.infoName=t.name});var a,o;"recs"==t.tag&&t.cat?(o="cat",a=t.cat,e.ymlFilter={tag:"recs",cat:a}):(o="tag",a=t.tag,e.ymlFilter={tag:a}),e.productFadeImg="background: url('"+e.info.wide_branding+"'); background-size: 100% 100%; background-repeat: no-repeat; opacity: 0.5; background-size: cover; background-position: left;",k.getCategory(a).then(function(t){e.displayArray=t,f(function(){window.prerenderReady=!0},3e3)}),e.ymlFilter.tag=e.info.tag,"recs"==e.info.tag&&(e.ymlFilter={tag:"recs",cat:e.info.cat}),e.vendorFilter.vendor=e.info.vendor,e.search={},e.info&&"recs"==e.info.tag?(e.search.cat=e.info.cat,e.search.tag="recs"):e.info&&e.paramKey&&S.getPackages(e.paramKey).then(function(t){e.packages=t}),e.search={tag:e.info.tag}})),e.timeCheck=function(t){if(t){var a=moment(t).format("YYYY-MM-DD");e.build.date=a,e.times=Object.keys(e.buildStatStock[a])}else if(e.builderDate&&e.buildStatStock){var a=moment(e.builderDate).format("YYYY-MM-DD");e.build.date=a,e.times=Object.keys(e.buildStatStock[a])}else e.times=[]},e.setTime=function(t,a){e.build.time=t,a&&e.checkStatic()},e.timeEnqCheck=function(){if(!e.enquireObj.date)return e.times=[];var t=moment(e.enquireObj.date).format("YYYY-MM-DD");e.times=Object.keys(e.buildStatStock[t])},e.selTime=function(t){if(e.buildStatStock&&e.build.date){var a=moment(e.build.date).format("YYYY-MM-DD");e.buildStatStock[a][t].available>0?e.build.time=t:$mdToast.show($mdToast.simple().textContent("Unavailable!"))}else $mdToast.show($mdToast.simple().textContent("Unavailable!"));e.build.time=t},e.filterTimes=function(t){var a=[];angular.forEach(e.times,function(e){moment(e.mnt).isSame(moment(t),"day")&&a.push(e)}),e.times=a},e.buildTimes=function(){if(e.build.date&&e.buildStatStock){var t=moment(e.build.date).format("YYYY-MM-DD");return e.buildStatStock[t]}return{}},e.prettyDate=function(){if(e.build.date){moment(e.build.date).clone().format("YYYY-MM-DD");if(e.build.time.length>6)return moment(e.build.date).clone().format("lll");var t=e.build.time.split("-");return moment(e.build.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.gallery=[],e.distance=function(){if(e.info&&e.info.location&&e.userLoc)return GeoFire.distance([e.info.location.lat,e.info.location.lng],e.userLoc)},e.builderDate=new Date,e.todayDate=new Date,e.minDate=new Date(e.todayDate.getFullYear(),e.todayDate.getMonth(),e.todayDate.getDate()),e.maxDate=new Date(e.todayDate.getFullYear(),e.todayDate.getMonth()+8,e.todayDate.getDate()),e.todayFormat=moment().clone().subtract(1,"days").format("YYYY-DD-MM"),e.vrGrow=function(t){return t==e.vrId?4:1},e.vrId="",e.explNow=function(){e.explView=!e.explView},e.growVR=function(t){e.vrId=t},e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},o(A.child("profiles/"+p.uid)).$loaded(function(t){e.user=t}),e.gvrs=[],e.enqDate=function(){if(e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)return moment(e.enquireObj.date).clone().format("lll");var t=e.enquireObj.time.split("-");return moment(e.enquireObj.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.enquireObj={},e.enquireBuild=function(){e.enquireObj.location=e.info.location;e.packages[0],e.packages[0].$id;e.times=[],e.enquireObj={};var t=e.info;angular.forEach(t,function(t,a){e.enquireObj[a]=t}),e.user&&("Guest"!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=e.info.$id,e.enquireObj.parent=t.$id;var a=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+e.info.$id).orderByKey().startAt(a).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0,e.times=[];var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})},e.enquireVBuild=function(t){e.enquireObj.location=a.location;e.packages[0],e.packages[0].$id;e.times=[],e.enquireObj={};var a=e.info;angular.forEach(a,function(t,a){e.enquireObj[a]=t}),e.user&&("Guest"!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=e.info.$id,e.enquireObj.parent=a.$id;var n=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+t).orderByKey().startAt(n).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0,e.times=[];var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})},e.enqNow=function(t){if(e.enquireObj.sending=!0,e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)e.enquireObj.date=e.enquireObj.date.clone().format("lll");else{var o=e.enquireObj.time.split("-");e.enquireObj.date=moment(e.enquireObj.date).clone().hours(parseInt(o[0])).minutes(parseInt(o[1])).format("lll")}}n(A.child("enqs")).$add(e.enquireObj).then(function(o){var n={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.enquireObj.vendor+"/enquire",data:{uid:e.appAuth.uid,enquiry:e.enquireObj},dataType:"json",headers:{"Content-Type":"application/json"}};a(n).then(function(t){e.enquireObj.sent=!0,e.enquireObj={},f(function(){e.enquireObj.sending=!1},5e3)},function(e){}),A.child("profiles").child(e.appAuth.uid).child("name").set(e.enquireObj[t].username),A.child("profiles").child(e.appAuth.uid).child("email").set(e.enquireObj[t].email)})},e.vendorNumber=function(e){A.child("info").child(e).child("phone").on("value",function(e){return e.val()})},e.avalnow=function(){var t=moment(e.build.date).format("YYYY-MM-DD"),a=moment(e.build.time).format("HH-mm");return e.buildStatStock[t]&&e.buildStatStock[t][a]&&e.buildStatStock[t][a].available?e.buildStatStock[t][a].available:e.buildStatStock[t]&&!e.buildStatStock[t][a]&&e.buildStatStock[t].available?e.buildStatStock[t].available:void 0},e.myState=function(e){return paramKey==e},e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.loadImg=function(t){e.centerImg=t},o(A.child("ticketing/"+e.paramKey)).$loaded(function(t){e.ticketing=t}),e.expand=!1,e.checkStatic=function(){console.log(e.build),b.checkStatic(e.build).then(function(t){t?e.build.greenlit=1:e.build.greenlit=2})},e.numbArray=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],e.build={},e.buildPack=function(t){e.buildPack=e.packageData[t][t],e.buildPack.quantity=e.build.quantity},e.surgeBool=function(){var t=!1;if(e.build&&e.build.date&&e.build.weekend_charge){var a=moment(e.build.date).day();angular.forEach(e.build.weekend_charge.days,function(e,o){e==a&&(t=!0)})}return t},e.tObj={};moment().format("YYYY-MM-DD");e.packBuy=function(t){e.ivView="buy",e.builder(t)},e.packVBuy=function(){e.ivView="buy",e.builderVaya()},e.dOpts=[],e.builder=function(t){var a;a=!t.name&&t.val?t.val:t,console.log(a),e.times=[],e.build={},angular.forEach(a,function(t,a){e.build[a]=t}),e.build.date=null,e.build.time=null,e.build.pid=a.$id,e.build.parent=r.id,e.build.weekend_charge&&(e.build.quantity=1),e.buildStatStock={},e.build.greenlit=0,e.tObj={};var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(A.child("static_stock/"+r.id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.tObj={k:[]},e.valiDates={},e.validDates[a]=!0,e.dOpts.push(moment(a).format("ll"))})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+r.id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.clearBuild=function(){e.build=null},e.tempDate={},e.stops=["junta","rraval"],e.builderVaya=function(){e.times=[],e.build={};var t=e.packages[0],a=e.packages[0].$id;angular.forEach(t,function(t,a){e.build[a]=t}),e.build.date=e.tempDate.date,e.build.time=null,e.build.pid=a,e.build.parent=t.parent,e.build.greenlit=0;var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(A.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date),"day")&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date))&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.checkStock=function(){b.checkStock(e.build).then(function(t){t&&(e.build.stock=t,e.build.greenlit=!0)})["catch"](function(t){e.build.time=null,e.build.quantity=null,alert(t)})},e.validDates={},e.today=moment().format("YYYY-MM-DD"),e.validate=function(t){var a=moment(t).format("YYYY-MM-DD");return!e.validDates[a]},e.times=[],e.checkDay=function(t){return moment(t).isSame(e.build.date,"day")},e.indexShift=function(t){var a=e.showIndex+t;a>e.gallery.length-1?e.showIndex=0:a<0?e.showIndex=e.gallery.length-1:e.showIndex=a},e.showIndex=0,e.prettyTime=function(e){var t=e.split("-"),a=t[0]+":"+t[1];return a},e.mediaFilter={},e.currentDate=Date(),e.selectDay=function(t){u(e.currentDate,{targetEvent:t}).then(function(t){e.build.date=moment(t).format("YYYY-MM-DD")})},e.selectBVaya=function(t){u(e.currentDate,{targetEvent:t}).then(function(t){e.tempDate.date=moment(t).format("YYYY-MM-DD"),e.builderVaya()})},e.showTimePicker=function(t){m(e.currentTime,{targetEvent:t}).then(function(a){var o=moment(a).format("HH-mm");e.ticketing[e.build.date][o]?e.build.time=o:e.showTimePicker(t)})},e.imgIndex=0,e.addToCart=function(){e.showCart(),d.addItem(e.build),e.clearBuild()}}]).controller("TablesCtrl",["$scope","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdSidenav",function(e,t,a,o,n,i,r,l,c){var d=firebase.database().ref(),s=r.auth.$getAuth();e.paramKey,e.initBool=!1,e.init=function(t){e.table=t,e.initBool=!0},e.auth=s,e.bTable=!0,e.event,e.tables,e.ticketing,e.table&&(a(d.child("tables").child(e.table.vendor)).$loaded(function(t){e.tables=t},function(e){}),t(d.child("packages").child(e.paramKey)).$loaded(function(t){e.packages=t},function(e){}),a(d.child("tableaddons").child(e.table.vendor)).$loaded(function(t){e.tableaddons=t},function(e){})),console.log(data),console.log(err),e.addTicket=function(){var t=e.packages.pachasingle;t.title=e.event.title,t.artist=e.event.artist,t.date=n.id,t.quantity=1,t.pid="pachasingle",l.addItem(t)},e.buildTable=function(t){e.bTable=e.packages[t],e.bTable.event_title=e.event.title,e.bTable.date=n.id,e.bTable.quantity=1,e.bTable.pid=t},e.addons={},e.newAddon,e.addOn=function(t){t.quantity=1,e.addons[t.$id]=t},e.removeExtra=function(t){e.addons[t]=null},e.addTable=function(t){l.addItem(table),angular.forEach(e.addons,function(e,t){0!=e.quantity&&l.addItem(e)})},e.removeItem=function(e){l.removeItem(e)}}]).controller("TicketingCtrl",["$scope","Cart","$firebaseArray","$firebaseObject","$location","$anchorScroll","$stateParams",function(e,t,a,o,n,i,r){var l=firebase.database().ref("ticketing"),c=a(l.child("defaults"));c.$loaded(function(t){e.clubs=t}),e.clubs=[],e.evList,e.clubHeaderView=!1,console.log(data),e.ticketSale,e.chEvent=function(t,a){e.selEvent=a,e.selEvent.eid=t;var t=t;angular.forEach(e.ticketList,function(a,o){o==t&&(e.seTicketing=a)})},e.selOpt=function(t){switch(e.entOpt=t,t){case"t":var a=o(l.child("tableaddons/"+e.clubSelect.cid));a.$loaded(function(t){e.tableaddons=t});var a=o(l.child("tables/"+e.clubSelect.cid));a.$loaded(function(t){e.tables=t});break;case"s":e.ticketSale=e.packageList[e.clubSelect.single],e.selEvent.date&&(e.ticketSale.date=moment(e.selEvent.date)),e.ticketSale.name=e.selEvent.title,e.selEvent["default"]||(e.ticketSale.price=e.selEvent.price),e.ticketSale.quantity=1,e.ticketSale.pid=e.clubSelect.defaults.single,e.ticketSale.eid=e.selEvent.eid;break;case"x":e.entOpt=!1}},e.qCheck=function(t){e.buildTable&&angular.forEach(e.buildTable.addons,function(e,a){return a==t?e.quantity:0})},e.addOn=function(t){e.buildTable.addons[t]?(e.buildTable.addons[t].quantity+=1,e.buildTable.total+=value.price):(e.buildTable.addons[t]=e.tableaddons[t],e.buildTable.addons[t].quantity=1)},e.reOn=function(t){e.buildTable.addons[t].quantity>1?(e.buildTable.addons[t].quantity-=1,e.buildTable.total-=e.buildTable.addons[t].price):(e.buildTable.total-=e.buildTable.addons[t].price,e.buildTable.addons[t]=!1)},e.entOpt="",e.tableExtras=[],e.selTable=function(t,a){var t=t;e.buildTable=e.seTicketing.tables[t],e.buildTable.addons={},e.buildTable.total=e.seTicketing.tables[t].price,e.buildTable.pid=t,e.tableInfo=e.tables[t]},e.buyTicket=function(){t.addItem(e.ticketSale)},e.clubViewItem=function(t){var a=t.$id;e.infoView=!1,e.buildView=!1,e.clubSelect=t,e.clubSelect.cid=a,e.gotoAnchor("clubs"),e.closeAll(),e.clubView=!0,e.imgIndex=0,e.gallery=e.clubSelect.images,e.centerImg=e.clubSelect.images[e.imgIndex];var n=o(l.child("events/"+a+"/schedule"));n.$loaded(function(t){e.evList=t});var i=o(l.child("packages/"+a));i.$loaded(function(t){e.packageList=t});var r=o(l.child("ticketing/"+a));r.$loaded(function(t){e.ticketList=t})},e.buyTable=function(){var a=e.packageList[e.buildTable.pid];a.pid=e.buildTable.pid,a.quantity=1,t.addItem(a),angular.forEach(e.buildTable.addons,function(a,o){var n=e.packageList[o];n.quantity=e.buildTable.addons[o].quantity,n.name=e.buildTable.addons[o].name,n.pid=o,t.addItem(n)})},e.openView=function(t){switch(t){case"e":e.eHeaderView=!e.eHeaderView,e.oHeaderView=!1,e.tHeaderView=!1,e.rHeaderView=!1,e.wHeaderView=!1,e.recHeaderView=!1,e.clubHeaderView=!1;break;case"o":e.oHeaderView=!e.oHeaderView,e.eHeaderView=!1,e.tHeaderView=!1,e.rHeaderView=!1,e.wHeaderView=!1,e.recHeaderView=!1,e.clubHeaderView=!1;break;case"t":e.tHeaderView=!e.tHeaderView,e.eHeaderView=!1,e.oHeaderView=!1,e.rHeaderView=!1,e.wHeaderView=!1,e.recHeaderView=!1,e.clubHeaderView=!1;break;case"r":e.rHeaderView=!e.rHeaderView,e.eHeaderView=!1,e.oHeaderView=!1,e.tHeaderView=!1,e.wHeaderView=!1,e.recHeaderView=!1,e.clubHeaderView=!1;break;case"w":e.wHeaderView=!e.wHeaderView,e.eHeaderView=!1,e.oHeaderView=!1,e.tHeaderView=!1,e.rHeaderView=!1,e.recHeaderView=!1,e.clubHeaderView=!1;break;case"rec":e.recHeaderView=!e.recHeaderView,e.eHeaderView=!1,e.oHeaderView=!1,e.tHeaderView=!1,e.rHeaderView=!1,e.wHeaderView=!1,e.clubHeaderView=!1;break;case"club":e.clubHeaderView=!e.clubHeaderView,e.eHeaderView=!1,e.oHeaderView=!1,e.tHeaderView=!1,e.rHeaderView=!1,e.wHeaderView=!1,e.recHeaderView=!1}},e.closeThis=function(t){e.clubView=!1},e.closeAll=function(){e.eView=!1,e.rView=!1,e.oView=!1,e.fView=!1,e.wView=!1,e.recView=!1,e.clubView=!1,e.tView=!1,e.buildView=!1,e.catProduct={},e.builtPackage={},e.buildId="",e.imgIndex=0,e.centerImg="",e.gallery=[]},e.buildId="",e.adPrice,e.selectPack=function(t,a){e.buildId=t,e.selPack=a},e.imgView=!1,e.dates=[],e.buildTotal=function(){e.subTotal=e.builtPackage.price*e.builtPackage.quantity},e.build=function(t,a){e.dates=DateParser.decode(a.content.available_dates),e.catBuilder=a.data.packages[t],e.builtPackage=a.data.packages[t],e.builtPackage.pid=t,e.dates&&(e.builtPackage.date=e.dates[0]),e.builtPackage.quantity=1,e.buildTotal(),e.buildView=!0,e.catProduct=a},e.closeGal=function(){e.imgView=!1,e.buildView=!1},e.gallery=[],e.viewGal=function(){e.imgView=!0},e.swipeRight=function(){e.imgIndex<e.gallery.length-1?(e.imgIndex+=1,e.centerImg=e.gallery[e.imgIndex]):e.imgIndex==e.gallery.length-1&&(e.imgIndex=0,e.centerImg=e.gallery[e.imgIndex])},e.swipeLeft=function(){e.imgIndex>0?(e.imgIndex-=1,e.centerImg=e.gallery[e.imgIndex]):0==e.imgIndex&&(e.imgIndex=e.gallery.length-1,e.centerImg=e.gallery[e.imgIndex])},e.buildBack=function(){e.buildView=!1,e.catProduct={}},e.printPack=function(){},e.subTotalFn=function(){if(e.builtPackage)return e.builtPackage.price*e.builtPackage.quantity},e.addToCart=function(){t.addItem(e.builtPackage),e.buildBack(),e.eView=!1}}]).controller("CartCtrl",["$scope","$http","Cart","Auth","User","$window","$mdDialog","$firebaseArray","$geolocation","$state","$mdToast","Promoters","$firebaseObject","$rootScope",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f){var p=firebase.database().ref();if(e.uid=f.uid,e.uid){var h=m(p.child("profiles/"+e.uid));h.$loaded().then(function(a){e.user=a,e.user.voucher||(e.dataForm=!0);
var o="carts/"+e.uid,n="carts/"+e.uid+"/total",i=m(p.child(o));i.$bindTo(e,"cart").then(function(a){0!=e.cart.total&&paypal.checkout.setup("KWPCEZL8SC7XS",{environment:"live",container:"myContainer",click:function(){paypal.checkout.initXO();var a={method:"POST",url:"https://www.pbpapi.com/purchases/",data:{uid:e.uid}};t(a).then(function(e){"free"==e.data.token?d.go("app.purchase_success"):paypal.checkout.startFlow(e.data.token)},function(e){paypal.checkout.closeFlow()})}})},function(e){});var r=m(p.child(n));r.$bindTo(e,"total").then(function(e){},function(e){})})}e.updateData=function(){var t=firebase.database().ref("profiles"),a=m(t.child(e.uid));a.$loaded().then(function(t){!t.voucher&&e.missingData.voucher&&(a.voucher=e.missingData.voucher),!t.email&&e.missingData.email&&(a.email=e.missingData.email),a.$save().then(function(t){s.show(s.simple().textContent("BOOYAKASHA")),e.dataForm=!1},function(e){s.show(s.simple().textContent("FAIL"))})})},e.missingData={},e.emptyCart=function(){a.empty()},e.removeItem=function(e){a.removeItem(e)},e.deliveryCharge={mcd:0,bk:0,kfc:0,other:0,total:0},e.logCart=function(){},e.promocode={},e.dataUrl="",e.purchase,e.ppReturn,e.promocode={},e.showPP=!1,e.checkout=!1,e.animationsEnabled=!0}]).controller("DoorCtrl",["$scope","$firebaseObject","$firebaseArray","$stateParams",function(e,t,a,o){var n=firebase.database().ref(),i=firebase.database().ref("clubs");e.showEdit=!1,e.list=[];var r=t(i.child("tables"));r.$bindTo(e,"tables");var l=t(i.child("events/schedule/"+o.id));l.$loaded(function(t){e.event=t});var r=t(i.child("tables"));r.$loaded(function(t){e.ticketing=t}),e.thisEvent=function(r){e.list=[],e.scanTix={},e.tixTables={},e.eventInfo=r;var l=a(i.child("ticketing/"+o.id+"/list"));l.$loaded(function(a){angular.forEach(a,function(a){t(n.child("profiles/"+a.$id)).$loaded(function(t){var o=t;o.q=a.q,o.checkedIn=a.checkedIn,e.list.push(o)})})});var c=a(i.child("ticketing/"+o.id+"/tables"));c.$loaded(function(t){e.tixTables=t})},e.checkIn=function(e){i.child("ticketing/"+o.club+"/"+item.$id+"/list/"+e+"/checkedIn").set(!0)},e.scanTix={},e.onSuccess=function(t){console.log(data),console.log(profile),angular.forEach(e.list,function(a){a.$id==t&&(e.scanTix.ticket=a)}),angular.forEach(e.tixTables,function(a){a.primary==t&&(e.scanTix.table=a)})},e.onError=function(e){},e.onVideoError=function(e){},e.scanner=!1,e.scanQR=function(){e.scanner=!e.scanner}}]).controller("QRScanner",["$scope","$firebaseObject","$stateParams",function(e,t,a){function o(a){a&&(e.ticketState="pending",t(n.child("tix/"+a)).$loaded(function(a){if(a){e.scanTix.ticket=a,t(n.child("profiles/"+a.uid)).$loaded(function(t){e.scanTix.profile=t}),t(n.child("info/"+a.parent)).$loaded(function(t){e.scanTix.item=t}),t(n.child("packages/"+a.parent+"/"+a.item)).$loaded(function(t){e.scanTix["package"]=t});var o,i=moment(a.time).clone().format("HH-mm");o="00-00"==i?moment(a.time).clone().format("YYYY-MM-DD"):moment(a.time).clone().format("YYYY-MM-DD/HH-mm"),n.child("static_stock").child(a.parent).child(o).child("list").child(a.$id).once("value",function(t){e.ticketState="confirmed"})}}))}var n=firebase.database().ref();e.adminLoaded(),e.scanTix={},e.ticketState="",e.scanNow=function(){e.scanTix={},e.scanner=!e.scanner;var t=new JsQRScanner(o);t.setSnapImageMaxSize(300);var a=document.getElementById("scanner");a&&t.appendTo(a)},e.scanner=!1,e.scanQR=function(){e.scanner=!e.scanner}}]).controller("MapsCtrl",["$scope","$firebaseArray","$geolocation","uiGmapIsReady","$stateParams","$firebaseObject","$translate","$mdMedia","$translate",function(e,t,a,o,n,i,r,l,r){function c(t){i(m.child("info").child(e.paramKey)).$loaded(function(t){t.location?(e.info=t,s={lat:t.location.lat,lng:t.location.lng},t.location.mailmap||m.child("vendor_locations").child(t.vendor).child("mailmap").once("value",function(t){t.val()&&(e.info.location.mailmap=t.val())}),r(e.info.name).then(function(t){t?(u=t,d()):(u=e.info.name,d())})):i(m.child("accomm").child(e.paramKey)).$loaded(function(t){e.info=t,i(m.child("info").child(t.vendor).child("location")).$loaded(function(t){e.hostelInfo=t,e.info.location=t,s={lat:t.lat,lng:t.lng},r(e.info.name).then(function(t){t?(u=t,d()):(u=e.info.name,d())})})})})}function d(){if(l("gt-sm"))var t=new google.maps.Map(document.getElementById("evmap"),{center:s,zoom:15,draggable:!1});else var t=new google.maps.Map(document.getElementById("evmobmap"),{center:s,zoom:15,draggable:!1});var a=new google.maps.InfoWindow,o=new google.maps.Marker({map:t});o.addListener("click",function(){a.open(t,o)});var n={location:{lat:e.info.location.lat,lng:e.info.location.lng}};e.info.placeid&&(n.placeId=e.info.placeid),o.setPlace(n),o.addListener("click",function(){e.openMap()}),a.addListener("click",function(){e.openMap()}),o.setVisible(!0),a.setContent("<div><strong>"+u+"</strong></div>"),a.open(t,o)}var s,u,m=firebase.database().ref();e.paramKey,e.initBool=!1,e.init=function(t){e.paramKey=t,c(t),e.initBool=!0},n.id&&(e.paramKey=n.id,e.initBool||c(n.id)),e.openMap=function(){window.open(e.info.location.mailmap)},o.promise(1).then(function(){a.getCurrentPosition({timeout:6e4}).then(function(t){e.currLoc.lat=t.coords.latitude,e.currLoc.lng=t.coords.longitude,e.currLoc.loc=[t.coords.latitude,t.coords.longitude],e.currLoc.gmap={lat:t.coords.latitude,lng:t.coords.longitude},s&&s.lat&&d()})})}]).controller("StaffDashCtrl",["$scope","$firebaseObject","$firebaseArray","$stateParams","Auth","Clubs",function(e,t,a,o,n,i){var r=firebase.database().ref();e.today={},t(r.child("events/schedule"+o.id)).$loaded(function(t){e.event=t}),t(r.child("accounts/events/"+o.id)).$loaded(function(t){e.today.door=t}),t(r.child("ticketing/"+o.id)).$loaded(function(t){e.today.available=t.available,e.today.tables=t.tables}),t(r.child("defaults")).$loaded(function(t){e.clubInfo=t,e.today.available&&!e.today.door&&(e.today.door=(e.clubInfo.capacity-e.today.available)*e.event.price)}),t(r.child("accounts/staff/"+o.id)).$loaded(function(t){e.today.personal=t}),e.calendar=function(){i.calendar()}}]).controller("StaffManagementCtrl",["$scope","$firebaseObject","$firebaseArray","$stateParams","Auth",function(e,t,a,o,n){var i=firebase.database().ref();e.showFOrm=!1,a(i.child("staff")).$loaded(function(t){e.staff=t}),t(i.child("accounts/staff")).$loaded(function(t){e.staffPay=t}),e.newStaff=function(){e.showForm=!0},e.newStaffObj={working:!1},e.positions=["bar","security","hostess"],e.signUpObj={},e.addStaff=function(){a(i.child("staff")).$add(e.newStaffObj).then(function(t){e.newStaff(),t.child("accounts/staff/"+t.key).set(0).then(function(e){})}),console.log("User "+firebaseUser.uid+" created successfully!")}}]).controller("StaffShiftCtrl",["$scope","$firebaseObject","$firebaseArray","$stateParams","Auth",function(e,t,a,o,n){t(ref.child("roster/"+o.id)).$loaded(function(t){e.roster=t})}]).controller("AdminTicketsCtrl",["$scope","$rootScope","$firebaseObject","$firebaseArray","$stateParams","Auth","PosTools","DateParser","$mdDialog","Ticketing",function(e,t,a,o,n,i,r,l,c,d){var s=firebase.database().ref();e.validDates={},o(s.child("info").orderByChild("vendor").equalTo(n.vendor)).$loaded(function(t){e.vendorProducts=t,e.product=t[0]}),e.ticketsSold={},e.editDate=moment().format("YYYY-MM-DD"),e.updateTix=function(){d.updateTix(e.ticketsSold,e.product.$id,e.editDate)}}]).controller("PosCtrl",["$scope","$rootScope","$firebaseObject","$firebaseArray","$stateParams","Auth","PosTools","DateParser","$mdDialog","Ticketing",function(e,t,a,o,n,i,r,l,c,d){var s=firebase.database().ref();e.validDates={},a(s.child("profiles").child(t.uid)).$loaded(function(t){e.staff=t}),o(s.child("info").orderByChild("vendor").equalTo(n.vendor)).$loaded(function(t){e.vProducts=t,e.loaded()}),e.selProd=function(t){e.prod=t,o(s.child("dates/"+t.$id)).$loaded(function(t){e.times=l.decode(t),e.times&&(e.purchase.date=e.times[0],e.purchase.time=e.times[0])}),o(s.child("packages").child(t.$id)).$loaded(function(t){e.packages=t,e.loadTickets(),angular.forEach(t,function(t){e.purchase.items[t.$id]=t})})},e.quantityChange=function(t,a){e.purchase.items[a].quantity?"down"==t?e.purchase.items[a].quantity-=1:"up"==t&&(e.purchase.items[a].quantity+=1):"up"!=t||e.purchase.items[a].quantity||(e.purchase.items[a].quantity=1)},e.ticketObj={},e.loadTickets=function(){a(s.child("ticketing").child(e.prod.$id).child(moment(e.purchase.date).format("YYYY-MM-DD")).child(moment(e.purchase.time).format("HH-mm"))).$loaded(function(t){e.ticketObj=t,e.ticketObj.available||d.setNew(e.prod.$id,e.purchase.time)})},e.today=moment().format("YYYY-MM-DD"),e.validate=function(t){var a=!0;return angular.forEach(e.times,function(e){moment(e).isSame(t,"day")&&(a=!1)}),a},e.$watch("purchase",function(){e.totalPurchase()}),e.purchase={items:{},total:0},e.total=0,e.posTax=0,e.totalPurchase=function(){e.purchase.total=0,e.purchase.tax=0,e.purchase.quantity=0,angular.forEach(e.purchase.items,function(t,a){t.quantity&&(e.purchase.total+=t.price*t.quantity,e.purchase.tax+=t.tax*t.quantity,e.purchase.quantity+=t.quantity)})},e.addToTotal=function(t){e.purchase.total+=t.price*t.quantity},e.cashSale=function(){angular.forEach(e.purchase.items,function(t,a){t.quantity||(e.purchase.items[a]=null)}),e.purchase.rep=t.uid,e.purchase.date=moment(e.purchase.time).format("YYYY-MM-DD"),e.purchase.time=moment(e.purchase.time).format("HH-mm"),e.purchase.vendor=n.vendor,e.purchase.pid=e.prod.$id,e.changeBool=!0},e.times=[],e.checkDay=function(t){return moment(t).isSame(e.purchase.date,"day")},e.cashOpts=[{value:5,q:0},{value:10,q:0},{value:20,q:0},{value:50,q:0},{value:100,q:0}],e.close=function(){c.hide()},e.up=function(e){e.q+=1},e.down=function(e){e.q+=1},e.closeandPay=function(){r.cashSale(e.purchase),e.changeBool=!1,e.prod=null},e.change=function(){var t=0;return e.other?e.purchase.total-e.other:(angular.forEach(e.cashOpts,function(e){t+=e.value*e.q}),e.purchase.total-t)}}]).controller("DriverMapCtrl",["$scope","$rootScope","$firebaseObject","$firebaseArray","$stateParams","Auth","$geolocation","uiGmapGoogleMapApi","$mdDialog","Ticketing",function(e,t,a,o,n,i,r,l,c,d){r.getCurrentPosition({timeout:6e4}).then(function(a){geoFire.set(t.uid,[a.coords.latitude,a.coords.longitude]).then(function(){s.child("profiles/"+user.uid+"/location").set([a.coords.latitude,a.coords.longitude])}),e.location=[a.coords.latitude,a.coords.longitude]}),e.drivers=[];var s=firebase.database().ref(),u=new GeoFire(s.child("geofire/drivers")),m=u.query({center:e.location,radius:10});m.on("key_entered",function(t,o,n){var i={};a(s.child("drivers").child(t)).$loaded(function(t){angular.forEach(t,function(e,t){i[t]=e}),i.location=o,i.distance=n,e.drivers.push(i)})});l.then(function(t){e.map={center:{latitude:45,longitude:-73},zoom:8}})}]),angular.module("tktr.directives",[]).directive("tagEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){var o=t.which||t.keyCode;13===o&&(e.$apply(function(){e.$eval(a.dlEnterKey)}),t.preventDefault())})}}).directive("backImg",function(){return function(e,t,a){var o=a.backImg;t.css({"background-image":"url("+o+")","background-size":"cover"})}}).directive("disabletap",["$timeout",function(e){return{link:function(){e(function(){container=document.getElementsByClassName("destinput"),angular.element(container).attr("data-tap-disabled","true"),angular.element(container).on("click",function(){document.getElementById("type-selector").blur()}),container2=document.getElementsByClassName("originput"),angular.element(container2).attr("data-tap-disabled","true"),angular.element(container2).on("click",function(){document.getElementById("type-selector").blur()})},500)}}}]).directive("onLongPress",["$timeout",function(e){return{restrict:"A",link:function(t,a,o){a.bind("touchstart",function(a){t.longPress=!0,e(function(){t.longPress&&t.$apply(function(){t.$eval(o.onLongPress)})},600)}),a.bind("touchend",function(e){t.longPress=!1,o.onTouchEnd&&t.$apply(function(){t.$eval(o.onTouchEnd)})})}}}]).directive("myDirective",function(){return{restrict:"EA",scope:{title:"@"},templateUrl:"mytemplate.html",controller:controllerFunction,link:function(e,t,a){}}}).directive("ngDrag",["$document",function(e){return{link:function(t,a,o){function n(e){d=e.pageY-l,c=e.pageX-r,a.css({top:d+"px",left:c+"px"})}function i(){e.off("mousemove",n),e.off("mouseup",i)}var r=0,l=0,c=0,d=0;a.on("mousedown",function(t){t.preventDefault(),r=t.pageX-c,l=t.pageY-d,e.on("mousemove",n),e.on("mouseup",i)})}}}]),angular.module("tktr.filters",[]).filter("unique",function(){return function(e,t){if(t===!1)return e;if((t||angular.isUndefined(t))&&angular.isArray(e)){var a=[],o=function(e){return angular.isObject(e)&&angular.isString(t)?e[t]:e};angular.forEach(e,function(e){for(var t=!1,n=0;n<a.length;n++)if(angular.equals(o(a[n]),o(e))){t=!0;break}t||a.push(e)}),e=a}return e}}).filter("orderObjectBy",function(){return function(e,t){if(!angular.isObject(e))return e;var a=[];for(var o in e)a.push(e[o]);return a.sort(function(e,a){return e=parseInt(e[t]),a=parseInt(a[t]),e-a}),a}}),angular.module("tktr.lodgectrls",["tktr.services"]).controller("ParkCtrl",["$scope","$log","$state","$stateParams","$rootScope","$http","$anchorScroll","$location","$mdMedia","$mdDialog","$timeout","$geolocation","$firebaseObject","$firebaseArray","$translate","User","$mdToast","Auth","$mdSidenav","$mdDialog","$sce","subdomain",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,d,y,w){var k=firebase.database().ref();n.partner=w,e.appPartner=n.partner,e.location,e.partner={},e.currLoc={},e.avFn=function(e){return"tours"!=e&&"sights"!=e?"assets/site/"+e+"_btn.svg":"assets/site/"+e+"za_btn.svg"},e.gMapper=function(e){var t="https://www.google.com/maps/embed/v1/place?key=AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw&q=place_id:"+e+"&zoom=14";return y.trustAsResourceUrl(t)},e.ldgMBool=!0,e.bgFade="",m(k.child("info/"+e.appPartner)).$loaded(function(t){e.partner.info=t,e.loadVrBg()}),e.loaded=function(){n.stateIsLoading=!1},e.loadVrBg=function(e){e||(e="assets/vr/avr1.jpg");new PhotoSphereViewer({panorama:e,container:"vrbg",time_anim:!1,navbar:!1,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1}})},m(k.child("media/"+e.appPartner)).$loaded(function(t){e.partnerMedia=t,console.log(t)}),m(k.child("vendor_locations/"+e.appPartner)).$loaded(function(t){e.partner.location=t}),m(k.child("sites/"+e.appPartner)).$loaded(function(t){e.partner.classes=t}),e.gRoute=function(e){var t=Object.keys(e.stops),a="&origin=place_id:"+e.origin+"&destination=place_id:"+e.destination+"&waypoints=";angular.forEach(t,function(t){a=a+"place_id:"+e.stops[t]+"|"});var o=a.slice(0,-1),n="https://www.google.com/maps/embed/v1/directions?key=AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw&"+o+"&zoom=14&mode="+e.mode;return y.trustAsResourceUrl(n)},e.actFilters=["activities","gamedrives","animalinter","adventure","tour"],e.sLink=function(e){window.open(e)},e.uirefSideNav=function(e,t){b(e).close().then(function(){a.go("app.category.list",{id:t})})},e.youtubeUrl=function(e){var t="https://www.youtube.com/embed/"+e+"?autoplay=0";return y.trustAsResourceUrl(t)},e.trust=function(e){return y.trustAsResourceUrl(e)},e.colGroup=function(e){return e.length},e.closeSNav=function(e,t){b(e).close().then(function(){})},e.mediaQuery=function(e){return c(e)},e.recfilters=[{icon:"assets/site/cat_clubs_btn.svg",text:"club"},{icon:"assets/site/cat_bars_btn.svg",text:"bar"},{icon:"assets/site/cat_restaurants_btn.svg",text:"restaurant"},{icon:"assets/site/cat_shops_btn.svg",text:"shop"},{icon:"assets/site/cat_sights_btn.svg",text:"sights"}],e.filters=[{icon:"assets/site/cat_vipclubbing_btn.svg",text:"parties"},{icon:"assets/site/cat_watersports_btn.svg",text:"watersports"},{icon:"assets/site/cat_tktr_btn.svg",text:"tktr"},{icon:"assets/site/cat_guidedtours_btn.svg",text:"tours"},{icon:"assets/site/cat_rentanything_btn.svg",text:"rentals"},{icon:"assets/site/cat_activities_btn.svg",text:"activities"}],e.partnerlogo="./assets/site/"+e.appPartner+"_logo_btn.svg",e.partnermenu="./assets/site/"+e.appPartner+"_menu_btn.svg",e.partnercart="./assets/site/"+e.appPartner+"_total_btn.svg",e.partnersFilter={partner:!0},e.promoteFilter={promote:!0},e.termsAccepted=!1,e.toggleLeftMenu=function(){b("left").isOpen()?b("left").toggle():b("left").isOpen()||b("right").isOpen()?!b("left").isOpen()&&b("right").isOpen()&&(b("right").toggle(),b("left").toggle()):b("left").toggle()},e.toggleRightMenu=function(){b("right").isOpen()?b("right").toggle():b("right").isOpen()||b("left").isOpen()?!b("right").isOpen()&&b("left").isOpen()&&(b("left").toggle(),b("right").toggle()):b("right").toggle()},e.openPics=function(e,t){console.log(t);var a={images:e,key:t},o=angular.element(document.body);d.show({parent:o,templateUrl:"templates/picModal.html",locals:{imgObj:a},controller:"ImgCtrl"})},e.vrWindow=function(e){var t=a.href("app.vrviewer",{id:e});window.open(t,"_blank")},e.showInfo=function(e){var t=angular.element(document.body);d.show({parent:t,templateUrl:"templates/infoModal.html",locals:{info:e},controller:"InfoModalCtrl"})},e.user,e.auth=v.auth.$getAuth(),e.currentNavItem="Home",e.toggleCart=function(){b("right").toggle()},n.previousState,n.currentState,n.$on("$stateChangeSuccess",function(e,t,a,o,i){n.previousState=o.name,n.currentState=t.name,n.previousParams=i,n.currentParams=a,console.log("Previous state:"+n.previousState+"p"+i),console.log("Current state:"+n.currentState+"p"+a)}),n.previousState&&(e.backBool=!0),e.siteInfo={watersports:"adrenalintitle",tables:"tablestitle",outdoors:"outdoortitle",tours:"tourstitle",rentals:"rentaltitle",contact:"contacttitle",parties:"viptitle"},e.radioShow=!1,e.radioBtn=function(){e.radioObj.paused?e.radioObj.play():e.radioObj.pause()},e.openMap=function(e){window.open(e)},console.log(c("gt-sm")),e.showNav=function(){e.navHide=!e.navHide},e.gotoAnchor=function(e){var t=e;l.hash()!==t?l.hash(e):r()},e.langs=[{lang:"en",sign:"EN"},{lang:"es",sign:"ES"}],e.selectedLang={lang:"en",sign:"EN"},e.back=function(){n.fromParams?a.go(n.previousState,n.fromParams):a.go("lodge.home")},e.updateLang=function(e){console.log("using"+e),k.child("profiles").child(n.uid).child("l18n").set(e),p.use(e)},e.appAuth=v.auth.$getAuth(),e.appAuth&&u.getCurrentPosition({timeout:6e4}).then(function(t){$.set(n.uid,[t.coords.latitude,t.coords.longitude]).then(function(){console.log("Provided key has been added to GeoFire"),k.child("profiles/"+n.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})}),e.currLoc.location=[t.coords.latitude,t.coords.longitude],e.user.location={lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]}});var $=new GeoFire(k.child("geofire/locs"));firebase.auth().onAuthStateChanged(function(t){if(console.log(t),t)if(t.isAnonymous){var o=e.appPartner;e.user={name:"Guest",uid:t.uid,voucher:o,image:"https://firebasestorage.googleapis.com/v0/b/pachapitch.appspot.com/o/Icon_Guest%20Cherry.svg?alt=media&token=8f8f56d3-4eaf-4ccb-a540-f1bab3ec9777"},n.uid=t.uid,console.log(n.uid),m(k.child("profiles/"+t.uid)).$loaded(function(t){e.user=t}),u.getCurrentPosition({timeout:6e4}).then(function(a){$.set(t.uid,[a.coords.latitude,a.coords.longitude]).then(function(){console.log("Provided key has been added to GeoFire"),k.child("profiles/"+t.uid+"/location").set({lat:a.coords.latitude,lng:a.coords.longitude,location:[a.coords.latitude,a.coords.longitude]})}),e.currLoc.location=[a.coords.latitude,a.coords.longitude],e.user.location={lat:a.coords.latitude,lng:a.coords.longitude,location:[a.coords.latitude,a.coords.longitude]}}),m(k.child("carts").child(t.uid)).$bindTo(e,"cart").then(function(e){console.log(e)})}else m(k.child("profiles").child(t.uid)).$loaded(function(t){e.user=t}),m(k.child("carts").child(t.uid)).$bindTo(e,"cart").then(function(e){console.log(e)});else n.uid=null,a.go("app.landing")}),e.user&&!e.user.location&&u.getCurrentPosition({timeout:6e4}).then(function(t){$.set(e.user.uid,[t.coords.latitude,t.coords.longitude]).then(function(){console.log("Provided key has been added to GeoFire"),k.child("profiles/"+e.user.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})}),e.currLoc.location=[t.coords.latitude,t.coords.longitude],e.user.location=[t.coords.latitude,t.coords.longitude]})}]).controller("LodgeMediaCtrl",["$scope","$firebaseArray","$firebaseObject","$stateParams","$sce","$timeout",function(e,t,a,o,n,i){e.videos=[],e.paramKey,e.mediaBool="img",e.initBool=!1,o.id?(e.paramKey=o.id,console.log(e.paramKey)):!o.id&&e.appPartner&&(e.paramKey=e.appPartner,console.log(e.paramKey)),e.initMedia=function(t){e.paramKey=t,loadMedia(),e.initBool=!0},e.mediaColFn=function(t){if(e.mediaBool&&e.partner&&e.partner.classes)return e.mediaBool==t?e.partner.classes.accent:e.partner.classes.color},e.brander=function(e){return console.log(e,0==e),0==e?"2:1":"4:3"},e.setBool=function(t){e.mediaBool=t,"vr"==t&&i(function(){e.loadVR(e.vrGal[0])},500)},e.vrIndex=0,e.vrShift=function(t){if(0==t)e.vrIndex=[Math.floor(Math.random()*e.vrGal.length)],e.loadVR(e.vrGal[e.vrIndex]);else{var a=e.vrIndex+t;a>e.vrGal.length-1?(e.vrIndex=0,e.loadVR(e.vrGal[e.vrIndex])):a<0?(e.vrIndex=e.vrGal.length-1,e.loadVR(e.vrGal[e.vrIndex])):(e.vrIndex=a,e.loadVR(e.vrGal[e.vrIndex]))}},e.hideBranding=function(t){return!angular.equals(e.media.wide_branding,t)},e.showMedia=function(t){return e.mediaBool==t},e.colGroup=function(e){return e.length>3?e.length:4},o.id&&!e.initBool?(e.paramKey=o.id,console.log(e.paramKey)):o.id||!e.appPartner||e.initBool?e.initBool&&console.log(e.paramKey):(e.paramKey=e.appPartner,console.log(e.paramKey)),e.colGen=function(e,t,a){return e||t||a?2:1};var r=firebase.database().ref();e.rhIndex=function(){return 0==e.showIndex?"2:1":"4:3"},e.gallery=[],e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},e.gvrs=[],e.sourceArr=[];var l;e.bgFade="",e.paramKey&&(l=a(r.child("media/"+e.paramKey)),l.$loaded(function(t){e.media=t,e.media&&e.media.vr_bg?(e.loadVrBg(e.media.vr_bg),e.bgFade=""):e.media&&(e.bgFade="background-image: url('"+e.media.wide_branding+"'); background-size: cover; background-repeat: no-repeat; background-position: center;");var a={url:t.wide_branding};e.gallery.push(a),angular.forEach(t.images,function(t,a){t.id=a,e.gallery.push(t),e.centerImg=e.gallery[0]}),angular.forEach(t.gvr,function(t,a){var o=t;o.id=a,o.url=n.trustAsResourceUrl(t.url),e.gvrs.push(o)}),console.log(t.video),angular.forEach(t.video,function(t,a){var o=t;o.id=a,e.videos.push(o),e.sourceArr.push({src:n.trustAsResourceUrl(o.url),type:"video/mp4"}),console.log(e.videos)}),angular.forEach(t.vr,function(t,a){var o=t;o.id=a,e.vrGal.push(t)}),e.config={autohide:!0,autohideTime:1,autoPlay:!0,sources:e.sourceArr,theme:"bower_components/videogular-themes-default/videogular.css",plugins:{poster:e.media.wide_branding}}})),e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!0,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.colSquare=function(e){return e.length%2==e.length%3?3:e.length%2==0&&e.length%2!=e.length%3?2:e.length%3==0&&e.length%2!=e.length%3?3:void 0},e.loadImg=function(t){e.centerImg=t},e.indexShift=function(t,a){if(0==a)e.showIndex=[Math.floor(Math.random()*t.length)];else{var o=e.showIndex+a;o>t.length-1?e.showIndex=0:o<0?e.showIndex=t.length-1:e.showIndex=o}},e.showIndex=0}]).controller("LodgeScreenCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","$anchorScroll","$location","$mdToast","$mdSidenav",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k){var $=firebase.database().ref();e.partyArray=[],e.actArray=[],e.tourArray=[],e.rentalArray=[],e.wsArray=[],e.eventsArray=[],e.select={},e.gridId,e.vendorFilter={},m.$watch("stateIsLoading",function(){m.stateIsLoading&&i(function(){m.stateIsLoading&&(m.stateIsLoading=!1),FB.XFBML.parse()},5e3)}),e.partner&&e.partner.info&&e.partner.info.vGroup?e.vendorFilter={vGroup:e.partner.info.vGroup}:e.vendorFilter={vendor:e.appPartner},e.parkFilter={park:e.appPartner},e.tktrFilter={vGroup:"tktr"},e.closeHud=function(){e.hudView=!1,console.log("hudview 0 "+e.hudView)},e.closeiHud=function(){h.go("lodge.home.dash")},e.dashGo=function(t){e.closeHud(),e.catView=!1,h.go("lodge.home.dash.info",{id:t.$id})},e.dashLodgeGo=function(t){e.closeHud(),e.catView=!1,h.go("lodge.home.dash.lodges",{id:t.$id})},e.dashRoomGo=function(t){e.closeHud(),e.catView=!1,h.go("lodge.home.dash.room",{lodge:t.lodge,id:t.$id})},e.dashGoRoomMenu=function(t){k("left").close().then(function(){h.go("lodge.home.dash.info",{id:t.$id}),e.closeHud(),e.catView=!1})},e.dashGoMenu=function(t){console.log("hudview = "+e.hudView),k("left").close().then(function(){e.closeHud(),h.go("lodge.home.dash.info",{id:t.$id}),console.log("hudview 0 "+e.hudView)})},e.loadVrBg=function(e){e||(e="assets/site/sights.jpg");new PhotoSphereViewer({panorama:e,container:"vrbg",time_anim:!1,navbar:!1,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!0}})},e.lView="act",e.setLView=function(t){e.lView=t},e.partnerFilter={vendor:e.appPartner},e.hudUp=function(t){e.hudView=t},e.hudView,o($.child("info").orderByChild("partner").equalTo("acc")).$loaded(function(t){e.accArray=t,console.log(t)}),a($.child("parks").child(e.appPartner)).$loaded(function(t){e.park=t}),o($.child("accomm").orderByChild("park").equalTo(e.appPartner)).$loaded(function(t){e.roomArray=t}),o($.child("lodges").orderByChild("park").equalTo(e.appPartner)).$loaded(function(t){e.lodges=t});var S=o($.child("info").orderByChild("product").equalTo(!0));e.gridDist={},e.showSelect=!1,e.auth=t.auth.$getAuth(),e.eLO={},e.emailLanding=function(){var a="@@"+e.eLO.name+"@@";t.auth.$createUserWithEmailAndPassword(e.eLO.email,a).then(function(t){$.child("profiles").child(t.uid).set({name:e.eLO.name,uid:t.uid,voucher:e.appPartner,email:e.eLO.email})})},e.auth?$.child("profiles").child(e.auth.uid).on("value",function(t){e.user=t.val(),e.user.location||(e.user.location={}),p.getCurrentPosition({timeout:6e4}).then(function(t){e.user.location.lat=t.coords.latitude,e.user.location.lng=t.coords.longitude,e.user.location.loc=[t.coords.latitude,t.coords.longitude],$.child("profiles/"+e.auth.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})})}):t.auth.$signInAnonymously().then(function(t){e.auth=t,e.authBool=!0,m.uid=t.uid,$.child("profiles").child(t.uid).set({name:"Guest",uid:t.uid,voucher:e.appPartner,location:{}}),e.user={name:"Guest",uid:t.uid,voucher:e.appPartner,location:{}},p.getCurrentPosition({timeout:6e4}).then(function(t){e.user.location.lat=t.coords.latitude,e.user.location.lng=t.coords.longitude,e.user.location.loc=[t.coords.latitude,t.coords.longitude],$.child("profiles/"+e.auth.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})})}),e.partner&&!e.partner.info&&$.child("info").child(e.appPartner).on("value",function(t){e.partner.info=t.val()}),e.partnerFlashLogo=!1,"tktr"==e.appPartner&&o($.child("info").orderByChild("partner").equalTo(!0)).$loaded(function(t){e.partnersArr=t;var a=0;s(function(){e.partnerFlashLogo=e.partnersArr[a].partner_logo,a==e.partnersArr.length-1?a=0:a++},1500)}),e.noMediaAlert=function(e){w.show(w.simple().textContent("Sorry! no "+e+" for this!").position("center").hideDelay(2e3))},e.gotoAnchor=function(e){var t=e;y.hash()!==t?y.hash(e):b()},e.gridId="",e.gridSelector=function(t){e.gridId=t.$id},e.gridSugg=function(t){return t==e.gridId},e.centerArr=[],e.switchRoomMenu=function(t){console.log(t),k("left").close().then(function(){e.roomFilt={vendor:t},e.roomVBool=!0})},e.switchRoom=function(t){console.log(t),e.roomFilt={vendor:t},e.roomVBool=!0,e.catView=!1},e.switchArrMenu=function(t){console.log(t),k("left").close().then(function(){"watersports"==t||"tours"==t||"activities"==t||"rentals"==t||"events"==t?(e.search={tag:t},e.arrTitle=t):"tktr"==t?(e.search={vGroup:"tktr"},e.arrTitle=t):"parties"==t?(e.search={tag:"recs",cat:"club"},e.arrTitle=t):"vendor"==t?(e.search={vGroup:e.partner.info.vGroup},e.arrTitle=e.partner.info.name):(e.search={tag:"recs",cat:t},e.arrTitle=t),e.catView=!1,e.roomVBool=!1,console.log(e.search)})},e.switchArr=function(t){console.log(t),"animalinter"==t||"tour"==t||"activities"==t||"gamedrives"==t||"adventure"==t?(e.search={tag:t},e.arrTitle=t):"tktr"==t?(e.search={vGroup:"tktr"},e.arrTitle=t):"parties"==t?(e.search={tag:"recs",cat:"club"},e.arrTitle=t):"vendor"==t?(e.partner.info.vGroup?e.search={vGroup:e.partner.info.vGroup}:e.search={tag:e.partner.info.vendor},e.arrTitle=e.partner.info.name):(e.search={tag:"recs",cat:t},e.arrTitle=t),e.roomVBool=!1,e.catView=!1,console.log(e.search)},e.promoObj={},e.srcObj={},e.posterObj={},e.videos=[{}],e.config={preload:"auto",autoPlay:!0,sources:e.videos[0].sources,theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"},plugins:{poster:"",controls:{autoHide:!1,autoHideTime:3e3}}},e.partnerTube=!1,e.partnerConfig={},a($.child("media")).$loaded(function(t){e.promoMedia=t;var a="https://www.youtube.com/embed/"+e.partnerMedia.youtubeBranding+"?autoplay=1&loop=1&rel=0&playlist="+e.partnerMedia.youtubeBranding+"&version=3";e.partnerTube=c.trustAsResourceUrl(a),angular.forEach(t,function(t,o){if(t.video){e.promoObj[o]={},e.posterObj[o]=t.wide_branding,e.promoObj[o].info=S.$getRecord(o);var n=Object.keys(t.video);t.video[n[0]].url.length>15&&o!=e.appPartner?e.videos.push({poster:t.wide_branding,sources:[{type:"video/mp4",src:c.trustAsResourceUrl(t.video[n[0]].url)}]}):t.video[n[0]].url.length<15&&o!=e.appPartner?(a="https://www.youtube.com/embed/"+t.video[n[0]].url+"?autoplay=0&modestbranding=1rel=0",e.promoObj[o].youtube=c.trustAsResourceUrl(a)):t.video[n[0]].url.length>15&&o==e.appPartner?(e.config.plugins.poster=t.wide_branding,e.videos[0]={sources:[{type:"video/mp4",src:c.trustAsResourceUrl(t.video[n[0]].url)}]}):t.video[n[0]].url.length<=15&&o==e.appPartner&&(a="https://www.youtube.com/embed/"+t.video[n[0]].url+"?autoplay=1&loop=1&rel=0&playlist="+t.video[n[0]].url+"&version=3",e.partnerTube=c.trustAsResourceUrl(a))}}),console.log(e.videos)}),e.catView=!0,e.catViewFlip=function(){e.catView=!e.catView},e.dashHome=function(){e.hudView="info",h.go("lodge.home.dash"),i(function(){e.loaded()},2e3)},e.dashHomeMenu=function(){k("left").close().then(function(){e.hudView="img",h.go("lodge.home.dash"),i(function(){e.loaded()},500)})},e.state=null,e.API=null,e.currentVideo=0,e.onPlayerReady=function(t){e.API=t},e.onCompleteVideo=function(){e.isCompleted=!0,e.currentVideo++,e.currentVideo>=e.videos.length&&(e.currentVideo=0),e.setVideo(e.currentVideo)},e.setVideo=function(t){e.API&&e.API.stop(),e.currentVideo=t,e.config.sources=e.videos[t].sources,i(e.API.play.bind(e.API),100)},e.videos=[{}],S.$loaded(function(t){e.mainArray=t}),e.rFilt={tag:"tours"},e.colGroup=function(e){return e.length}}]).controller("ParkHomeCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","User",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b){var y=firebase.database().ref(),w=firebase.database().ref("geofire/products");new GeoFire(w);e.auth=t.auth.$getAuth(),e.ssiObj={email:""},e.gimmeBool=!1,e.gimmeStyle="color: whitesmoke;",e.safeURL="",
e.initSLog=function(){e.ssiBool=!0,b.initMerge(e.ssiObj),e.safeURL="https://tktr.eu/#/app/tktr/login/"+m.uid+"/safesignin/"+e.ssiObj.email},e.colGroup=function(e){return e.length},e.prettyDate=function(t){if(e.build[t].date&&e.build[t].time){moment(e.build[t].date).clone().format("YYYY-MM-DD");if(e.build[t].time.length>6)return moment(e.build[t].date).clone().format("lll");var a=e.build[t].time.split("-");return moment(e.build[t].date).clone().hours(parseInt(a[0])).minutes(parseInt(a[1])).format("lll")}},e.ssiBool=!1,e.quoteBool={},e.location={},p.getCurrentPosition({timeout:6e4}).then(function(t){e.location.lat=t.coords.latitude,e.location.lng=t.coords.longitude,e.location.loc=[t.coords.latitude,t.coords.longitude],e.auth&&y.child("profiles/"+e.auth.uid+"/location").set({lat:t.coords.latitude,lng:t.coords.longitude,location:[t.coords.latitude,t.coords.longitude]})}),e.search={},e.search.tktr=!0,e.partnerMedia&&e.partnerMedia.vr_bg?(e.loadVrBg(e.partnerMedia.vr_bg),e.bgFade=""):e.partnerMedia&&(e.bgFade="background-image: url('"+e.partnerMedia.wide_branding+"'); background-size: cover; background-repeat: no-repeat; background-position: center;"),a(y.child("parks").child(e.appPartner)).$loaded(function(t){e.park=t}),o(y.child("accomm").orderByChild("park").equalTo(e.appPartner)).$loaded(function(t){e.rooms=t}),o(y.child("lodges").orderByChild("park").equalTo(e.appPartner)).$loaded(function(t){e.lodges=t}),o(y.child("info")).$loaded(function(t){e.actArray=t}),a(y.child("info").child(e.appPartner)).$loaded(function(t){e.partner.info=t,e.partner.bookingInfo=[],t.bookingInfo&&(a(y.child("bkginfo")).$loaded(function(t){e.bookingInfo=t}),angular.forEach(t.bookingInfo,function(t,a){var o=t;o.id=a,e.partner.bookingInfo.push(o)}))}),e.rhIndex=function(){return 0==e.showIndex?"2:1":"4:3"},e.avalnow=function(t){var a=moment(e.build[t].date).format("YYYY-MM-DD"),o=moment(e.build[t].time).format("HH-mm");return e.buildStatStock[t][a]&&e.buildStatStock[t][a][o]&&e.buildStatStock[t][a][o].available?e.buildStatStock[t][a][o].available:e.buildStatStock[t][a]&&!e.buildStatStock[t][a][o]&&e.buildStatStock[t][a].available?e.buildStatStock[t][a].available:void 0},a(y.child("bkginfo")).$loaded(function(t){e.bookingInfo=t}),e.distance=function(t){if(e.location&&e.location.loc)return GeoFire.distance(t,e.location.loc)},e.indexShift=function(t){var a=e.showIndex+t;console.log(t,e.showIndex,a,e.pGal[a],a>e.pGal.length-1,a<0),a>e.pGal.length-1?e.showIndex=0:a<0?e.showIndex=e.pGal.length-1:e.showIndex=a},e.showIndex=0,e.stockDistance={},e.nearest={distance:100},e.numbArray=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],e.acceptTerms=function(){e.termsAccepted=!0},e.colGen=function(e,t){return e||t?2:1},e.gridId="",e.gridSelector=function(t){e.gridId=t.$id},e.gridWatcher=function(t){return t==e.gridId?(console.log(t,2),2):(console.log(t,1),1)},e.gridMobile=function(t){return!u("xs")&&!u("sm")||t==e.gridId},e.partnerMedia&&(e.topImg=e.partnerMedia.images),e.optShow=function(t){return!(!u("gt-sm")&&e.search.tag!=t)||("acts"==t&&!e.search.cat||void 0)},e.mediaSwitch=function(t){switch(t){case"images":e.noVrBool=!0;break;case"video":e.noVrBool=!0;break;case"sphere":e.noVrBool=!1}},e.packSel={},e.galleries={},e.prepareGalleries=function(){angular.forEach(e.displayArray,function(t){t.tktrpack&&o(y.child("media").child(t.$id).child("images")).$loaded(function(a){e.galleries[t.$id]=a})}),e.startPackRotate()},e.conflictRes=function(t){if(e.partner.details&&e.partner.details.conflicts){var a=!0;return angular.forEach(e.partner.details.conflicts,function(e,o){t==o&&(a=!1,console.log("yay resolved"))}),console.log("noproblems = "+a),a}return!0},e.packFilter={tktrpack:!0},e.vendorFilter={},"partybypaul"!=e.appPartner?e.vendorFilter.vendor=e.appPartner:e.vendorFilter.tktr=!0,e.valEnq="",e.sendEnq=function(){Associations.sendEnquiry(e.valEnq)},e.partnerFilter={partner:!0},e.loading=!1,e.switchFilter=function(t){"recs"==t?(e.search.tag="recs",e.search.cat="bar",e.gotoAnchor("selection"),console.log(e.search)):(e.search={},e.search.tag="parties",e.gotoAnchor("selection"),console.log(e.search))},e.menuView=!1,e.mViewFn=function(t){e.menuView=t},e.actView=!1,e.aViewFn=function(t){e.actView=t},e.switchTag=function(t){e.search={},e.search.tag=t,e.displayMenu=!0,angular.forEach(e.displayArray,function(a){a.tag==t&&(e.centerProd=a)})},e.switchCat=function(t){e.search={tag:"recs"},e.search.cat=t,e.displayMenu=!0,angular.forEach(e.displayArray,function(a){a.tag==t&&(e.centerProd=a)})},e.vrGal=[],e.dispArrObj=o(y.child("info")),e.dispArrObj.$loaded(function(t){e.displayArray=t,e.centerProd=t[18]}),e.pGal=[],a(y.child("media/"+e.appPartner)).$loaded(function(t){e.partnerMedia=t,e.pGal.push({url:t.wide_branding,i:0});var a=1;angular.forEach(t.images,function(t,o){var n=t;n.id=o,n.ind=a,e.pGal.push(n),a++}),t.vr&&(e.noVrBool=!1,angular.forEach(t.vr,function(t,o){var n=t;n.id=o,n.ind=a,e.vrGal.push(n),a++}),e.loadVR(e.vrGal[0]))}),e.vrIndex=0,e.shiftVr=function(t){var a=e.vrGal.length-1;if(console.log(e.vrGal[0].url,t),"x"===t){var o=Math.random()*(a-0)+0;console.log(e.vrGal[o].url,o),e.loadVR(e.vrGal[o]),e.vrIndex=o}else{var n=e.vrIndex+t;n>e.vrGal.length-1?(e.vrIndex=0,e.loadVR(e.vrGal[e.vrIndex])):n<0?(e.vrIndex=e.vrGal.length-1,e.loadVR(e.vrGal[e.vrIndex])):(e.vrIndex=n,e.loadVR(e.vrGal[e.vrIndex]))}},e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"home",loadingImg:e.partnerMedia.partner_logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.imgInds={pack1:0,pack2:0,pack3:0,pack4:0},e.imgIndex=0,e.noVrBool=!0;e.centerVR="",e.moreInfo=!1,e.showMore=function(){this.showMore=!this.showMore},e.recFilter={tag:"recs",cat:"sights"},e.recfilters=[{icon:"assets/site/cat_clubs_btn.svg",text:"club"},{icon:"assets/site/cat_bars_btn.svg",text:"bar"},{icon:"assets/site/cat_restaurants_btn.svg",text:"restaurant"},{icon:"assets/site/cat_shops_btn.svg",text:"shop"},{icon:"assets/site/cat_sights_btn.svg",text:"sights"}],e.filters=[{icon:"assets/site/cat_vipclubbing_btn.svg",text:"parties"},{icon:"assets/site/cat_watersports_btn.svg",text:"watersports"},{icon:"https://firebasestorage.googleapis.com/v0/b/tktr-fa4cf.appspot.com/o/media%2Ftktr%2FTKTR.es_150x150.png?alt=media&token=01a4c9c2-6746-4bb3-973c-27f7fc544f86",text:"tktr"},{icon:"assets/site/cat_guidedtours_btn.svg",text:"tours"},{icon:"assets/site/cat_rentanything_btn.svg",text:"rentals"},{icon:"assets/site/cat_activities_btn.svg",text:"activities"}],e.pillFn=function(t,a){if(e.partner.classes)return e.search[a]==t?e.partner.classes.color:e.partner.classes.accent},e.display={parties:!0,outdoor:!1,watersports:!1,tours:!1,rentals:!1},e.searchFilter=function(t,a){if("tktr"==a)e.search={tktr:!0};else switch(t){case"tag":e.search={tag:a};break;case"cat":e.recFilter={tag:"recs",cat:a}}},e.checkTag=function(t){return e.display[t]},e.recs=[],o(y.child("recommendations")).$loaded(function(t){e.recs=t}),e.trustSrc=function(e){return c.trustAsResourceUrl(e)}}]).controller("LodgeRoomCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","User","$translate",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y){var w=firebase.database().ref(),k=firebase.database().ref("geofire/products");new GeoFire(k);e.auth=t.auth.$getAuth(),e.infoName="";var $=o(w.child("lodges").orderByChild("park").equalTo(e.appPartner)),S=o(w.child("accomm").orderByChild("park").equalTo(e.appPartner));S.$loaded(function(t){e.rooms=t,e.info=S.$getRecord(r.id),e.info.vr_bg&&e.loadVrBg(e.info.vr_bg),y(e.info.name).then(function(t){e.infoName=t})}),$.$loaded(function(t){e.lodges=t,e.lodge=$.$getRecord(r.lodge)}),e.infoView=!1,e.viewNow=function(t){e.infoView=t},e.closeView=function(){e.infoView=!1}}]).controller("LodgeInfoCtrl",["$scope","Auth","$firebaseObject","$firebaseArray","Ticketing","$timeout","$stateParams","Cart","$sce","DateParser","$interval","$mdMedia","$rootScope","$mdpDatePicker","$geolocation","$state","Stock","$mdDialog","User","$translate",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y){var w=firebase.database().ref(),k=firebase.database().ref("geofire/products");new GeoFire(k);e.auth=t.auth.$getAuth(),e.infoName="";var $=o(w.child("lodges").orderByChild("park").equalTo(e.appPartner)),S=o(w.child("accomm").orderByChild("lodge").equalTo(r.id));S.$loaded(function(t){e.rooms=t}),e.hudView=!1,e.ivView="info",e.iHudUp=function(t){e.ivView=t},$.$loaded(function(t){e.lodges=t,e.info=$.$getRecord(r.id),e.info.vr_bg&&e.loadVrBg(e.info.vr_bg),y(e.info.description).then(function(t){e.desc=t.split("     ")}),y(e.info.name).then(function(t){e.infoName=t})}),e.infoView=!1,e.viewNow=function(t){e.infoView=t},e.closeView=function(){e.infoView=!1}}]).controller("ParkSideCtrl",["$scope","$state","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$rootScope","$http","$state","$mdToast","User","$mdSidenav",function(e,t,a,o,n,i,r,l,c,d,s,t,u,m,f){function p(t){console.log("loading"),a(h.child("profiles/"+e.uid)).$bindTo(e,"profile"),g=a(h.child("carts/"+e.uid)),g.$bindTo(e,"cart").then(function(){e.cart.items,g.$watch(function(){var t=0,a=0;e.cart.items&&angular.forEach(e.cart.items,function(e,o){t+=e.price*e.quantity,a+=e.tax*e.quantity}),e.cart.total=t,e.cart.tax=a})})}var h=firebase.database().ref();e.addTable=!1,e.tableaddons,e.auth=l.auth.$getAuth(),d.uid&&"undefined"!=d.uid?e.uid=d.uid:e.auth?(console.log(e.auth),d.uid=e.auth.uid,e.uid=e.auth.uid):t.go("app.landing"),console.log(e.auth),e.closeThis=function(){e.showPayPal=!1},e.signOut=function(){e.closeSNav("right",l.auth.$signOut())},e.tixHref=function(){e.closeSNav("right",t.go("app.tickets",{uid:e.uid}))},e.deltaQ=function(t,a){console.log(e.cart.items[t].quantity+a==0),e.cart.items[t].quantity+a==0?c.removeItem(t):e.cart.items[t].quantity+=a},e.showPayPal=!1;var g;e.uid?p():(e.auth=l.auth.$getAuth(),e.auth?p(e.uid):t.go("app.landing"),e.cart={total:0,items:[]}),e.mergeObj={},e.mergeNow=function(){m.mergeNow(e.mergeObj.email).then(function(t){console.log(t),e.payNow(),e.authNow=!1})},e.authNow=!1,e.payNow=function(){console.log(e.auth.isAnonymous),e.showPayPal=!0,paypal.checkout.setup("KWPCEZL8SC7XS",{environment:"live",container:"paypalbtn",click:function(){paypal.checkout.initXO();var t={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.appPartner+"/pay",data:{uid:e.uid}};s(t).then(function(t){e.tempToken=t.data.token,console.log(t),paypal.checkout.startFlow(t.data.token)},function(e){console.log(e),paypal.checkout.closeFlow()})}})},e.payLink=function(){var t={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.appPartner+"/pay_link",data:{uid:e.uid}};s(t).then(function(t){e.tempToken=t.data.token,f("right").close().then(function(){u.show(u.simple().textContent("Check your mail!").position("top").hideDelay(2e3))})},function(e){console.log(e)})},e.payForce=function(){paypal.checkout.startFlow(e.tempToken)},e.removeItem=function(e){c.removeItem(e)},e.hideCart="true",e.emptyCart=function(){c.empty()}}]).controller("LodgeArrivalCtrl",["$scope","$state","Auth","$rootScope","$interval","$timeout","$stateParams","$mdMedia",function(e,t,a,o,n,i,r,l){var c=(firebase.database().ref("geofire"),firebase.database().ref());e.loadlandingVR=function(e){new PhotoSphereViewer({panorama:e.url,container:"landing",time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},c.child("info/"+e.appPartner+"/landingImg").once("value",function(t){e.landingVR=e.trust(t.val()),e.loadlandingVR({url:t.val()})}),e.auth={},e.auth.uid=a.uid(),console.log(e.auth),e.auth.uid?c.child("profile").child(e.auth.uid).once("value",function(a){"portal"!=e.appPartner?t.go("lodge.home"):"portal"==e.appPartner&&a.staff?t.go("app.admin.dash",{vendor:a.staff}):a||(c.child("profiles").child(e.auth.uid).set({name:"Guest",uid:e.auth.uid,voucher:e.appPartner}),t.go("lodge.home"))}):"portal"!=e.appPartner&&a.auth.$signInAnonymously().then(function(a){e.auth=a,e.authBool=!0,o.uid=a.uid,c.child("profiles").child(a.uid).set({name:"Guest",uid:a.uid,voucher:e.appPartner}),t.go("lodge.landing")})["catch"](function(e){console.error("Authentication failed:",e)}),e.logShow=function(t){return e.logBool==t},e.anonCont=function(){a.auth.$signInAnonymously().then(function(a){e.auth=a,e.authBool=!0,o.uid=a.uid,c.child("profiles").child(a.uid).set({name:"Guest",uid:a.uid,voucher:e.appPartner}),t.go("lodge.home")})["catch"](function(e){console.error("Authentication failed:",e)})},e.tabletWelcome=function(){return l("gt-sm")?40:l("portrait")?100:void 0}}]).controller("LodgeActCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b){e.vendorFilter={},e.ymlFilter={};var y=firebase.database().ref();e.paramKey,e.init=function(t){e.paramKey=t},e.infoView=!1,e.viewNow=function(t){e.infoView=t},e.closeView=function(){e.infoView=!1},r.id&&(e.paramKey=r.id),e.info={};var w=firebase.database().ref("geofire/locs");new GeoFire(w);!e.user&&e.uid&&o(y.child("profiles").child(e.uid)).$loaded(function(a){e.user=a,e.user.location||(e.user.location={}),t.getCurrentPosition({timeout:6e4}).then(function(t){e.user.location.lat=t.coords.latitude,e.user.location.lng=t.coords.longitude,e.user.location.location=[t.coords.latitude,t.coords.longitude],e.userLoc=[t.coords.latitude,t.coords.longitude]})}),e.productFadeImg={},e.paramKey&&o(y.child("info/"+e.paramKey)).$loaded(function(t){e.info=t,t.vr_bg?(e.vrModeEngage=!0,e.loadVrBg(t.vr_bg)):(e.vrModeEngage=!1,e.bgFade="background-image: url('"+t.wide_branding+"'); background-size: cover; background-repeat: no-repeat; background-position: center;");var a,o;"recs"==t.tag&&t.cat?(o="cat",a=t.cat,e.ymlFilter={tag:"recs",cat:a}):(o="tag",a=t.tag,e.ymlFilter={tag:a}),e.productFadeImg="background: url('"+e.info.wide_branding+"'); background-size: 100% 100%; background-repeat: no-repeat; opacity: 0.5; background-size: cover; background-position: left;";var i=n(y.child("info"));i.$loaded(function(t){e.displayArray=t}),e.ymlFilter.tag=e.info.tag,"recs"==e.info.tag&&(e.ymlFilter={tag:"recs",cat:e.info.cat}),e.vendorFilter.vendor=e.info.vendor,e.search={},e.info&&"recs"==e.info.tag?(e.search.cat=e.info.cat,e.search.tag="recs",f(function(){e.loaded()},200)):e.info&&e.paramKey&&(console.log("using"+e.paramKey),n(y.child("packages/"+e.paramKey)).$loaded(function(t){e.packages=t,console.log(t)})),e.search={tag:e.info.tag},f(function(){e.loaded()},200)}),e.selTime=function(t){if(e.buildStatStock&&e.build.date){var a=moment(e.build.date).format("YYYY-MM-DD");e.buildStatStock[a][t].available>0?e.build.time=t:$mdToast.show($mdToast.simple().textContent("Unavailable!"))}else $mdToast.show($mdToast.simple().textContent("Unavailable!"));e.build.time=t},e.filterTimes=function(t){var a=[];angular.forEach(e.times,function(e){moment(e.mnt).isSame(moment(t),"day")&&a.push(e)}),e.times=a},e.buildTimes=function(){if(e.build.date&&e.buildStatStock){var t=moment(e.build.date).format("YYYY-MM-DD");return e.buildStatStock[t]}return{}},e.prettyDate=function(){if(e.build.date){moment(e.build.date).clone().format("YYYY-MM-DD");if(e.build.time.length>6)return moment(e.build.date).clone().format("lll");var t=e.build.time.split("-");return moment(e.build.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.gallery=[],e.distance=function(){if(e.info&&e.info.location&&e.userLoc)return GeoFire.distance([e.info.location.lat,e.info.location.lng],e.userLoc)},e.vrGrow=function(t){return t==e.vrId?4:1},e.vrId="",e.explNow=function(){e.explView=!e.explView},e.growVR=function(t){e.vrId=t},e.vrGal=[],e.explView=!0,e.vrURL=function(e){return console.log("./vrview/index.html?image="+e),"./vrview/index.html?image="+e},o(y.child("profiles/"+p.uid)).$loaded(function(t){e.user=t}),e.gvrs=[],e.enqDate=function(t){if(e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)return moment(e.enquireObj.date).clone().format("lll");var a=e.enquireObj.time.split("-");return moment(e.enquireObj.date).clone().hours(parseInt(a[0])).minutes(parseInt(a[1])).format("lll")}},e.enquireObj={},e.enquireBuild=function(t){e.times=[],e.enquireObj={};var a=e.info;angular.forEach(a,function(t,a){e.enquireObj[a]=t}),e.user&&("Guest"!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=t,e.enquireObj.parent=t;var n=moment().format("YYYY-MM-DD");o(y.child("static_stock/"+t).orderByKey().startAt(n).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0,e.times=[];var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&(console.log(n),e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a}))}})})})},e.enqNow=function(t){if(e.enquireObj.sending=!0,e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)e.enquireObj.date=e.enquireObj.date.clone().format("lll");else{var o=e.enquireObj.time.split("-");e.enquireObj.date=moment(e.enquireObj.date).clone().hours(parseInt(o[0])).minutes(parseInt(o[1])).format("lll")}}n(y.child("enqs")).$add(e.enquireObj).then(function(o){console.log(o);var n={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.enquireObj.vendor+"/enquire",data:{uid:e.appAuth.uid,enquiry:e.enquireObj},dataType:"json",headers:{"Content-Type":"application/json"}};a(n).then(function(t){e.enquireObj.sent=!0,e.enquireObj={},f(function(){e.enquireObj.sending=!1},5e3)},function(e){}),y.child("profiles").child(e.appAuth.uid).child("name").set(e.enquireObj[t].username),y.child("profiles").child(e.appAuth.uid).child("email").set(e.enquireObj[t].email)})},e.vendorNumber=function(e){y.child("info").child(e).child("phone").on("value",function(e){return e.val()})},e.avalnow=function(){var t=moment(e.build.date).format("YYYY-MM-DD"),a=moment(e.build.time).format("HH-mm");return e.buildStatStock[t]&&e.buildStatStock[t][a]&&e.buildStatStock[t][a].available?e.buildStatStock[t][a].available:e.buildStatStock[t]&&!e.buildStatStock[t][a]&&e.buildStatStock[t].available?e.buildStatStock[t].available:void 0},e.myState=function(e){return paramKey==e},e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!0,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.loadImg=function(t){e.centerImg=t},o(y.child("ticketing/"+e.paramKey)).$loaded(function(t){e.ticketing=t}),e.expand=!1,e.checkStatic=function(){b.checkStatic(e.build).then(function(t){console.log(t),t?e.build.greenlit=1:e.build.greenlit=2})},e.numbArray=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],e.build={},e.buildPack=function(t){e.buildPack=e.packageData[t][t],e.buildPack.quantity=e.build.quantity},e.surgeBool=function(){var t=!1;if(e.build&&e.build.date&&e.build.weekend_charge){var a=moment(e.build.date).day();angular.forEach(e.build.weekend_charge.days,function(e,o){e==a&&(t=!0)})}return t},e.builder=function(t){console.log(t);var a;a=!t.name&&t.val?t.val:t,console.log(a),e.times=[],e.build={},angular.forEach(a,function(t,a){e.build[a]=t}),e.build.date=null,e.build.time=null,e.build.pid=a.$id,e.build.parent=r.id,e.build.weekend_charge&&(e.build.quantity=1),e.build.greenlit=0;var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(y.child("static_stock/"+r.id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(y.child("static_stock/"+r.id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,console.log(t),angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.clearBuild=function(){e.build=null},e.tempDate={},e.stops=["junta","rraval"],e.builderVaya=function(){e.times=[],e.build={};var t=e.packages[0],a=e.packages[0].$id;angular.forEach(t,function(t,a){e.build[a]=t}),e.build.date=e.tempDate.date,e.build.time=null,e.build.pid=a,e.build.parent=t.parent,e.build.greenlit=0,console.log(e.build);var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(y.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,console.log(t),angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date),"day")&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(y.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,console.log(t),angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date))&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.checkStock=function(){b.checkStock(e.build).then(function(t){t&&(e.build.stock=t,e.build.greenlit=!0,console.log(e.build.stock))})["catch"](function(t){e.build.time=null,e.build.quantity=null,alert(t)})},e.validDates={},e.today=moment().format("YYYY-MM-DD"),e.validate=function(t){var a=moment(t).format("YYYY-MM-DD");return!e.validDates[a]},e.times=[],e.checkDay=function(t){return moment(t).isSame(e.build.date,"day")},e.indexShift=function(t){var a=e.showIndex+t;a>e.gallery.length-1?e.showIndex=0:a<0?e.showIndex=e.gallery.length-1:e.showIndex=a},e.showIndex=0,e.prettyTime=function(e){var t=e.split("-"),a=t[0]+":"+t[1];return a},e.mediaFilter={},e.currentDate=moment(),e.showDatePicker=function(t){u(e.currentDate,{targetEvent:t}).then(function(t){e.build.date=moment(t).format("YYYY-MM-DD")})},e.showTimePicker=function(t){m(e.currentTime,{targetEvent:t}).then(function(a){var o=moment(a).format("HH-mm");e.ticketing[e.build.date][o]?e.build.time=o:e.showTimePicker(t),console.log(e.build)})},e.imgIndex=0,e.addToCart=function(){console.log(e.build),d.addItem(e.build),e.clearBuild()}}]),angular.module("tktr.services",["ja.qr"]).factory("Associations",["$http","$mdToast",function(e,t){return{sendEnquiry:function(a){var o={method:"POST",url:"https://www.pbpapi.com/users/val_enq",data:{email:a}};e(o).then(function(e){t.show(t.simple().textContent("We'll be in touch!"))})}}}]).factory("LocalInfo",["$http","$q","$sce",function(e,t,a){function o(e,a){function o(e,t){t==google.maps.places.PlacesServiceStatus.OK?e.photos&&(angular.forEach(e.photos,function(e){i.push({url:e.getUrl({maxWidth:600,maxHeight:400}),attr:e.html_attributions})}),n.resolve({info:e,photos:i})):n.reject(t)}var n=t.defer(),i=[],r={placeId:a};return service=new google.maps.places.PlacesService(e),service.getDetails(r,o),n.promise}function n(e,a){var o,n;switch(a){case"thumb":o=100,n=100;break;case"full":o=1280,n=900}var i=t.defer();return i.resolve(e.getUrl({maxWidth:o,maxHeight:n})),i.promise}function i(e,a){var o,n,i=t.defer();switch(a){case"thumb":o=100,n=100;break;case"full":o=1280,n=900;break;case"mid":o=800,n=600}if(e.photos&&e.photos[0]?photourl=e.photos[0].getUrl({maxWidth:o,maxHeight:n}):photourl=!1,!angular.isUndefined(photourl)){var r={info:e,photo:photourl};i.resolve(r)}return i.promise}function r(a,o){var i=t.defer(),r={method:"POST",url:"https://maps.googleapis.com/maps/api/place/nearbysearch/json?key=AIzaSyCaG3yAf9wZEB-fqLE3U0QmuzO4iNn5HUw&location=41.377069,2.172229&radius=500&type="+o,dataType:"jsonp"};return e(r).then(function(e){var t={data:e.data.results,photos:{}};angular.forEach(e.data.results,function(e){e.photos.length>0&&n(e.photos[0].reference,e.photos[0].width).then(function(a){t.photos[e.id]})}),i.resolve(e.data.results)},function(e){i.reject(e)}),i.promise}var l={health:{icon:"healing",array:["doctor","gym","hospital","dentist","pharmacy"]},shopping:{icon:"shopping_basket",array:["liquor_store","shoe_store","clothing_store","department_store","florist","tabac"]},dining:{icon:"local_dining",array:["cafe","restaurant","bakery","bar"]},attractions:{icon:"local_activity",array:["museum","art_gallery","bowling_alley","night_club","park","amusement_park","movie_theatre"]}};return{getTypes:l,getResults:function(e,t){return r(e,t)},getPhoto:function(e,t){return n(e,t)},addPhoto:function(e,t){return i(e,t)},placeInfo:function(e,t){return o(e,t)}}}]).factory("CalendarService",["$firebaseArray",function(e){function t(e){var t,a,o=moment().month(e),n=o.clone().date(1);t=0!=n.day()?n.day(0):n;var i=o.clone().add(1,"months");a=6!=i.day()?i.day(6):i;for(var r=[],l=0;l<=34;l++)r.push(moment(t).add(l,"days"));return r}return{getMonth:function(e){return t(e)}}}]).factory("subdomain",["$location",function(e){var t=e.host();return console.log(t),t.indexOf(".")<0?"tktrza":"test"==t.split(".")[0]||"pachapitch"==t.split(".")[0]||"tktrza-test"==t.split(".")[0]||"localhost"==t.split(".")[0]?"tktrza":t.split(".")[0]}]).factory("Promoters",["$http","$cacheFactory","$firebaseArray",function(e,t,a){var o=firebase.database().ref("promoters").orderByChild("voucher"),n=[],i=a(o);return i.$loaded(function(e){n=e}),{checkPromoCode:function(e){var t=angular.lowercase(e),a=!0;return angular.forEach(n,function(e){angular.lowercase(e.code)==t&&(a=!1)}),a},checkCode:function(e){var t=angular.lowercase(e),a=!1;return angular.forEach(n,function(e){angular.lowercase(e.code)==t&&(a=!0)}),a},codes:function(){var e=[],t=a(o);t.$loaded(function(t){return e=t})}}}]).factory("User",["$http","$q","Auth","$mdDialog","$firebaseObject","$rootScope","$state","$mdMedia","$mdDialog","$stateParams","$cacheFactory","subdomain",function(e,t,a,o,n,i,r,l,o,c,d,s){function u(e,o){t.defer();switch(e){case"google":var n=new firebase.auth.GoogleAuthProvider;n.addScope("https://www.googleapis.com/auth/plus.login"),n.addScope("https://www.googleapis.com/auth/userinfo.email");break;case"facebook":var n=new firebase.auth.FacebookAuthProvider;n.addScope("email"),n.addScope("user_friends");break;case"twitter":var n=new firebase.auth.TwitterAuthProvidernewDriver}switch(o){case"pop":a.auth.$signInWithPopup(n).then(function(e){if(e.user&&e.user.email){var t={uid:e.user.uid,email:e.user.email,voucher:i.partner,photo:"hold"};e.user.name&&(t.name=e.user.name),e.user.photoURL&&(t.photo=e.user.photoURL),x.child("profiles").child(e.user.uid).set(t).then(function(e){r.go("app.home.store")})}});break;case"redir":firebase.auth().signInWithRedirect(n)}}function m(e){a.auth.$updatePassword(e.password).then(function(){})["catch"](function(e){console.error("Error: ",e)})}function f(e){switch(e){case"google":var t=new firebase.auth.GoogleAuthProvider;t.addScope("https://www.googleapis.com/auth/plus.login"),t.addScope("https://www.googleapis.com/auth/userinfo.email");var a=t.credential(googleUser.getAuthResponse().id_token);break;case"facebook":var t=new firebase.auth.FacebookAuthProvider;t.addScope("email"),t.addScope("user_friends");var a=firebase.auth.FacebookAuthProvider.credential(response.authResponse.accessToken);break;case"twitter":var t=new firebase.auth.TwitterAuthProvidernewDriver}firebase.auth().currentUser.link(a).then(function(e){})}function p(e){var t=e.split("@"),o="tk"+t[0]+"tr";a.auth.$signInWithEmailAndPassword(e,o).then(function(e){i.uid=e.uid})}function h(){n(x.child("profiles").child(i.uid).child("email")).$loaded(function(e){var t=e.$value.split("@"),a="tk"+t[0]+"tr",o=firebase.auth.EmailAuthProvider.credential(e.$value,a);firebase.auth().currentUser.link(o).then(function(e){r.go("app.tickets",{id:e.uid})})})}function g(e){var a=t.defer(),o=e.email.split("@"),n="tk"+o[0]+"tr",i=firebase.auth.EmailAuthProvider.credential(e.email,n);return firebase.auth().currentUser.link(i).then(function(t){x.child("profiles").child(t.uid).child("email").set(e.email),e.name&&x.child("profiles").child(t.uid).child("name").set(e.name),a.resolve(t)}),a.promise}function v(e){var a=t.defer(),o=firebase.auth.EmailAuthProvider.credential(e.email,e.password);return firebase.auth().currentUser.link(o).then(function(t){x.child("profiles").child(t.uid).child("email").set(e.email),x.child("profiles").child(t.uid).child("name").set(e.name),a.resolve(t)}),a.promise}function b(e){var o=t.defer(),n=e.split("@"),r="tk"+n[0]+"tr";return a.auth.$signInWithEmailAndPassword(e,r).then(function(e){e?(i.uid=e.uid,o.resolve(e.uid)):o.reject(!1)}),o.promise}function y(t){var a=t.email.split("@"),o="tk"+a[0]+"tr",n=firebase.auth.EmailAuthProvider.credential(t.email,o);firebase.auth().currentUser.link(n).then(function(a){var o={method:"POST",url:"https://www.pbpapi.com/users/merge",data:{uid:a.uid,email:t.email}};e(o).then(function(e){})},function(e){})}function w(e,t){switch(e){case"google":var a=new firebase.auth.GoogleAuthProvider;a.addScope("https://www.googleapis.com/auth/plus.login"),a.addScope("https://www.googleapis.com/auth/userinfo.email");break;case"facebook":var a=new firebase.auth.FacebookAuthProvider;a.addScope("email"),a.addScope("user_friends");break;case"twitter":var a=new firebase.auth.TwitterAuthProvidernewDriver}switch(t){case"pop":firebase.auth().signInWithPopup(a).then(function(e){x.child("profiles").child(e.user.uid).child("staff").once("value",function(e){r.go("app.admin.dash",{vendor:e.val()})})});break;case"redir":firebase.auth().signInWithRedirect(a)}}function k(t){var a={method:"POST",url:"https://www.pbpapi.com/users/welcome",data:{uid:t}};e(a).then(function(e){})}function $(){var e,o=a.auth.$getAuth(),i=t.defer(),r=q.get("profile"),l=q.get("auth");return angular.isUndefined(r)||angular.isUndefined(l)?o?(q.put("auth",o),n(x.child("profiles").child(o.uid)).$loaded(function(t){q.put("profile",t),e={profile:t,auth:o},i.resolve(e)},function(e){i.reject(e)})):i.reject(null):o&&angular.isUndefined(r)&&angular.isUndefined(l)&&(r.uid==l.uid==o.uid?(e={profile:r,auth:o},i.resolve(e)):(q.destroy("profile"),q.put("auth",o),n(x.child("profiles").child(o.uid)).$loaded(function(t){q.put("profile",t),e={profile:t,auth:o},i.resolve(e)},function(e){i.reject(e)}))),i.promise}function S(){var e=a.auth.$getAuth();e?r.go("app.home_screen.dash"):a.auth.$signInAnonymously().then(function(e){D(e)})["catch"](function(e){console.error("Authentication failed:",e),r.reload()})}function P(){var e=t.defer(),o=a.auth.$getAuth();return o?$().then(function(t){e.resolve(t)}):a.auth.$signInAnonymously().then(function(t){e.resolve(D(t,null))})["catch"](function(e){console.error("Authentication failed:",e),r.reload()}),e.promise;
}function A(e){var t=a.auth.$getAuth(),o=t.uid,i=n(x.child("profiles").child(o));i.$loaded().then(function(t){i.email=e,i.$save(function(e){})})["catch"](function(e){console.error("Error: ",e)})}function _(e){var a=t.defer(),o=n(firebase.database().ref("profiles/"+e+"/voucher"));return o.$loaded(function(e){e.$value?a.resolve(!0):a.resolve(!1)}),a.promise}function O(e){var t=n(x.child("profiles").child(e.uid));t.$loaded().then(function(a){t.$value=e,t.$save()},function(e){})}function M(e,t){var a=n(x.child("profiles").child(e));a.$loaded().then(function(t){var o=n(x.child("profiles").child(e));o.$loaded().then(function(e){o.voucher=a.voucher,o.$save(function(e){},function(e){})},function(e){})},function(e){})}function D(e,t){var a={name:"Guest",uid:e.uid,voucher:s};return q.put("profile",a),q.put("auth",e),x.child("profiles").child(e.uid).set(a),t?void r.go(t):{profile:a,auth:e}}function I(e){var a=t.defer(),o=n(x.child("profiles").child(e.uid));return o.$loaded(function(){var t=!1;o.name||(o.name=e.displayName,t=!0),!o.email&&e.email&&(o.email=e.email,t=!0),o.emailVerified||(o.emailVerified=e.emailVerified,t=!0),o.photo||(o.photo=e.photoURL,t=!0),t?o.$save(function(e){a.resolve(o)},function(e){}):a.resolve(o)},function(e){console.error("Error:",e)}),a.promise}function j(){var e=t.defer(),o=a.auth.$getAuth();return o&&e.resolve(o.uid),e.promise}function C(e,t){var a=firebase.database().ref("profiles/"+e+"/voucher");a.set(t).then(function(e){})}function T(e){"left"==e?i.sideMenuBool=!1:"right"==e&&(i.cartBool=!1),a.auth.$signOut(),q.removeAll(),q.removeAll(),r.go("app.landing")}function Y(e){var a=t.defer(),o=q.get("profile");return o.email=e.email,o.name=e.name,q.put("profile",o),x.child("profiles").child(o.uid).child("email").set(e.email),x.child("profiles").child(o.uid).child("name").set(e.name),a.resolve(o),a.promise}var x=firebase.database().ref(),V=a.auth.$getAuth();if(V){var V;V.uid}var q=d("user"),E=(new firebase.auth.TwitterAuthProvider,"");return{upNameEmail:function(e){return Y(e)},uiLogin:function(){return uiLogin()},mergeComplete:function(e){return m(e)},mergeCompleteProvider:function(e){return f(e)},ssiLanding:function(e){return p(e)},initMerge:function(e){return y(e)},payMerge:function(e){return h(e)},signOutMenu:function(e){return T(e)},mergeNow:function(e){return g(e)},mergeFull:function(e){return v(e)},providerLogin:function(e,t){return u(e,t)},adminProviderLogin:function(e,t){return w(e,t)},getUser:function(){return $()},walletLink:function(e){return b(e)},anonUser:function(e){return D(e)},welcomeEmail:function(e){return k(e)},anonArrival:function(){return S()},anonAdsArrival:function(){return P()},attachCode:function(e,t){return M(e,t)},setVoucher:function(e,t){return setVoucher(e,t)},updateEmail:function(e){return A(e)},getUID:function(){return j()},checkV:function(e){return _(e)},save:function(e){return O(e)},setUserVoucher:function(e,t){return C(e,t)},getUserVoucher:function(){return E},check:function(e){return I(e)}}}]).factory("Cart",["$http","$interval","$firebaseObject","Auth","$firebaseArray","User","$rootScope","$geolocation","$mdToast","$q",function(e,t,a,o,n,i,r,l,c,d){function s(e){var e=e,t=0,o=n(g.child("carts/"+e+"/items"));o.$loaded(function(n){o.length?angular.forEach(o,function(a){a.ticket>1&&g.child("carts/"+e+"/tables").set(!0),t+=a.total}):t=0;var i=a(g.child("carts/"+e+"/total"));i.$loaded(function(e){i.$value=t,i.$save().then(function(e){})},function(e){})})}function u(e){var t=o.uid(),n=firebase.database().ref("carts/"+t+"/items/"+e),i=a(n);i.$remove(),s(t)}function m(){var e=d.defer(),t=v.uid,a=firebase.database().ref(),o=n(a.child("carts/"+t+"/items/"));return o.$loaded(function(t){e.resolve(t)}),e.promise}function f(e){var t=r.uid;if(t){var o,n=firebase.database().ref("vendor_locations"),i=firebase.database().ref("geofire"),l=(new GeoFire(n),new GeoFire(i));l.get(t).then(function(e){o=e?e:[41.387162,2.169966]});var c=firebase.database().ref("carts/"+t+"/items"),d=("carts/"+t+"/items/"+e.vendor,a(c.child(e.vendor)));d.$loaded(function(a){angular.forEach(e,function(e,t){d[t]=e}),d.price=e.total,d.quantity=1,d.tax=0,d.$save().then(function(e){s(t)},function(e){})})}}function p(e){var t=r.uid;if(t){var o,n=firebase.database().ref("vendor_locations"),i=firebase.database().ref("geofire"),l=(new GeoFire(n),new GeoFire(i));if(l.get(t).then(function(e){o=e?e:[41.387162,2.169966]}),e.weekend_charge){var c=moment(e.date).day(),d=!1;angular.forEach(e.weekend_charge.days,function(e,t){e==c&&(d=!0)})}d&&(e.price+=e.weekend_charge.amt,e.pid=e.pid+"_xtra",e.tax+=.15*e.price*.21);var u=firebase.database().ref("carts/"+t+"/items"),m=("carts/"+t+"/items/"+e.pid,a(u.child(e.pid)));m.$loaded(function(a){if(a.quantity)e.duration&&!e.quantity&&(e.quantity=e.duration),m.quantity+=e.quantity,m.total=m.price*m.quantity,m.$save().then(function(e){s(t)},function(e){});else{if(e.duration&&!e.quantity&&(e.quantity=e.duration),angular.forEach(e,function(e,t){e&&(m[t]=e)}),o||(o=[41.387162,2.169966]),e.date&&e.time){moment(e.date).clone().format("YYYY-MM-DD");if(e.time.length>6)m.time=moment(e.date).clone().format("lll");else{var n=e.time.split("-");m.time=moment(e.date).clone().hours(parseInt(n[0])).minutes(parseInt(n[1])).format("lll")}}m.user_coords=o,m.total=e.price*e.quantity||e.duration,m.$save().then(function(e){s(t)},function(e){})}r.cartBool=!0})}}var h,g=firebase.database().ref(),v=o.authObj(),b=r.uid;if(b){var y=g.child("carts/"+b+"/items");y.on("child_added",function(e,t){s(b)}),y.on("value",function(e,t){s(b)})}return{addItem:function(e){return p(e)},addDelivery:function(e){return f(e)},newTicket:function(e,t){return newTicket(e,t)},removeItem:function(e){return u(e)},empty:function(){var e=r.uid;g.child("carts/"+e).child("total").set(0),g.child("carts/"+e).child("items").set(null)},getItems:function(){return m()},getCart:function(){return h},updateTotal:function(){return s()}}}]).factory("Coop",["User","$firebaseArray","$firebaseObject","$state","$http","$q",function(e,t,a,o,n,i){function r(t){for(var a=[],o=t.length-1;o>=0;o--)a.push(e.getUser(t[o].key));return a}function l(){var e="live/events",a=firebase.database().ref(e),o=t(a);o.$loaded(function(e){return e},function(e){})}function c(t,a){var o=e.getUID(),i={method:"POST",url:"https://www.pbpapi.com/coop/invite",data:{email:t,cid:a,uid:o}};n(i).then(function(e){})}function d(e){var t=i.defer(),o=firebase.database().ref("live/events"),n=a(o.child(e));return n.$loaded().then(function(e){t.resolve(e)}),t.promise}function s(e){var t=firebase.database().ref("live/events/"+e),o=firebase.database().ref("grouppay/"+e),n=a(t),i=moment().add(1,"days").format();n.$loaded(function(e){var a=e.total/e.split,r=1.21*a,l=(1.21*e.total,e.members);angular.forEach(l,function(e,t){o.child("payees").child(t).set({subtotal:a,total:r,preauthed:!1,collected:!1})});o.child("expiry").set(i),o.child("completed").set(!1),o.child("product").set(n.product),t.child("executeOn").set(!0)})}function u(n){var i=e.getUID(),r={data:n,primary:i,quantity:n.quantity,max:10,total:n.price,split:1,product:n.$id,name:n.name,description:n.description,execute_time:n.date,executeOn:!1},l=firebase.database().ref(),c=t(l.child("live/events"));c.$add(r).then(function(e){var t=a(l.child("live/events/"+e.key+"/members").child(i));t.$loaded(function(e){t.$value=!0,t.$save().then(function(e){},function(e){})});var n=a(l.child("profiles/"+i+"/coops").child(e.key));n.$value=!0,n.$save().then(function(e){o.go("app.coop.room",{id:e.key})},function(e){})})}return{friends:function(e){return r(e)},"new":function(e){return u(e)},getUserCoops:function(e){var t=[],o=firebase.database().ref("profiles"),n=a(o.child(e));n.$loaded().then(function(e){return angular.forEach(n.coops,function(e,a){t.push(d(a))}),t})},invite:function(e,t){return c(e,t)},getCoops:function(){return l()},initiatePay:function(e){return s(e)},getProduct:function(e){var t=e.slice(0,-1),o=firebase.database().ref("products"),n=a(o.child(t));n.$loaded(function(e){return e})}}}]).factory("Auth",["$firebaseAuth","$rootScope",function(e,t){var a=firebase.database().ref(),o=t.uid,n={};return o||(n=e().$getAuth(),n&&(n.email&&a.child("profiles").child(n.uid).child("email").set(n.email),o=n.uid,t.uid=o)),{auth:e(),authObj:function(){return n},uid:function(){return o?o:(n=e().$getAuth())?n.uid:void 0}}}]).factory("DateParser",function(){return{decode:function(e){var t=[],a=moment().day();if(0!==e){var o=e[0].$value.split("D");if("*"===o[0]){for(var n=0;n<=7;n++)for(var i=0;i<=e.length-1;i++){var r=a+n,l=e[i].$value.split("D"),c=l[1].split("H"),d=moment().day(r).hour(parseInt(c[0])).minute(parseInt(c[1])).format("YYYY, MMM, D, h:mm A");t.push(d)}return t}for(var s=parseInt(o[0]),i=0;i<=e.length-1;i++){var u=e[i].$value.split("D"),s=parseInt(u[0]);if(a<=s){var m=u[1].split("H"),d=moment().day(s).hours(parseInt(m[0])).minutes(parseInt(m[1])).format("YYYY, MMM, D, h:mm A");t.push(d),console.log(d)}else{var m=u[1].split("H"),d=moment().day(s+7).hours(parseInt(m[0])).minutes(parseInt(m[1])).format("YYYY, MMM, D, h:mm A");t.push(d),console.log(d)}}return t}if(0==e)return[moment().format("MMM, D")]}}}).factory("Live",["$firebaseArray","$firebaseObject","Auth",function(e,t,a){function o(){}function n(){var t=e(i);t.$loaded(function(e){return console.log(e),e})}var i=firebase.database().ref("live");return{getAll:function(){return n()},add:function(){return o()}}}]).factory("Clubs",["$firebaseArray","$firebaseObject","Auth","$q",function(e,t,a,o){function n(t){var a=(o.defer(),firebase.database().ref("events")),n=e(a.child("defaults"));e(a.child("guests").orderByChild("date")),moment().day();guestArr.$loaded(function(e){var e=e;n.$loaded(function(t){var a=t;angular.forEach(e,function(e){angular.forEach(a,function(e){e.date})})})})}function i(e){var a,e=e,o=firebase.database().ref("clubs"),n=o.child("events/schedule/"+e);o.child("ticketing/"+e),t(o.child("defaults")).$loaded(function(i){a=i;t(n).$loaded(function(n){var i={event:e,available:a.capacity,list:[],price:n.price,tables:{}};t(o.child("tables")).$loaded(function(t){angular.forEach(t,function(e,t){i.tables[t]=e,i.tables[t].available=!0}),o.child("ticketing/"+e).set(i).then(function(e){})})})})}function r(){for(var e=[],a=0;a<20;a++){var o=moment().add(a,"days").format("YYYY-MM-DD");e.push(o)}var n=firebase.database().ref(),r=n.child("events/schedule");angular.forEach(e,function(e){var a=t(r.child(e));a.$loaded(function(o){if(!o.$value){var r=moment(e).day(),l=t(n.child("events/defaults/"+r));l.$loaded(function(t){t&&(angular.forEach(t,function(e,t){a[t]=e}),a.$save(),i(e))})}})})}function l(a){var o,n=firebase.database().ref("clubs"),a=a;n.child("defaults").once("value",function(i){o=i;var r;if(a["default"]?e(n.child("events/defaults")).$add(a).then(function(e){r=e.key}):e(n.child("events/guests")).$add(a).then(function(e){r=e.key}),r){var l={event:r,available:o.capacity,list:[],price:a.price,tables:{}};e(n.child("tables")).$loaded(function(e){angular.forEach(e,function(e){l.tables[e.$id]=e,l.tables[e.$id].available=!0})}),t(n.child("ticketing/"+r)).$save(l).then(function(e){})}})}return{events:function(e){return n(e)},newEvent:function(e,t){return l(e,t)},calendar:function(){return r()}}}]).factory("Stock",["$firebaseArray","$firebaseObject","$q","$filter",function(e,t,a,o){var n=firebase.database().ref();return{checkRooms:function(e){for(var o=a.defer(),i=[],r="bookings/"+moment(e.start_date).format("YYYY-MM-DD"),e=e,l=[],c=moment(e.start_date).clone().startOf("day"),d=moment(e.end_date).clone().startOf("day");c.add("days",1).diff(d)<0;)l.push(c.clone().toDate());return t(n.child("beds").orderByChild(r).equalTo(null)).$loaded(function(e){angular.forEach(e,function(e,t){var a=!1;if(e.id=t,angular.forEach(l,function(t){var o=moment(t).clone().format("YYYY-MM-DD");e.bookings&&e.bookings[o]&&(a=!0)}),!a){var o=e;o.id=t,i.push(o)}}),o.resolve(i)},function(e){o.reject(e)}),o.promise},checkStatic:function(e){console.log(e);var o,i=a.defer(),r=e.time.split("-"),l=moment(e.date).clone().add(r[0],"hours").add(r[1],"minutes");if(o="00-00"==e.time?moment(e.date).clone().format("YYYY-MM-DD"):moment(e.date).clone().format("YYYY-MM-DD")+"/"+e.time,moment(l).isAfter())if(e.duration){for(var c=!0,d=e.duration-1;d>=0;d--){var s=moment(e.date).clone().add(d,"hours").format("YYYY-MM-DD")+"/"+e.time;t(n.child("static_stock").child(e.parent).child(s)).$loaded(function(t){c=!!(t.available&&t.available>e.quantity)||!!(!t.available&&t.capacity&&t.capacity>=e.quantity)})}c?i.resolve(!0):i.resolve(!1)}else t(n.child("static_stock").child(e.parent).child(o)).$loaded(function(t){t.available&&t.available>=e.quantity?i.resolve(!0):!t.available&&t.capacity&&t.capacity>=e.quantity?i.resolve(!0):i.resolve(!1)});else i.resolve(!1);return i.promise},checkStock:function(t){for(var o,i=a.defer(),r={},l=2*t.duration-1,c="bookings/"+moment(t.time).clone().subtract(1,"hours").format("YYYY-MM-DD/HH-mm"),d={},s=(moment(t.time),0),s=0;s<l;s++){var u=moment(t.time).add(30*s,"m"),m="bookings/"+moment(u).clone().subtract(1,"hours").format("YYYY-MM-DD-HH-mm");d[m]=!0,s==l-1&&(o=m)}return e(n.child("stock").child(t.parent).orderByChild(c).equalTo(null)).$loaded(function(e){for(var a=e,l=t.quantity-1,s=0;s<a.length;s++)if(l>=0){var u=!0;angular.forEach(d,function(e,t){a[s][t]&&(u=!1)}),u&&!r[l]?(r[l]=a[s].$id,a[s][c]="pending",a[s][o]="pending",l--):u||s!=a.length-1||("No Stock Available!"==r[l],l--,deffered.reject("No Stock Available!"))}else n.child("stock").child(c).set("pending"),n.child("stock").child(o).set("pending"),i.resolve(r)}),i.promise}}}]).factory("Tracking",["$firebaseArray",function(e){function t(t){var a=t,o=firebase.database().ref("promoters");e(o).$loaded(function(e){angular.forEach(e,function(e){e.code==a&&ref.child(e.$id).transaction(function(e){e?e.userCount+=1:e.userCount=0})})})}return{newSignin:function(e){t(e)}}}]).factory("MapTools",["$http","$firebaseArray","$firebaseObject","$firebaseAuth","$state","$rootScope",function(e,t,a,o,n,i){function r(e,t){var a=e,o=t,n={origin:a,destination:o,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC};directionsService.route(n,function(e,t){t==google.maps.DirectionsStatus.OK&&(directionsDisplay.setDirections(e),distance=e.routes[0].legs[0].distance.value,time_taken=e.routes[0].legs[0].duration.value,auto_fare=4*distance.value,vayaObj.fare=auto_fare,vayaObj.distance=distance,vayaObj.duration=duration)})}return{route:function(e,t){return r(e,t)}}}]).factory("LangTools",["$http","$firebaseArray","$firebaseObject","$firebaseAuth","$state","$rootScope","$q",function(e,t,a,o,n,i,r){function l(t){a(d.child("translations").child("en")).$loaded(function(o){a(d.child("translations").child(t)).$loaded(function(a){var n={};angular.forEach(o,function(e,t){a[t]||(n[t]={text:e})}),d.child("dump").child(t).set(n);var i={method:"POST",url:"https://pbpapi.com/admins/translate/"+t};e(i).then(function(e){},function(e){})})})}function c(t){a(d.child("translations").child("en").limitToFirst(600)).$loaded(function(t){var a={};angular.forEach(t,function(e,t){a[t]={text:e}});var o={method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},url:"https://99076d71ead6bb11:6f927b381ff50bdb@api.tolq.com/v1/translations/requests/quote",data:{request:a,source_language_code:"en",target_language_code:"tq",quality:"premium",style_guide_reference_id:1,options:{context_url:"tktr.es",name:"Initial translation",description:"One language quote of entire site",auto_client_review:!1}}};e(o).then(function(e){},function(e){})})}var d=firebase.database().ref();return{quoteNewLang:function(e){return c(e)},updateLang:function(e){return l(e)}}}]).factory("SkyScan",["$http","$q",function(e,t){function a(){var a=t.defer();if(0!=s.length&&s.length)a.resolve(s);else{var o={method:"GET",url:"https://f756e018.ngrok.io/travel/get_locales"};e(o).then(function(e){console.log(e),s=e.data.Locales,f||(f=s[8].Code),a.resolve(s)},function(e){})}return a.promise}function o(a){var o=t.defer();if(0!=d.length&&d.length)o.resolve(d);else{var n={method:"GET",url:"https://f756e018.ngrok.io/travel/get_markets/"+a};e(n).then(function(e){console.log(e),d=e.data.Countries,p||(p=d[0]),o.resolve(d)},function(e){})}return o.promise}function n(){var a=t.defer();if(0!=u.length&&u.length)a.resolve(u);else{var o={method:"GET",url:"https://f756e018.ngrok.io/travel/get_currencies"};e(o).then(function(e){console.log(e),u=e.data.Currencies,a.resolve(u)},function(e){})}return a.promise}function i(e){m=e}function r(e){p=e}function l(e){f=e,o(e)}function c(){var a=t.defer(),o={method:"GET",url:"https://f756e018.ngrok.io/travel/get_bcn_hotels/"+p.Code+"/"+m.Code+"/"+f};return e(o).then(function(e){console.log(e),a.resolve(e.data)},function(e){console.log(e),a.reject(e)}),a.promise}var d=[],s=[],u=[],m="EUR",f="en-GB",p="GB";return s||a(),d||o(f),u||n(),{getLocales:function(){return a()},getMarkets:function(){return o()},getCurrencies:function(){return n()},setLocale:function(){return l()},setMarket:function(){return r()},setCurr:function(){return i()},getLocale:function(){return f},getMarket:function(){return p},getCurr:function(){return m},getHotelAuto:function(e){return c(e)}}}]).factory("Vaya",["$http","$firebaseArray","$firebaseObject","$firebaseAuth","$state","$rootScope",function(e,t,a,o,n,i){function r(e){}return{search:function(e){return r(e)}}}]).factory("AdminTools",["$http","$firebaseArray","$firebaseObject","$firebaseAuth","$state","$rootScope","$stateParams","$q",function(e,t,a,o,n,i,r,l){function c(e){o().$createUserWithEmailAndPassword(e.newAdmin.email,e.newAdmin.password).then(function(t){e.newDriver.driver=!0,e.newDriver.voucher=e.newDriver.staff,y.child("drivers").child(t.uid).set(e.newDriver),y.child("profiles").child(t.uid).set(e.newDriver),n.go("app.admin_fleet_pickup")})["catch"](function(e){console.error("Error: ",e)})}function d(e){o().$signInWithPopup(e).then(function(e){var t={driver:!0,staff:r.vendor,voucher:r.vendor};i.uid=e.user.uid,e.user.name&&(t.name=e.user.displayName),e.user.email&&(t.email=e.user.email),e.user.emailVerified&&(t.emailVerified=e.user.emailVerified),e.user.photoURL&&(t.photo=e.user.photoURL),y.child("drivers").child(e.user.uid).set(t),y.child("profiles").child(e.user.uid).set(t),n.go("app.admin_fleet_pickup")})["catch"](function(e){console.error("Error: ",e)})}function s(e){var a=t(y.child("vendor_applications"));a.$add(e).then(function(){alert("Application Recieved!")})}function u(e){var a=new GeoFire(y.child("geofire/vehicles"));t(y.child("stock")).$add(e).then(function(e){a.set(e.$id,[41.380057,2.171269])})}function m(e,t){var o=new GeoFire(y.child("geofire/recs")),n={};angular.forEach(e.types,function(e){n[e]=!0});var i={name:e.name,website:e.website,rating:e.rating,filters:n,placeid:e.place_id,location:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng(),mailmap:e.url}},r=a(y.child("info").child(t));r.$loaded(function(t){angular.forEach(i,function(e,t){e&&(r[t]=e)}),r.$save().then(function(t){alert("Rec Added!"),o.set(t.key,[e.geometry.location.lat(),e.geometry.location.lng()])},function(e){})})}function f(e,a){var o=new GeoFire(y.child("geofire/recs")),n={};angular.forEach(e.types,function(e){n[e]=!0});var i={tag:"recs",cat:a,name:e.name,filters:n,placeid:e.place_id,location:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}};e.website&&(i.website=e.website),e.rating&&(i.rating=e.rating),e.opening_hours&&e.opening_hours.weekday_text&&e.opening_hours.weekday_text&&(i.opening_text=e.opening_hours.weekday_text),t(y.child("info")).$add(i).then(function(t){alert("Rec Added!"),o.set(t.key,[e.geometry.location.lat(),e.geometry.location.lng()]),y.child("media").child(t.key).set({name:e.name})})}function p(e){y.child("vehicles").child(e).child("driver").set(i.uid),y.child("drivers").child(i.uid).child("vehicle").set(e)}function h(e){var i=(new GeoFire(y.child("geofire/Parks")),e.newPark.subdomain),r={pid:e.newPark.subdomain,vendor:e.newPark.vendor,park:!0},l={name:e.newPark.name,welcome:e.newPark.welcome,park:!0},c={email:e.newAdmin.email,password:e.newAdmin.password},d={pid:i,name:e.newPark.name},s={name:e.newPark.name,sales_email:e.newPark.sales_email,full_address:e.newPark.full_address};y.child("partners").child(i).set(l),y.child("info").child(i).set(r),y.child("vendors").child(i).set(s),ParkFire.set(i,[e.newPark.latitude,e.newPark.longitude]).then(function(){}),t(y.child("translations").child(e.newPark.lang)).$add(e.newPark.name).then(function(e){y.child("info").child(i).child("name").set(e.key),y.child("partners").child(i).child("name").set(e.key)}),t(y.child("translations").child(e.newPark.lang)).$add(e.newPark.welcome).then(function(e){y.child("info").child(i).child("welcome").set(e.key),y.child("partners").child(i).child("welcome").set(e.key)}),a(y.child("media").child(i)).$save(d).then(function(e){}),o().$createUserWithEmailAndPassword(c.email,c.password).then(function(e){n.go("app.admin_mng_park",{vendor:i})})["catch"](function(e){console.error("Error: ",e)})}function g(e){var a=new GeoFire(y.child("geofire/vendors")),o={};angular.forEach(e.newSmallVendor.placeObj.types,function(e){o[e]=!0});var n={name:e.newSmallVendor.placeObj.name,filters:o,vendor:!0,placeid:e.newSmallVendor.placeObj.place_id,location:{lat:e.newSmallVendor.placeObj.geometry.location.lat(),lng:e.newSmallVendor.placeObj.geometry.location.lng()}};e.newSmallVendor.placeObj.website&&(n.website=e.newSmallVendor.placeObj.website),e.newSmallVendor.placeObj.rating&&(n.rating=e.newSmallVendor.placeObj.rating),e.newSmallVendor.placeObj.international_phone_number&&(n.phone=e.newSmallVendor.placeObj.international_phone_number),e.newSmallVendor.placeObj.opening_hours&&e.newSmallVendor.placeObj.opening_hours.weekday_text&&(n.opening_text=e.newSmallVendor.placeObj.opening_hours.weekday_text);var i=e.newSmallVendor.subdomain;n.pid=e.newSmallVendor.subdomain;var r={name:e.newSmallVendor.placeObj.name,welcome:e.newSmallVendor.welcome},l={pid:i,name:e.newSmallVendor.placeObj.name,partner_logo:"hold"},c={name:e.newSmallVendor.name,sales_email:e.newSmallVendor.sales_email,paypal:e.newSmallVendor.paypal},d={mailmap:e.newSmallVendor.placeObj.url,location:{lat:n.location.lat,lng:n.location.lng},full_address:e.newSmallVendor.placeObj.formatted_address,place_id:n.placeid};y.child("partners").child(i).set(r),y.child("info").child(i).set(n),y.child("vendors").child(i).set(c),y.child("vendor_locations").child(i).set(d),a.set(i,[n.location.lat,n.location.lng]),t(y.child("translations").child(e.newSmallVendor.lang)).$add(e.newSmallVendor.welcome).then(function(e){y.child("info").child(i).child("welcome").set(e.key),y.child("partners").child(i).child("welcome").set(e.key)}),y.child("media").child(i).set(l)}function v(e){var a={};a.vendor=e.vendor,a.tag=e.tag,e.price&&(a.price=e.price),e.photo&&(a.photo=e.photo),t(y.child("menu_items")).$add(a).then(function(o){a.pid=o.key,angular.forEach(e.extras,function(a){t(y.child("menu_items").child(o.key).child("extras")).$add({price:a.price}).then(function(n){t(y.child("translations").child(e.lang)).$add(a.name).then(function(e){y.child("menu_items").child(o.key).child("extras").child(n.key).child("name").set(e.key)})})}),angular.forEach(e.options,function(a){t(y.child("menu_items").child(o.key).child("options")).$add({price:a.price}).then(function(n){t(y.child("translations").child(e.lang)).$add(a.name).then(function(e){y.child("menu_items").child(o.key).child("options").child(n.key).child("name").set(e.key)})})}),y.child("menu_items").child(o.key).child("pid").set(o.key),y.child("media").child(o.key).set({name:e.name,tag:e.tag}),t(y.child("translations").child(e.lang)).$add(e.name).then(function(e){y.child("menu_items").child(o.key).child("name").set(e.key)}),t(y.child("translations").child(e.lang)).$add(e.description).then(function(e){y.child("menu_items").child(o.key).child("description").set(e.key)})})}function b(e,a){var o=l.defer(),n=e.pid,i=.15,r=y.child("packages").child(n),c=y.child("translations").child("en"),d=y.child("translations").child("es"),s=t(c);t(d);return angular.forEach(a,function(a){var n={};angular.forEach(a.pack,function(e,t){n[t]=e}),n.vendor=e.vendor,n.price=a.pack.price,e.ticket&&(n.ticket=e.ticket),e.full_address&&(n.full_address=e.full_address),n.tax=i*a.pack.price*21/100,t(r).$add(n).then(function(t){s.$add(a.langs.en.name).then(function(i){d.child(i.key).set(a.langs.es.name),y.child("packages").child(e.pid).child(t.key).child("name").set(i.key),n.name=i.key,s.$add(a.langs.en.description).then(function(i){d.child(i.key).set(a.langs.es.description),y.child("packages").child(e.pid).child(t.key).child("description").set(i.key),n.description=i.key,s.$add(a.langs.en.details).then(function(i){d.child(i.key).set(a.langs.es.details),y.child("packages").child(e.pid).child(t.key).child("details").set(i.key),n.details=i.key,o.resolve(n)})})})})}),o.promise}var y=firebase.database().ref();return{newMenuItem:function(e){return v(e)},newPacks:function(e,t){return b(e,t)},newVehicle:function(e){return u(e)},newSmallVendor:function(e){return g(e)},vendorApply:function(e){return s(e)},googleRec:function(e,t){return f(e,t)},updateRec:function(e,t){return m(e,t)},pickupVehicle:function(e){return p(e)},newDriver:function(e){return c(e)},newDriverProvider:function(e){return d(e)},newPark:function(e){return h(e)},newSite:function(e){var o=e.newSite.subdomain,n={pid:e.newSite.subdomain,vendor:e.newSite.vendor},i={name:e.newSite.name,welcome:e.newSite.welcome},r={pid:o,name:e.newSite.name};if(e.vendor){({name:e.newSite.name,sales_email:e.newVendor.sales_email,full_address:e.newVendor.full_address})}y.child("partners").child(o).set(i),y.child("info").child(o).set(n),t(y.child("translations").child(e.newSite.lang)).$add(e.newSite.name).then(function(e){y.child("info").child(o).child("name").set(e.key),y.child("partners").child(o).child("name").set(e.key)}),t(y.child("translations").child(e.newSite.lang)).$add(e.newSite.welcome).then(function(e){y.child("info").child(o).child("welcome").set(e.key),y.child("partners").child(o).child("welcome").set(e.key)}),a(y.child("media").child(o)).$save(r).then(function(e){}),console.log("User "+firebaseUser.uid+" created successfully!")},newProduct:function(e,a,o){var n=l.defer(),i={},r=y.child("translations").child("en"),c=y.child("translations").child("es"),d=t(r);t(c);return i.vendor=e.vendor,i.tag=e.tag,e.ticket&&(i.ticket=e.ticket),e.price&&(i.price=e.price),e.capacity&&(i.capacity=e.capacity),e.duration&&(i.duration=e.duration),t(y.child("info")).$add(i).then(function(t){i.pid=t.key,i.comms=e.comms,y.child("media").child(t.key).set({name:a.en.name,tag:e.tag});for(var r=100;r>=0;r--){var l=moment().clone().add(r,"days").format("YYYY-MM-DD");angular.forEach(o,function(a){y.child("static_stock").child(t.key).child(l).child(a).set({available:e.capacity,capacity:e.capacity})})}d.$add(a.en.name).then(function(e){c.child(e.key).set(a.es.name),y.child("info").child(i.pid).child("name").set(e.key),i.name=e.key,d.$add(a.en.description).then(function(e){c.child(e.key).set(a.es.description),y.child("info").child(i.pid).child("description").set(e.key),i.description=e.key,d.$add(a.en.details).then(function(e){c.child(e.key).set(a.es.details),y.child("info").child(i.pid).child("details").set(e.key),i.details=e.key,n.resolve(i)})})})}),n.promise},newLodgeRoom:function(e){var a={};a.vendor=e.vendor,a.tag=e.tag,a.ammenities=e.ammenites,a.ticket&&(a.ticket=e.ticket),a.capacity&&(a.capacity=e.capacity),t(y.child("rooms").child(a.vendor)).$add(a).then(function(o){t(y.child("translations").child("en")).$add(e.details).then(function(n){y.child("rooms").child(o.key).child("details").set(n.key),t(y.child("translations").child("en")).$add(e.name).then(function(n){y.child("rooms").child(o.key).child("name").set(n.key),t(y.child("translations").child("en")).$add(e.description).then(function(e){y.child("rooms").child(o.key).child("description").set(e.key),y.child("media").child(o.key).set({name:a.name,tag:a.tag})})})})})},newRoomType:function(e){var a={};a.vendor=e.vendor,a.ensuite=e.ensuite,a.bed_price=e.pp_price,a.occupancy=e.occupancy,t(y.child("accomm")).$add(a).then(function(a){alert("New Room Type Added"),y.child("media").child(a.key).set({name:e.name}),t(y.child("translations").child("en")).$add(e.details).then(function(e){y.child("accomm").child(a.key).child("details").set(e.key)}),t(y.child("translations").child("en")).$add(e.name).then(function(e){y.child("accomm").child(a.key).child("name").set(e.key)}),t(y.child("translations").child("en")).$add(e.description).then(function(e){y.child("accomm").child(a.key).child("description").set(e.key)})})},newRoom:function(e,a){var o={};o.vendor=e.vendor,o.room_type=e.room_type,o.number=e.number,o.bed_price=e.pp_price,o.occupancy=e.occupancy,t(y.child("rooms")).$add(o).then(function(o){for(var n=1;n<=e.beds;){var i={room_id:o.key,price:e.pp_price,vendor:e.vendor,type:a[n]};t(y.child("beds")).$add(i).then(function(e){y.child("rooms").child(o.key).child("beds").child(e.key)}),n+=1}})},newRec:function(e){var a={},e=e,o=firebase.database().ref();a.tag="recs",a.cat=e.cat,a.openTime=moment(e.openTime).format("HH-mm"),a.closeTime=moment(e.closeTime).format("HH-mm"),a.location=e.location,t(o.child("info")).$add(a).then(function(n){o.child("media").child(n.key).set({name:e.name,tag:a.tag,cat:a.cat}),t(o.child("translations").child(e.lang)).$add(e.details).then(function(e){o.child("info").child(n.key).child("details").set(e.key)}),t(o.child("translations").child(e.lang)).$add(e.name).then(function(e){o.child("info").child(n.key).child("name").set(e.key)}),t(o.child("translations").child(e.lang)).$add(e.description).then(function(e){o.child("info").child(n.key).child("description").set(e.key)});var i=[a.location.lat,a.location.lng],r=new GeoFire(o.child("geofire/recs"));r.set(n.key,i)},function(e){})}}}]).factory("PosTools",["$http","$firebaseArray","$firebaseObject","$firebaseAuth","Ticketing","$state","$rootScope",function(e,t,a,o,n,i,r){function l(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(t.length),n=0;n<t.length;n++)o[n]=t.charCodeAt(n);return new Blob([o],{type:a})}function c(t,a,o){var n=a.pid+"/"+a.date+"/"+a.time,i={method:"POST",url:"https://www.pbpapi.com/ticketing/"+o+"_sale",data:{obj:a,pos:t,url:n}};e(i).then(function(t){var a=l(t.data.file),i=firebase.storage().ref("tickets/"+t.data.profile.uid+"/"+t.data.key+".png"),r=i.put(a);r.on("state_changed",function(e){},function(e){},function(){var a=r.snapshot.downloadURL;if(t.data.profile.email){var i={method:"POST",url:"https://www.pbpapi.com/ticketing/"+o+"_ticket",data:{tix:t.data.key,email:t.data.profile.email,url:n}};e(i)}d.child("tix").child(t.data.key).child("url").set(a)})})}var d=firebase.database().ref();return{cashSale:function(e){t(d.child("pos/"+e.vendor+"/"+moment().format("YYYY-MM-DD")+"/sales")).$add(e).then(function(t){d.child("pos/"+e.vendor+"/"+moment().format("YYYY-MM-DD")+"/cash").transaction(function(t){t?t+=e.total:t=e.total}),c(t.key,e,"cash")})},cardSale:function(e){t(d.child("pos/"+e.vendor+"/"+moment().format("YYYY-MM-DD")+"/sales")).$add(e).then(function(t){d.child("pos/"+e.vendor+"/"+moment().format("YYYY-MM-DD")+"/card").transaction(function(t){t?t+=e.total:t=e.total}),c(t.key,e,"card")})}}}]).factory("Ticketing",["$http","$firebaseArray","$firebaseObject","$firebaseAuth","$state","$stateParams","$rootScope",function(e,t,a,o,n,i,r){function l(t,a,o){var n=t+"/"+moment(a).format("YYYY-MM-DD")+"/"+moment(a).format("HH-mm"),i={method:"POST",url:"https://www.pbpapi.com/ticketing/set_new",data:{url:n,capacity:o}};e(i)}function c(t,a){m.child("profiles").child(t).child("email").set(a.email),a.name&&m.child("profiles").child(t).child("name").set(a.name),m.child("freebies").child(a.item.pid).child(r.partner).child("available").transaction(function(e){
return e&&"error"!=e&&e>0?e--:"error"},function(){var o={method:"POST",url:"https://www.pbpapi.com/ticketing/"+r.partner+"/freeMe/"+t+"/"+a.item.pid+"/"+a.item["package"],data:{uid:t,free_id:a.item.pid,pack_id:a.item["package"]}};e(o).then(function(e){m.child("profiles").child(t).child("prizeClaimed").set(!0)})})}function d(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(t.length),n=0;n<t.length;n++)o[n]=t.charCodeAt(n);return new Blob([o],{type:a})}function s(t,a){var o={method:"POST",url:"https://www.pbpapi.com/ticketing/ticketMe",data:{txId:a}};e(o).then(function(e){var o=d(e.data.file),n=firebase.storage().ref("tickets/"+t+"/"+a+".png"),i=n.put(o);i.on("state_changed",function(e){},function(e){},function(){var e=i.snapshot.downloadURL;m.child("tix").child(a).child("url").set(e)})})}function u(t,a,o){var n={method:"POST",url:"https://www.pbpapi.com/ticketing/update_sold",data:{obj:t,id:a,date:o}};e(n)}var m=firebase.database().ref();return{saveQr:function(e){return saveQR(e)},ticketGen:function(e,t){return s(e,t)},setNew:function(e,t,a){return l(e,t,a)},updateTix:function(e,t,a){return u(e,t,a)},freeMe:function(e,t){return c(e,t)}}}]).factory("InfoService",["$q","$firebaseArray","$timeout","$cacheFactory",function(e,t,a,o){function n(t){var a=e.defer(),o=s.get(t);return angular.isUndefined(o)?d.child("info").child(t).once("value",function(e){if(e){var t=e.val();a.resolve(t)}else a.reject("item-not-found"+err)}):a.resolve(o),a.promise}function i(a){var o=e.defer(),n=s.get(a),i=[];if(angular.isUndefined(n)){var r;r="sights"==a?"cat":"tag";var l=[];t(d.child("info").orderByChild(r).equalTo(a)).$loaded(function(e){var t=[];angular.forEach(e,function(e){e.product&&(l.push(e.$id),t.push(e),angular.isUndefined(s.get(e.$id))&&s.put(e.$id,e))}),s.put(a,l),o.resolve(t)})}else angular.forEach(n,function(e){i.push(s.get(e))}),o.resolve(i);return o.promise}function r(){var a=e.defer(),o=s.get("products"),n=[];if(angular.isUndefined(o)){var i=[];t(d.child("info").orderByChild("product").equalTo(!0)).$loaded(function(e){angular.forEach(e,function(e){i.push(e.$id),angular.isUndefined(s.get(e.$id))&&s.put(e.$id,e)}),s.put("products",i),a.resolve(e)})}else angular.forEach(o,function(e){n.push(s.get(e))}),a.resolve(n);return a.promise}function l(a){var o=e.defer(),n=s.get("products"),i=[];if(angular.isUndefined(n)){t(d.child("info").orderByChild("vendor").equalTo(a)).$loaded(function(e){console.log(e),angular.forEach(e,function(e){angular.isUndefined(s.get(e.$id))&&s.put(e.$id,e)}),o.resolve(e)})}else angular.forEach(n,function(e){var t=s.get(e);t.vendor==a,i.push(t)}),o.resolve(i);return o.promise}function c(a){var o=e.defer(),n=s.get("code"),i=[];if(angular.isUndefined(n)){var r=[];t(d.child("info").orderByChild("partner").equalTo(a)).$loaded(function(e){angular.forEach(e,function(e){angular.isUndefined(s.get(e.$id))&&(s.put(e.$id,e),r.push(e.$id))}),s.put("code",r),o.resolve(e)})}else angular.forEach(n,function(e){i.push(s.get(e))}),o.resolve(i);return o.promise}var d=firebase.database().ref(),s=(t(d.child("info")),o("info"));return{infoArray:function(){return s.get("array")},filterProds:function(){return r()},getInfo:function(e){return n(e)},getPartners:function(e){return c(e)},getVendorProducts:function(e){return l(e)},getCat:function(e){return i(e)}}}]).factory("PackageService",["$q","$firebaseArray","$firebaseObject","$timeout","$cacheFactory",function(e,t,a,o,n){function i(a){var o=e.defer(),n=c.get(a);return angular.isUndefined(n)?t(l.child("packages").child(a)).$loaded(function(e){c.put(a,e),o.resolve(e)}):o.resolve(n),o.promise}function r(t){var o=e.defer(),n=c.get(t);return angular.isUndefined(n)?a(l.child("packages").child(t)).$loaded(function(e){c.put(t,e),o.resolve(e)}):o.resolve(n),o.promise}var l=firebase.database().ref(),c=n("packz");return{getPackages:function(e){return i(e)},getPackagesObj:function(e){return r(e)}}}]).factory("MediaService",["$q","$firebaseArray","$firebaseObject","$timeout","$cacheFactory",function(e,t,a,o,n){function i(){var a,o=e.defer(),n=t(c.child("media"));return n.$loaded(function(e){a=e;angular.forEach(e,function(e){d.put(e.$id,e)}),d.put("array",e),o.resolve(e)},function(e){o.reject(e)}),o.promise}function r(){var t=e.defer(),a=d.get("array");return a&&a.length>2?(console.log(a),t.resolve(a)):i().then(function(e){t.resolve(e)}),t.promise}function l(t){var a=e.defer(),o=d.get(t);return angular.isUndefined(o)?c.child("media").child(t).once("value",function(e){d.put(t,e.val()),a.resolve(e.val())}):(console.log(o),a.resolve(o)),a.promise}var c=firebase.database().ref(),d=n("media");return{getMediaArray:function(){return r()},getMedia:function(e){return l(e)}}}]).factory("ProductsService",["$q","$firebaseArray","$firebaseObject","$timeout","$cacheFactory",function(e,t,a,o,n){function i(){var a,o=e.defer(),n=t(d.child("info").orderByChild("product").equalTo(!0));return n.$loaded(function(e){a=e;angular.forEach(e,function(e){s.put(e.$id,e)}),s.put("array",e),o.resolve(e)},function(e){o.reject(e)}),o.promise}function r(){var t=e.defer(),a=s.get("array");return a&&a.length>4?(console.log(a),t.resolve(a)):i().then(function(e){t.resolve(e)}),t.promise}function l(t){var a=e.defer(),o=s.get(t);return angular.isUndefined(o)?d.child("info").child(t).once("value",function(e){s.put(t,e.val()),a.resolve(e.val())}):(console.log(o),a.resolve(o)),a.promise}function c(t){var a=e.defer(),o=s.get("array"),n=[];return angular.isUndefined(o)?i().then(function(e){c(t)}):(console.log(o),angular.forEach(o,function(e){e.tag!=t&&e.cat!=t||n.push(e)}),a.resolve(n)),a.promise}var d=firebase.database().ref(),s=n("products");return i(),{getProducts:function(){return r()},getProduct:function(e){return l(e)},getCategory:function(e){return c(e)}}}]).factory("Booking",["$firebaseArray",function(e){return function(){}}]),angular.module("tktr.vrctrl",["tktr.services"]).controller("VrAppCtrl",["$scope","MediaService","$log","$state","$stateParams","$rootScope","$http","$anchorScroll","$location","$mdMedia","$mdDialog","$timeout","$geolocation","$firebaseObject","$firebaseArray","$translate","User","$mdToast","Auth","$mdSidenav","$mdDialog","$sce","$interval","deviceDetector","subdomain","InfoService",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,s,w,k,$,S,P){var A=firebase.database().ref();P.filterProds().then(function(t){e.products=t,e.loadWorld()}),e.filters=[{icon:"assets/site/cat_guidedtours_btn.svg",text:"tours"},{icon:"assets/site/cat_rentanything_btn.svg",text:"rentals"},{icon:"assets/site/cat_activities_btn.svg",text:"activities"},{icon:"assets/site/cat_sights_btn.svg",text:"sights"}],p(A.child("media").orderByChild("vr")).$loaded(function(t){e.spheres=t}),e.showProd=function(e){},e.loadWorld=function(){var t=[],a=0;angular.forEach(e.filters,function(e){t.push({id:e.text,longitude:a,latitude:-.1377,image:e.icon,width:150,height:150,anchor:"center center"}),a+=70}),e.vrbgViewer=new PhotoSphereViewer({panorama:"assets/vr/activities_sphere.jpg",container:"vrbg",anim_speed:"0.5rpm",navbar:!1,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,loading_img:"https://firebasestorage.googleapis.com/v0/b/tktr-fa4cf.appspot.com/o/media%2Ftktr%2FTKTR.es_150x150.png?alt=media&token=01a4c9c2-6746-4bb3-973c-27f7fc544f86",transition:{duration:1500,loader:!0,blur:!0},markers:t,navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}}),e.vrbgViewer.on("select-marker",function(e){o.go("vrapp.cat",{tag:e.id})})}}]).controller("VrCatCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock","$translate","DateParser","ProductsService","InfoService","PackageService","User",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k,$,S,P){e.loadCat=function(t){e.vrbgViewer.clearMarkers();var a="assets/site/"+t+".jpg";$.getCat(t).then(function(t){e.category=t;var a=0;console.log(t),angular.forEach(t,function(o){if(o.wide_branding){e.vrbgViewer.addMarker({id:o.$id,image:o.wide_branding,width:300,height:150,x:a,y:1e3,content:"<p>"+o.tag+"</p>"},!1);a+=2048/t.length}else console.log(o)})}),e.vrbgViewer.setPanorama(a,{longitude:Math.PI,latitude:0},!0),e.vrbgViewer.render(),e.vrbgViewer.on("select-marker",function(e){$state.go("vrapp.info",{id:e.id})})},e.loadCat(r.tag)}]).controller("VrProdCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock","$translate","DateParser","ProductsService","InfoService","PackageService","User",function(e,t,a,o,n,i,r,l,c,d,s,u,m,f,p,h,g,v,b,y,w,k,$,S,P){e.vendorFilter={},e.ymlFilter={},e.prodView||(e.prodView=!0);var A=firebase.database().ref();e.paramKey,e.init=function(t){e.paramKey=t},r.id&&(e.paramKey=r.id),e.ivView="info",e.iHudUp=function(t){e.ivView=t},e.ivMediaBool=!0,e.launchMedia=function(e){},P.anonAdsArrival().then(function(t){e.user=t.profile,e.auth=t.auth}),e.info={};var _=firebase.database().ref("geofire/locs");new GeoFire(_);e.buyNow=!1,e.showBuy=function(){e.buyNow=!e.buyNow},e.productFadeImg={},e.affOpts=[],e.paramKey&&(e.affOpts=[],$.getInfo(e.paramKey).then(function(t){e.info=t,t.aff_tix&&angular.forEach(t.aff_tix,function(t,a){"viator"==a?angular.forEach(t,function(t,o){A.child("affiliates").child(a).child("products").child(o).once("value",function(t){var o=t.val();o.provider=a,e.affOpts.push(o)})}):angular.forEach(t,function(t,o){A.child("affiliates").child(a).child(o).once("value",function(t){if(t){var o=t.val();o.provider=a,e.affOpts.push(o)}})})}),y(t.name).then(function(t){e.infoName=t},function(a){e.infoName=t.name});var a,o;"recs"==t.tag&&t.cat?(o="cat",a=t.cat,e.ymlFilter={tag:"recs",cat:a}):(o="tag",a=t.tag,e.ymlFilter={tag:a}),e.productFadeImg="background: url('"+e.info.wide_branding+"'); background-size: 100% 100%; background-repeat: no-repeat; opacity: 0.5; background-size: cover; background-position: left;",k.getCategory(a).then(function(t){e.displayArray=t,f(function(){window.prerenderReady=!0},3e3)}),e.ymlFilter.tag=e.info.tag,"recs"==e.info.tag&&(e.ymlFilter={tag:"recs",cat:e.info.cat}),e.vendorFilter.vendor=e.info.vendor,e.search={},e.info&&"recs"==e.info.tag?(e.search.cat=e.info.cat,e.search.tag="recs"):e.info&&e.paramKey&&S.getPackages(e.paramKey).then(function(t){e.packages=t}),e.search={tag:e.info.tag}})),e.timeCheck=function(t){if(t){var a=moment(t).format("YYYY-MM-DD");e.build.date=a,e.times=Object.keys(e.buildStatStock[a])}else if(e.builderDate&&e.buildStatStock){var a=moment(e.builderDate).format("YYYY-MM-DD");e.build.date=a,e.times=Object.keys(e.buildStatStock[a])}else e.times=[]},e.setTime=function(t,a){e.build.time=t,a&&e.checkStatic()},e.timeEnqCheck=function(){if(!e.enquireObj.date)return e.times=[];var t=moment(e.enquireObj.date).format("YYYY-MM-DD");e.times=Object.keys(e.buildStatStock[t])},e.selTime=function(t){if(e.buildStatStock&&e.build.date){var a=moment(e.build.date).format("YYYY-MM-DD");e.buildStatStock[a][t].available>0?e.build.time=t:$mdToast.show($mdToast.simple().textContent("Unavailable!"))}else $mdToast.show($mdToast.simple().textContent("Unavailable!"));e.build.time=t},e.filterTimes=function(t){var a=[];angular.forEach(e.times,function(e){moment(e.mnt).isSame(moment(t),"day")&&a.push(e)}),e.times=a},e.buildTimes=function(){if(e.build.date&&e.buildStatStock){var t=moment(e.build.date).format("YYYY-MM-DD");return e.buildStatStock[t]}return{}},e.prettyDate=function(){if(e.build.date){moment(e.build.date).clone().format("YYYY-MM-DD");if(e.build.time.length>6)return moment(e.build.date).clone().format("lll");var t=e.build.time.split("-");return moment(e.build.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.gallery=[],e.distance=function(){if(e.info&&e.info.location&&e.userLoc)return GeoFire.distance([e.info.location.lat,e.info.location.lng],e.userLoc)},e.builderDate=new Date,e.todayDate=new Date,e.minDate=new Date(e.todayDate.getFullYear(),e.todayDate.getMonth(),e.todayDate.getDate()),e.maxDate=new Date(e.todayDate.getFullYear(),e.todayDate.getMonth()+8,e.todayDate.getDate()),e.todayFormat=moment().clone().subtract(1,"days").format("YYYY-DD-MM"),e.vrGrow=function(t){return t==e.vrId?4:1},e.vrId="",e.explNow=function(){e.explView=!e.explView},e.growVR=function(t){e.vrId=t},e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},o(A.child("profiles/"+p.uid)).$loaded(function(t){e.user=t}),e.gvrs=[],e.enqDate=function(){if(e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)return moment(e.enquireObj.date).clone().format("lll");var t=e.enquireObj.time.split("-");return moment(e.enquireObj.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.enquireObj={},e.enquireBuild=function(){e.enquireObj.location=e.info.location;e.packages[0],e.packages[0].$id;e.times=[],e.enquireObj={};var t=e.info;angular.forEach(t,function(t,a){e.enquireObj[a]=t}),e.user&&("Guest"!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=e.info.$id,e.enquireObj.parent=t.$id;var a=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+e.info.$id).orderByKey().startAt(a).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0,e.times=[];var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})},e.enquireVBuild=function(t){e.enquireObj.location=a.location;e.packages[0],e.packages[0].$id;e.times=[],e.enquireObj={};var a=e.info;angular.forEach(a,function(t,a){e.enquireObj[a]=t}),e.user&&("Guest"!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=e.info.$id,e.enquireObj.parent=a.$id;var n=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+t).orderByKey().startAt(n).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0,e.times=[];var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})},e.enqNow=function(t){if(e.enquireObj.sending=!0,e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)e.enquireObj.date=e.enquireObj.date.clone().format("lll");else{var o=e.enquireObj.time.split("-");e.enquireObj.date=moment(e.enquireObj.date).clone().hours(parseInt(o[0])).minutes(parseInt(o[1])).format("lll")}}n(A.child("enqs")).$add(e.enquireObj).then(function(o){var n={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.enquireObj.vendor+"/enquire",data:{uid:e.appAuth.uid,enquiry:e.enquireObj},dataType:"json",headers:{"Content-Type":"application/json"}};a(n).then(function(t){e.enquireObj.sent=!0,e.enquireObj={},f(function(){e.enquireObj.sending=!1},5e3)},function(e){}),A.child("profiles").child(e.appAuth.uid).child("name").set(e.enquireObj[t].username),A.child("profiles").child(e.appAuth.uid).child("email").set(e.enquireObj[t].email)})},e.vendorNumber=function(e){A.child("info").child(e).child("phone").on("value",function(e){return e.val()})},e.avalnow=function(){var t=moment(e.build.date).format("YYYY-MM-DD"),a=moment(e.build.time).format("HH-mm");return e.buildStatStock[t]&&e.buildStatStock[t][a]&&e.buildStatStock[t][a].available?e.buildStatStock[t][a].available:e.buildStatStock[t]&&!e.buildStatStock[t][a]&&e.buildStatStock[t].available?e.buildStatStock[t].available:void 0},e.myState=function(e){return paramKey==e},e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.loadImg=function(t){e.centerImg=t},o(A.child("ticketing/"+e.paramKey)).$loaded(function(t){e.ticketing=t}),e.expand=!1,e.checkStatic=function(){b.checkStatic(e.build).then(function(t){t?e.build.greenlit=1:e.build.greenlit=2})},e.numbArray=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],e.build={},e.buildPack=function(t){e.buildPack=e.packageData[t][t],e.buildPack.quantity=e.build.quantity},e.surgeBool=function(){var t=!1;if(e.build&&e.build.date&&e.build.weekend_charge){var a=moment(e.build.date).day();angular.forEach(e.build.weekend_charge.days,function(e,o){e==a&&(t=!0)})}return t},e.tObj={};moment().format("YYYY-MM-DD");e.packBuy=function(t){e.ivView="buy",e.builder(t)},e.packVBuy=function(){e.ivView="buy",e.builderVaya()},e.dOpts=[],e.builder=function(t){var a;a=!t.name&&t.val?t.val:t,console.log(a),e.times=[],e.build={},angular.forEach(a,function(t,a){e.build[a]=t}),e.build.date=null,e.build.time=null,e.build.pid=a.$id,e.build.parent=r.id,e.build.weekend_charge&&(e.build.quantity=1),e.buildStatStock={},e.build.greenlit=0,e.tObj={};var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(A.child("static_stock/"+r.id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.tObj={k:[]},e.valiDates={},e.validDates[a]=!0,e.dOpts.push(moment(a).format("ll"))})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+r.id).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.clearBuild=function(){e.build=null},e.tempDate={},e.stops=["junta","rraval"],e.builderVaya=function(){e.times=[],e.build={};var t=e.packages[0],a=e.packages[0].$id;angular.forEach(t,function(t,a){e.build[a]=t}),e.build.date=e.tempDate.date,e.build.time=null,e.build.pid=a,e.build.parent=t.parent,e.build.greenlit=0;var n=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||o(A.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date),"day")&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})}),e.build.ticket){var n=moment().format("YYYY-MM-DD");o(A.child("static_stock/"+t.parent).orderByKey().startAt(n)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,a){e.valiDates={},e.validDates[a]=!0;var o=a;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,a){if(t){var n=o+" "+a;moment(n).isAfter()&&moment(n).isSame(moment(e.build.date))&&e.times.push({mnt:moment(n),time:moment(n).add(-1,"hours").format("HH:mm"),key:a})}})})})}},e.checkStock=function(){b.checkStock(e.build).then(function(t){t&&(e.build.stock=t,e.build.greenlit=!0)})["catch"](function(t){e.build.time=null,e.build.quantity=null,alert(t)})},e.validDates={},e.today=moment().format("YYYY-MM-DD"),e.validate=function(t){var a=moment(t).format("YYYY-MM-DD");return!e.validDates[a]},e.times=[],e.checkDay=function(t){return moment(t).isSame(e.build.date,"day")},e.indexShift=function(t){var a=e.showIndex+t;a>e.gallery.length-1?e.showIndex=0:a<0?e.showIndex=e.gallery.length-1:e.showIndex=a},e.showIndex=0,e.prettyTime=function(e){var t=e.split("-"),a=t[0]+":"+t[1];return a},e.mediaFilter={},e.currentDate=Date(),e.selectDay=function(t){u(e.currentDate,{targetEvent:t}).then(function(t){e.build.date=moment(t).format("YYYY-MM-DD")})},e.selectBVaya=function(t){u(e.currentDate,{targetEvent:t}).then(function(t){e.tempDate.date=moment(t).format("YYYY-MM-DD"),e.builderVaya()})},e.showTimePicker=function(t){m(e.currentTime,{targetEvent:t}).then(function(a){var o=moment(a).format("HH-mm");e.ticketing[e.build.date][o]?e.build.time=o:e.showTimePicker(t)})},e.imgIndex=0,e.addToCart=function(){d.addItem(e.build),e.clearBuild()}}]);
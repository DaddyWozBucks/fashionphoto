angular.module("neocles",["neocles.controllers","neocles.services","neocles.directives","neocles.filters","ui.router","ngAnimate","ngSanitize","firebase","ngMaterial","angular-storage","ngGeolocation","mdColorPicker","ja.qr","ngFileUpload","720kb.socialshare","pascalprecht.translate","qrScanner","rzModule","nvd3","ngIdle","jkAngularRatingStars","chart.js","ng.deviceDetector"]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeError",function(e,n,a,i,o,r){"AUTH_REQUIRED"===r&&t.go("app.landing")})}]).config(["$mdDateLocaleProvider",function(e){e.formatDate=function(e){return moment(e).format("YYYY-MM-DD")}}]).run(["Idle",function(e){e.watch()}]).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self"])}]).run(["$rootScope","$state",function(e,t){e.stateIsLoading=!0,e.$on("$stateChangeStart",function(){e.stateIsLoading=!0})}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,n){e.state("app",{url:"/app","abstract":!0,views:{header:{templateUrl:"templates/app2.html",controller:"AppCtrl"}}}).state("app.home",{url:"/home",views:{main:{templateUrl:"templates/home.html",controller:"HomeCtrl"}}}).state("app.city",{url:"/city",views:{main:{templateUrl:"templates/city.html",controller:"CityCtrl"}}}),t.otherwise(function(){return"/app/login"})}]).config(["$mdThemingProvider",function(e){e.theme("default")}]),angular.module("neocles.controllers",["neocles.services","neocles.filters"]).controller("AppCtrl",["$scope","$log","$state","$stateParams","$rootScope","$http","$anchorScroll",function(e,t,n,a,i,o,r){}]).controller("LoginCtrl",["$scope","$http","LoginService",function(e,t,n){e.loginForm={username:{type:"text",value:"",label:"Username"},password:{type:"password",value:"",label:"Password"}},e.login=function(){""!=e.loginForm.username.value&&""!=e.loginForm.password.value&&e.loginForm.password.value.length>6&&n.login(e.loginForm.username.value,e.loginForm.password.value).then(function(e){e&&$state.go("app.products")})}}]).controller("ProductCtrl",["$scope","$http","ProductService",function(e,t,n){e.startIndex=0,e.pageTotal=10,n.textSearch("",e.startIndex,e.pageTotal).then(function(){}),e.getProductResults=function(t){return n.textSearch("",e.startIndex,e.pageTotal).then(function(){e.searchResults=data})},e.nextPage=function(){e.startIndex+=e.pageTotal,e.getProductResults(e.searchText)},e.imgTransform=function(e,t,n){return t&&n?e+"&width="+t+"&height="+n:e}}]),angular.module("neocles.directives",[]).directive("tagEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){var a=t.which||t.keyCode;13===a&&(e.$apply(function(){e.$eval(n.dlEnterKey)}),t.preventDefault())})}}).directive("threeKeys",function(){return function(e,t,n){var a=0;t.bind("keydown keypress",function(t){a++,a>=3&&(e.$apply(function(){e.$eval(n.myOnKeyDownCall)}),t.preventDefault())})}}).directive("myAutocomplete",function(){return{require:"ngModel",replace:!0,scope:{ngModel:"=",address1:"=",city:"=",state:"=",country:"=",zip:"="},template:'<input class="form-control" type="text" data-tap-disabled>',link:function(e,t,n,a){var i={},o=new google.maps.places.Autocomplete(t[0],i);google.maps.event.addListener(o,"place_changed",function(){e.$apply(function(){var n=o.getPlace(),i=n.address_components;e.address1=i[0].short_name+" "+i[1].short_name,e.city=i[3].short_name,e.state=i[5].short_name,e.country=i[6].long_name,e.zip=i[7].short_name,a.$setViewValue(t.val())})})}}}).directive("backImg",function(){return function(e,t,n){var a=n.backImg;t.css({"background-image":"url("+a+")","background-size":"cover"})}}).directive("disabletap",["$timeout",function(e){return{link:function(){e(function(){container=document.getElementsByClassName("pac-container"),angular.element(container).attr("data-tap-disabled","true"),angular.element(container).on("click",function(){document.getElementById("type-selector").blur()})},500)}}}]).directive("onLongPress",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){n.bind("touchstart",function(n){t.longPress=!0,e(function(){t.longPress&&t.$apply(function(){t.$eval(a.onLongPress)})},600)}),n.bind("touchend",function(e){t.longPress=!1,a.onTouchEnd&&t.$apply(function(){t.$eval(a.onTouchEnd)})})}}}]).directive("myDirective",function(){return{restrict:"EA",scope:{title:"@"},templateUrl:"mytemplate.html",controller:controllerFunction,link:function(e,t,n){}}}).directive("ngDrag",["$document",function(e){return{link:function(t,n,a){function i(e){c=e.pageY-l,u=e.pageX-r,n.css({top:c+"px",left:u+"px"})}function o(){e.off("mousemove",i),e.off("mouseup",o)}var r=0,l=0,u=0,c=0;n.on("mousedown",function(t){t.preventDefault(),r=t.pageX-u,l=t.pageY-c,e.on("mousemove",i),e.on("mouseup",o)})}}}]),angular.module("neocles.filters",[]),jQuery.expr.filters.offscreen=function(e){var t=e.getBoundingClientRect();return t.x+t.width<0||t.y+t.height<0||t.x>window.innerWidth||t.y>window.innerHeight},function(e){var t=e(window);e.fn.visible=function(n,a,i,o){if(!(this.length<1)){i=i||"both";var r=this.length>1?this.eq(0):this,l="undefined"!=typeof o&&null!==o,u=l?e(o):t,c=l?u.position():0,d=r.get(0),s=u.outerWidth(),m=u.outerHeight(),f=a!==!0||d.offsetWidth*d.offsetHeight;if("function"==typeof d.getBoundingClientRect){var p=d.getBoundingClientRect(),g=l?p.top-c.top>=0&&p.top<m+c.top:p.top>=0&&p.top<m,h=l?p.bottom-c.top>0&&p.bottom<=m+c.top:p.bottom>0&&p.bottom<=m,b=l?p.left-c.left>=0&&p.left<s+c.left:p.left>=0&&p.left<s,v=l?p.right-c.left>0&&p.right<s+c.left:p.right>0&&p.right<=s,y=n?g||h:g&&h,k=n?b||v:b&&v,y=p.top<0&&p.bottom>m||y,k=p.left<0&&p.right>s||k;if("both"===i)return f&&y&&k;if("vertical"===i)return f&&y;if("horizontal"===i)return f&&k}else{var $=l?0:c,D=$+m,S=u.scrollLeft(),w=S+s,Y=r.position(),q=Y.top,j=q+r.height(),O=Y.left,M=O+r.width(),_=n===!0?j:q,P=n===!0?q:j,x=n===!0?M:O,T=n===!0?O:M;if("both"===i)return!!f&&P<=D&&_>=$&&T<=w&&x>=S;if("vertical"===i)return!!f&&P<=D&&_>=$;if("horizontal"===i)return!!f&&T<=w&&x>=S}}}}(jQuery),angular.module("neocles.services",[]).factory("LoginService",["$http","$cacheFactory","$q",function(e,t,n){function a(t,a){var i=n.defer(),o={url:"https://epicuroapitest.azurewebsites.net/token?grant_type=password&username="+t+"&password="+a,method:"POST"};return e(o).then(function(e){e&&e.data?i.resolve(!0):i.resolve(!1)}),i.promise}function i(){var e=n.defer(),t=o.get("token");return t?e.resolve(t):e.reject(!1),e.promise}var o=t("token");return{login:function(e,t){return a(e,t)},getToken:function(){return i()}}}]).factory("ProductService",["$http","$cacheFactory","$q","LoginService",function(e,t,n,a){function i(t,i,o){var r=n.defer();return a.getToken().then(function(n){var n=n,a={url:"https://epicuroapitest.azurewebsites.net/api/products/"+n+"?q="+t+"&start="+i+"&num="+o+"&type=now",method:"POST"};e(a).then(function(e){e&&e.data?r.resolve(e.data):r.resolve(!1)})}),r.promise}t("products");return{textSearch:function(e,t,n){return i(e,t,n)},getToken:function(){return getToken()}}}]),"undefined"==typeof Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),angular.module("neocles.vrctrl",["neocles.services"]).controller("VrAppCtrl",["$scope","MediaService","$log","$state","$stateParams","$rootScope","$http","$anchorScroll","$location","$mdMedia","$mdDialog","$timeout","$geolocation","$firebaseObject","$firebaseArray","$translate","User","$mdToast","Auth","$mdSidenav","$mdDialog","$sce","$interval","deviceDetector","subdomain","InfoService",function(e,t,n,a,i,o,r,l,u,c,d,s,m,f,p,g,h,b,v,y,d,k,$,D,S,w){var Y=firebase.database().ref();w.filterProds().then(function(t){e.products=t,e.loadWorld()}),e.filters=[{icon:"assets/site/cat_guidedtours_btn.svg",text:"tours"},{icon:"assets/site/cat_rentanything_btn.svg",text:"rentals"},{icon:"assets/site/cat_activities_btn.svg",text:"activities"},{icon:"assets/site/cat_sights_btn.svg",text:"sights"}],p(Y.child("media").orderByChild("vr")).$loaded(function(t){e.spheres=t}),e.showProd=function(e){},e.loadWorld=function(){var t=[],n=0;angular.forEach(e.filters,function(e){t.push({id:e.text,longitude:n,latitude:-.1377,image:e.icon,width:150,height:150,anchor:"center center"}),n+=70}),e.vrbgViewer=new PhotoSphereViewer({panorama:"assets/vr/activities_sphere.jpg",container:"vrbg",anim_speed:"0.5rpm",navbar:!1,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,gyroscope:!0,usexmpdata:!0,auto_rotate:!1,loading_img:"https://assets.tktr.es/assets/tktreu_p_logo.png",transition:{duration:1500,loader:!0,blur:!0},markers:t,navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}}),e.vrbgViewer.on("select-marker",function(e){a.go("vrapp.cat",{tag:e.id})})}}]).controller("VrCatCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock","$translate","DateParser","ProductsService","InfoService","PackageService","User",function(e,t,n,a,i,o,r,l,u,c,d,s,m,f,p,g,h,b,v,y,k,$,D,S,w){e.loadCat=function(t){e.vrbgViewer.clearMarkers();var n="assets/site/"+t+".jpg";D.getCat(t).then(function(t){e.category=t;var n=0;console.log(t),angular.forEach(t,function(a){if(a.wide_branding){e.vrbgViewer.addMarker({id:a.$id,image:a.wide_branding,width:300,height:150,x:n,y:1e3,content:"<p>"+a.tag+"</p>"},!1);n+=2048/t.length}else console.log(a)})}),e.vrbgViewer.setPanorama(n,{longitude:Math.PI,latitude:0},!0),e.vrbgViewer.render(),e.vrbgViewer.on("select-marker",function(e){$state.go("vrapp.info",{id:e.id})})},e.loadCat(r.tag)}]).controller("VrProdCtrl",["$scope","$geolocation","$http","$firebaseObject","$firebaseArray","Ticketing","$stateParams","$animate","Auth","Cart","$mdpDatePicker","$mdSidenav","$mdpTimePicker","$timeout","$rootScope","AdminTools","$sce","$mdMedia","Stock","$translate","DateParser","ProductsService","InfoService","PackageService","User",function(e,t,n,a,i,o,r,l,u,c,d,s,m,f,p,g,h,b,v,y,k,$,D,S,w){e.vendorFilter={},e.ymlFilter={},e.prodView||(e.prodView=!0);var Y=firebase.database().ref();e.paramKey,e.init=function(t){e.paramKey=t},r.id&&(e.paramKey=r.id),e.ivView="info",e.iHudUp=function(t){e.ivView=t},e.ivMediaBool=!0,e.launchMedia=function(e){},w.anonAdsArrival().then(function(t){e.user=t.profile,e.auth=t.auth}),e.info={};var q=firebase.database().ref("geofire/locs");new GeoFire(q);e.buyNow=!1,e.showBuy=function(){e.buyNow=!e.buyNow},e.productFadeImg={},e.affOpts=[],e.paramKey&&(e.affOpts=[],D.getInfo(e.paramKey).then(function(t){e.info=t,t.aff_tix&&angular.forEach(t.aff_tix,function(t,n){"viator"==n?angular.forEach(t,function(t,a){Y.child("affiliates").child(n).child("products").child(a).once("value",function(t){var a=t.val();a.provider=n,e.affOpts.push(a)})}):angular.forEach(t,function(t,a){Y.child("affiliates").child(n).child(a).once("value",function(t){if(t){var a=t.val();a.provider=n,e.affOpts.push(a)}})})}),y(t.name).then(function(t){e.infoName=t},function(n){e.infoName=t.name});var n,a;"recs"==t.tag&&t.cat?(a="cat",n=t.cat,e.ymlFilter={tag:"recs",cat:n}):(a="tag",n=t.tag,e.ymlFilter={tag:n}),e.productFadeImg="background: url('"+e.info.wide_branding+"'); background-size: 100% 100%; background-repeat: no-repeat; opacity: 0.5; background-size: cover; background-position: left;",$.getCategory(n).then(function(t){e.displayArray=t,f(function(){window.prerenderReady=!0},3e3)}),e.ymlFilter.tag=e.info.tag,"recs"==e.info.tag&&(e.ymlFilter={tag:"recs",cat:e.info.cat}),e.vendorFilter.vendor=e.info.vendor,e.search={},e.info&&"recs"==e.info.tag?(e.search.cat=e.info.cat,e.search.tag="recs"):e.info&&e.paramKey&&S.getPackages(e.paramKey).then(function(t){e.packages=t}),e.search={tag:e.info.tag}})),e.timeCheck=function(t){if(t){var n=moment(t).format("YYYY-MM-DD");e.build.date=n,e.times=Object.keys(e.buildStatStock[n])}else if(e.builderDate&&e.buildStatStock){var n=moment(e.builderDate).format("YYYY-MM-DD");e.build.date=n,e.times=Object.keys(e.buildStatStock[n])}else e.times=[]},e.setTime=function(t,n){e.build.time=t,n&&e.checkStatic()},e.timeEnqCheck=function(){if(!e.enquireObj.date)return e.times=[];var t=moment(e.enquireObj.date).format("YYYY-MM-DD");e.times=Object.keys(e.buildStatStock[t])},e.selTime=function(t){if(e.buildStatStock&&e.build.date){var n=moment(e.build.date).format("YYYY-MM-DD");e.buildStatStock[n][t].available>0?e.build.time=t:$mdToast.show($mdToast.simple().textContent("Unavailable!"))}else $mdToast.show($mdToast.simple().textContent("Unavailable!"));e.build.time=t},e.filterTimes=function(t){var n=[];angular.forEach(e.times,function(e){moment(e.mnt).isSame(moment(t),"day")&&n.push(e)}),e.times=n},e.buildTimes=function(){if(e.build.date&&e.buildStatStock){var t=moment(e.build.date).format("YYYY-MM-DD");return e.buildStatStock[t]}return{}},e.prettyDate=function(){if(e.build.date){moment(e.build.date).clone().format("YYYY-MM-DD");if(e.build.time.length>6)return moment(e.build.date).clone().format("lll");var t=e.build.time.split("-");return moment(e.build.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.gallery=[],e.distance=function(){if(e.info&&e.info.location&&e.userLoc)return GeoFire.distance([e.info.location.lat,e.info.location.lng],e.userLoc)},e.builderDate=new Date,e.todayDate=new Date,e.minDate=new Date(e.todayDate.getFullYear(),e.todayDate.getMonth(),e.todayDate.getDate()),e.maxDate=new Date(e.todayDate.getFullYear(),e.todayDate.getMonth()+8,e.todayDate.getDate()),e.todayFormat=moment().clone().subtract(1,"days").format("YYYY-DD-MM"),e.vrGrow=function(t){return t==e.vrId?4:1},e.vrId="",e.explNow=function(){e.explView=!e.explView},e.growVR=function(t){e.vrId=t},e.vrGal=[],e.explView=!0,e.vrURL=function(e){return"./vrview/index.html?image="+e},a(Y.child("profiles/"+e.appAuth.uid)).$loaded(function(t){e.user=t}),e.gvrs=[],e.enqDate=function(){if(e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)return moment(e.enquireObj.date).clone().format("lll");var t=e.enquireObj.time.split("-");return moment(e.enquireObj.date).clone().hours(parseInt(t[0])).minutes(parseInt(t[1])).format("lll")}},e.enquireObj={},e.enquireBuild=function(){e.enquireObj.location=e.info.location;e.packages[0],e.packages[0].$id;e.times=[],e.enquireObj={};var t=e.info;angular.forEach(t,function(t,n){e.enquireObj[n]=t}),e.user&&(" "!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=e.info.$id,e.enquireObj.parent=t.$id;var n=moment().format("YYYY-MM-DD");a(Y.child("static_stock/"+e.info.$id).orderByKey().startAt(n).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,n){e.valiDates={},e.validDates[n]=!0,e.times=[];var a=n;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,n){if(t){var i=a+" "+n;moment(i).isAfter()&&e.times.push({mnt:moment(i),time:moment(i).add(-1,"hours").format("HH:mm"),key:n})}})})})},e.enquireVBuild=function(t){e.enquireObj.location=n.location;e.packages[0],e.packages[0].$id;e.times=[],e.enquireObj={};var n=e.info;angular.forEach(n,function(t,n){e.enquireObj[n]=t}),e.user&&(" "!=e.user.name&&(e.enquireObj.username=e.user.name),e.user.email&&(e.enquireObj.email=e.user.email)),e.enquireObj.date=null,e.enquireObj.time=null,e.enquireObj.pid=e.info.$id,e.enquireObj.parent=n.$id;var i=moment().format("YYYY-MM-DD");a(Y.child("static_stock/"+t).orderByKey().startAt(i).limitToFirst(20)).$loaded(function(t){e.enqSS=t,angular.forEach(t,function(t,n){e.valiDates={},e.validDates[n]=!0,e.times=[];var a=n;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,n){if(t){var i=a+" "+n;moment(i).isAfter()&&e.times.push({mnt:moment(i),time:moment(i).add(-1,"hours").format("HH:mm"),key:n})}})})})},e.enqNow=function(t){if(e.enquireObj.sending=!0,e.enquireObj.date&&e.enquireObj.time){moment(e.enquireObj.date).clone().format("YYYY-MM-DD");if(e.enquireObj.time.length>6)e.enquireObj.date=e.enquireObj.date.clone().format("lll");else{var a=e.enquireObj.time.split("-");e.enquireObj.date=moment(e.enquireObj.date).clone().hours(parseInt(a[0])).minutes(parseInt(a[1])).format("lll")}}i(Y.child("enqs")).$add(e.enquireObj).then(function(a){var i={method:"POST",url:"https://www.pbpapi.com/tktr/"+e.enquireObj.vendor+"/enquire",data:{uid:e.appAuth.uid,enquiry:e.enquireObj},dataType:"json",headers:{"Content-Type":"application/json"}};n(i).then(function(t){e.enquireObj.sent=!0,e.enquireObj={},f(function(){e.enquireObj.sending=!1},5e3)},function(e){}),Y.child("profiles").child(e.appAuth.uid).child("name").set(e.enquireObj[t].username),Y.child("profiles").child(e.appAuth.uid).child("email").set(e.enquireObj[t].email)})},e.vendorNumber=function(e){Y.child("info").child(e).child("phone").on("value",function(e){return e.val()})},e.avalnow=function(){var t=moment(e.build.date).format("YYYY-MM-DD"),n=moment(e.build.time).format("HH-mm");return e.buildStatStock[t]&&e.buildStatStock[t][n]&&e.buildStatStock[t][n].available?e.buildStatStock[t][n].available:e.buildStatStock[t]&&!e.buildStatStock[t][n]&&e.buildStatStock[t].available?e.buildStatStock[t].available:void 0},e.myState=function(e){return paramKey==e},e.sphereMode=!1,e.sphereIndex=0,e.loadVR=function(t){new PhotoSphereViewer({panorama:t.url,container:"viewer",loadingImg:e.partner.logo,time_anim:!1,navbar:!0,max_fov:80,min_fov:50,allow_scroll_to_zoom:!1,usexmpdata:!1,gyroscope:!0,auto_rotate:!1,transition:{duration:1500,loader:!0,blur:!1},navbar_style:{backgroundColor:"rgba(58, 67, 77, 0.7)"}})},e.loadImg=function(t){e.centerImg=t},a(Y.child("ticketing/"+e.paramKey)).$loaded(function(t){e.ticketing=t}),e.expand=!1,e.checkStatic=function(){v.checkStatic(e.build).then(function(t){t?e.build.greenlit=1:e.build.greenlit=2})},e.numbArray=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],e.build={},e.buildPack=function(t){e.buildPack=e.packageData[t][t],e.buildPack.quantity=e.build.quantity},e.surgeBool=function(){var t=!1;if(e.build&&e.build.date&&e.build.weekend_charge){var n=moment(e.build.date).day();angular.forEach(e.build.weekend_charge.days,function(e,a){e==n&&(t=!0)})}return t},e.tObj={};moment().format("YYYY-MM-DD");e.packBuy=function(t){e.ivView="buy",e.builder(t)},e.packVBuy=function(){e.ivView="buy",e.builderVaya()},e.dOpts=[],e.builder=function(t){var n;n=!t.name&&t.val?t.val:t,console.log(n),e.times=[],e.build={},angular.forEach(n,function(t,n){e.build[n]=t}),e.build.date=null,e.build.time=null,e.build.pid=n.$id,e.build.parent=r.id,e.build.weekend_charge&&(e.build.quantity=1),e.buildStatStock={},e.build.greenlit=0,e.tObj={};var i=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||a(Y.child("static_stock/"+r.id).orderByKey().startAt(i)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,n){e.tObj={k:[]},e.valiDates={},e.validDates[n]=!0,e.dOpts.push(moment(n).format("ll"))})}),e.build.ticket){var i=moment().format("YYYY-MM-DD");a(Y.child("static_stock/"+r.id).orderByKey().startAt(i)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,n){e.valiDates={},e.validDates[n]=!0;var a=n;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,n){if(t){var i=a+" "+n;moment(i).isAfter()&&e.times.push({mnt:moment(i),time:moment(i).add(-1,"hours").format("HH:mm"),key:n})}})})})}},e.clearBuild=function(){e.build=null},e.tempDate={},e.stops=["junta","rraval"],e.builderVaya=function(){e.times=[],e.build={};var t=e.packages[0],n=e.packages[0].$id;angular.forEach(t,function(t,n){e.build[n]=t}),e.build.date=e.tempDate.date,e.build.time=null,e.build.pid=n,e.build.parent=t.parent,e.build.greenlit=0;var i=moment().format("YYYY-MM-DD");if(e.build.tktrpack||e.build.ticket||a(Y.child("static_stock/"+t.parent).orderByKey().startAt(i)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,n){e.valiDates={},e.validDates[n]=!0;var a=n;t.capacity&&void 0!=t.capacity?e.times=[{key:"00-00"}]:angular.forEach(t,function(t,n){if(t){var i=a+" "+n;moment(i).isAfter()&&moment(i).isSame(moment(e.build.date),"day")&&e.times.push({mnt:moment(i),time:moment(i).add(-1,"hours").format("HH:mm"),key:n})}})})}),e.build.ticket){var i=moment().format("YYYY-MM-DD");a(Y.child("static_stock/"+t.parent).orderByKey().startAt(i)).$loaded(function(t){e.buildStatStock=t,angular.forEach(t,function(t,n){e.valiDates={},e.validDates[n]=!0;var a=n;t.capacity&&void 0!=t.capacity?(e.noTimeBool=!0,e.times=[{key:"00-00"}]):angular.forEach(t,function(t,n){if(t){var i=a+" "+n;moment(i).isAfter()&&moment(i).isSame(moment(e.build.date))&&e.times.push({mnt:moment(i),time:moment(i).add(-1,"hours").format("HH:mm"),key:n})}})})})}},e.checkStock=function(){v.checkStock(e.build).then(function(t){t&&(e.build.stock=t,e.build.greenlit=!0)})["catch"](function(t){e.build.time=null,e.build.quantity=null,alert(t)})},e.validDates={},e.today=moment().format("YYYY-MM-DD"),e.validate=function(t){var n=moment(t).format("YYYY-MM-DD");return!e.validDates[n]},e.times=[],e.checkDay=function(t){return moment(t).isSame(e.build.date,"day")},e.indexShift=function(t){var n=e.showIndex+t;n>e.gallery.length-1?e.showIndex=0:n<0?e.showIndex=e.gallery.length-1:e.showIndex=n},e.showIndex=0,e.prettyTime=function(e){var t=e.split("-"),n=t[0]+":"+t[1];return n},e.mediaFilter={},e.currentDate=Date(),e.selectDay=function(t){s(e.currentDate,{targetEvent:t}).then(function(t){e.build.date=moment(t).format("YYYY-MM-DD")})},e.selectBVaya=function(t){s(e.currentDate,{targetEvent:t}).then(function(t){e.tempDate.date=moment(t).format("YYYY-MM-DD"),e.builderVaya()})},e.showTimePicker=function(t){m(e.currentTime,{targetEvent:t}).then(function(n){var a=moment(n).format("HH-mm");e.ticketing[e.build.date][a]?e.build.time=a:e.showTimePicker(t)})},e.imgIndex=0,e.addToCart=function(){c.addItem(e.build),e.clearBuild()}}]);